<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  
  <link rel="manifest" href="manifest.json">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TV Grid">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0b0f14">

  <title>6 Streams Grid</title>
  <style>
    :root{
      --gap: 6px;
      --bg: #0b0f14;
      --tile-bg: #121a24;
      --border: rgba(255,255,255,0.10);
      --scale: 0.65;
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      background: var(--bg);
      font-family: system-ui, -apple-system, sans-serif;
      overflow:hidden;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .grid{
      height: 100dvh;
      width: 100vw;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: var(--gap);
      padding: var(--gap);
      padding-bottom: env(safe-area-inset-bottom);
    }

    .tile{
      position:relative;
      background: var(--tile-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow:hidden;
    }

    .frameWrap{
      position:absolute;
      inset:0;
      overflow:hidden;
      background:#0b0f14;
    }
    iframe{
      position:absolute;
      top:0; left:0;
      width: calc(100% / var(--scale));
      height: calc(100% / var(--scale));
      transform: scale(var(--scale));
      transform-origin: top left;
      border:0;
      background:white;
    }

    .overlay{ position:absolute; inset:0; z-index:10; background: transparent; }
    .tile.ready .overlay{ display:none; }

    .hotspot{
      position:absolute; top:0; right:0; width: 18%; height: 18%;
      z-index: 20; background: transparent; display:none;
    }
    .tile.ready .hotspot{ display:block; }

    /* כפתור מסך מלא ידני (מופיע רק אם צריך) */
    #fsBtn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      border: 1px solid white;
      z-index: 999999;
      font-size: 14px;
      display: none; /* מוסתר כברירת מחדל */
      cursor: pointer;
    }

    /* Modal Styles */
    .modal{
      position:fixed; inset:0; background: rgba(0,0,0,0.65);
      display:none; align-items:center; justify-content:center;
      z-index: 99999; padding: 16px;
    }
    .modal.show{ display:flex; }
    .card{
      width:min(560px, 100%); background: #0f1620;
      border:1px solid rgba(255,255,255,0.14); border-radius: 16px;
      padding: 14px; color: rgba(255,255,255,0.92);
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
    }
    .title{ font-size:14px; margin:0 0 10px 0; opacity:0.95; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input{
      flex:1 1 340px; padding:10px 12px; border-radius: 12px;
      border:1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.95); outline:none; direction:ltr; font-size:13px;
    }
    .btn{
      padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.95);
      font-size:13px; cursor:pointer;
    }
    .small{ font-size:12px; opacity:0.78; margin-top:10px; line-height:1.35; }
  </style>
</head>
<body>

  <button id="fsBtn">לחץ למסך מלא</button>

  <div class="grid" id="grid">
    <div class="tile" data-slot="1"><div class="frameWrap"><iframe id="f1" allowfullscreen></iframe></div><div class="overlay" data-slot="1"></div><div class="hotspot" data-slot="1"></div></div>
    <div class="tile" data-slot="2"><div class="frameWrap"><iframe id="f2" allowfullscreen></iframe></div><div class="overlay" data-slot="2"></div><div class="hotspot" data-slot="2"></div></div>
    <div class="tile" data-slot="3"><div class="frameWrap"><iframe id="f3" allowfullscreen></iframe></div><div class="overlay" data-slot="3"></div><div class="hotspot" data-slot="3"></div></div>
    <div class="tile" data-slot="4"><div class="frameWrap"><iframe id="f4" allowfullscreen></iframe></div><div class="overlay" data-slot="4"></div><div class="hotspot" data-slot="4"></div></div>
    <div class="tile" data-slot="5"><div class="frameWrap"><iframe id="f5" allowfullscreen></iframe></div><div class="overlay" data-slot="5"></div><div class="hotspot" data-slot="5"></div></div>
    <div class="tile" data-slot="6"><div class="frameWrap"><iframe id="f6" allowfullscreen></iframe></div><div class="overlay" data-slot="6"></div><div class="hotspot" data-slot="6"></div></div>
  </div>

  <div class="modal" id="modal">
    <div class="card">
      <p class="title" id="modalTitle">הגדרת קישור לחלון #?</p>
      <div class="row">
        <input id="urlInput" placeholder="https://example.com" autocomplete="off" />
        <button class="btn" id="okBtn">OK</button>
        <button class="btn" id="cancelBtn">ביטול</button>
      </div>
      <div class="small">עריכה מחדש: לחיצה ארוכה בפינה ימנית עליונה.</div>
    </div>
  </div>

<script>
(() => {
  /* --- JS Fullscreen Logic --- */
  const fsBtn = document.getElementById('fsBtn');
  
  // בדיקה האם אנחנו כבר במצב אפליקציה
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  
  if (!isStandalone) {
    // אם לא באפליקציה, נציג כפתור שבלחיצה עליו הדפדפן ייכנס למסך מלא
    fsBtn.style.display = 'block';
    fsBtn.addEventListener('click', () => {
      document.documentElement.requestFullscreen().catch(e => {
        console.log(e);
        alert("נסה להוסיף למסך הבית דרך תפריט הדפדפן");
      });
      fsBtn.style.display = 'none'; // הסתרת הכפתור אחרי הלחיצה
    });
  }

  /* --- Original App Logic --- */
  const HOLD_MS = 3000;
  const defaultUrls = {
    1: "https://gurutv.online/ch11.html",
    2: "https://gurutv.online/ch12.html",
    3: "https://gurutv.online/ch13.html",
    4: "https://gurutv.online/ch14.html",
    5: "https://gurutv.online/chi24news.html",
    6: "https://www.elahmad.com/tv/aljazeera.htm",
  };
  const frames = { 1:document.getElementById('f1'), 2:document.getElementById('f2'), 3:document.getElementById('f3'), 4:document.getElementById('f4'), 5:document.getElementById('f5'), 6:document.getElementById('f6') };
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const urlInput = document.getElementById('urlInput');
  const okBtn = document.getElementById('okBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  let activeSlot = null;
  let holdTimer = null;

  function normalizeUrl(u){
    u = (u || '').trim();
    if (!u) return '';
    if (!/^https?:\/\//i.test(u)) u = 'https://' + u;
    return u;
  }
  function tileEl(slot){ return document.querySelector(`.tile[data-slot="${slot}"]`); }
  function setSlotUrl(slot, url, save=true){
    const clean = normalizeUrl(url);
    if (save){
      if (clean) localStorage.setItem('dash6_url_' + slot, clean);
      else localStorage.removeItem('dash6_url_' + slot);
    }
    frames[slot].src = clean || 'about:blank';
    const t = tileEl(slot);
    if (clean) t.classList.add('ready');
    else t.classList.remove('ready');
  }
  function openModal(slot){
    activeSlot = slot;
    modalTitle.textContent = 'הגדרת קישור לחלון #' + slot;
    urlInput.value = localStorage.getItem('dash6_url_' + slot) || defaultUrls[slot] || '';
    modal.classList.add('show');
    setTimeout(() => urlInput.focus(), 50);
  }
  function closeModal(){ modal.classList.remove('show'); activeSlot = null; urlInput.value = ''; }
  function attachHold(el, getSlot){
    const start = (e) => { clearTimeout(holdTimer); holdTimer = setTimeout(() => openModal(getSlot()), HOLD_MS); };
    const stop = () => clearTimeout(holdTimer);
    el.addEventListener('mousedown', start);
    el.addEventListener('touchstart', start, {passive:false});
    el.addEventListener('mouseup', stop);
    el.addEventListener('mouseleave', stop);
    el.addEventListener('touchend', stop);
    el.addEventListener('touchcancel', stop);
    el.addEventListener('contextmenu', (e) => e.preventDefault());
  }

  for (let i=1; i<=6; i++){
    const saved = localStorage.getItem('dash6_url_' + i);
    setSlotUrl(i, saved || defaultUrls[i] || '', false);
  }
  document.querySelectorAll('.overlay').forEach(ov => attachHold(ov, () => Number(ov.dataset.slot)));
  document.querySelectorAll('.hotspot').forEach(hs => attachHold(hs, () => Number(hs.dataset.slot)));
  okBtn.addEventListener('click', () => { if (!activeSlot) return closeModal(); setSlotUrl(activeSlot, urlInput.value, true); closeModal(); });
  cancelBtn.addEventListener('click', closeModal);
  modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
  urlInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') okBtn.click(); if (e.key === 'Escape') closeModal(); });
})();
</script>
</body>
</html>
