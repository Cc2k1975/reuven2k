<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מועדפים</title>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1115; --card:#171a21; --card-2:#1b2030;
      --text:#e8ebf1; --muted:#9aa3b2; --accent:#7aa2ff; --accent-2:#4dd6c1;
      --ring: rgba(122,162,255,0.35); --danger:#ff6b6b;
      --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background: radial-gradient(1200px 800px at 80% -10%, #1b2233 0%, #0f1115 55%) fixed;
      color:var(--text);font-family:"Heebo",sans-serif;}
    .wrap{max-width:1000px;margin:auto;padding:28px 18px 140px;}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px;}
    .logo{width:46px;height:46px;border-radius:12px;background: conic-gradient(from 210deg, var(--accent), var(--accent-2));
      display:grid;place-items:center;box-shadow: var(--shadow);}
    .logo svg{width:26px;height:26px;}
    h1{margin:0;font-size: clamp(20px, 3.2vw, 28px);font-weight:800;letter-spacing:.3px}
    .grid{display:grid;grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));gap:16px;margin:18px 0 32px;}
    .card{background: linear-gradient(180deg, var(--card), var(--card-2));border-radius: var(--radius);
      box-shadow: var(--shadow);border:1px solid rgba(255,255,255,0.05);transition: transform .18s, box-shadow .18s, border-color .18s;
      text-align:center;padding:28px 18px;}
    .card:hover{ transform: translateY(-2px); border-color: rgba(122,162,255,.25); box-shadow: 0 18px 40px rgba(0,0,0,.5) }
    .fav{width:64px;height:64px;border-radius:20px;margin:0 auto 14px auto;
      background: linear-gradient(135deg, rgba(122,162,255,.15), rgba(77,214,193,.12));
      display:grid;place-items:center;border:1px solid rgba(255,255,255,.06);}
    .fav img{width:38px;height:38px;}
    .card a.open{display:inline-block;padding:10px 14px;border-radius:14px;text-decoration:none;color:var(--text);
      background: linear-gradient(135deg, rgba(122,162,255,.18), rgba(77,214,193,.18));
      border:1px solid rgba(255,255,255,.08);transition:transform .15s, border-color .15s;}
    .card a.open:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22);}
    .bar{position:fixed;bottom:0;left:0;right:0;background:rgba(15,17,21,.86);backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,.06);padding:14px 16px;}
    .bar-inner{max-width:1000px;margin:auto;display:grid;gap:12px;grid-template-columns:1fr 2fr auto;align-items:end;}
    label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
    input{width:100%;padding:12px 14px;border-radius:14px;background:#0d0f14;color:var(--text);
      border:1px solid rgba(255,255,255,.08);outline:none;direction:rtl;}
    input:focus{border-color:#7aa2ff;box-shadow:0 0 0 6px var(--ring)}
    .btn{padding:12px 18px;border:none;border-radius:16px;font-weight:700;
      background: linear-gradient(135deg,#7aa2ff,#4dd6c1);color:#0b0d12;cursor:pointer;box-shadow:var(--shadow);}
    .btn:hover{transform:translateY(-1px);filter:saturate(110%)}
    .err{color:var(--danger);font-size:13px;margin-top:6px}
    .empty{margin:30px 0 40px;color:var(--muted);text-align:center;font-size:15px}
    @media(max-width:700px){.bar-inner{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12a8 8 0 1 0 16 0" stroke="white" stroke-width="2.5" stroke-linecap="round"/><circle cx="12" cy="12" r="3" fill="white"/></svg>
      </div>
      <h1>מועדפים</h1>
    </header>

    <section id="cards" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>אין עדיין קישורים בקובץ.</div>
  </div>

  <div class="bar">
    <div class="bar-inner">
      <div>
        <label for="name">שם הקישור</label>
        <input id="name" type="text" autocomplete="off">
      </div>
      <div>
        <label for="url">הכנס קישור</label>
        <input id="url" type="text" autocomplete="off" inputmode="url">
        <div id="err" class="err" hidden></div>
      </div>
      <button id="saveAll" class="btn" type="button">שמור לכולם</button>
    </div>
  </div>

  <script>
    const $ = s=>document.querySelector(s);
    const cards=$("#cards"),empty=$("#empty"),inpName=$("#name"),inpUrl=$("#url"),btnSave=$("#saveAll"),err=$("#err");
    const JSON_PATH="data/links.json";let list=[];
    const faviconFor=u=>`https://www.google.com/s2/favicons?domain=${encodeURIComponent(new URL(u).hostname)}&sz=128`;

    function render(){
      cards.innerHTML="";if(!list.length){empty.hidden=false;return;}
      empty.hidden=true;
      list.forEach(item=>{
        const c=document.createElement("div");c.className="card";
        c.innerHTML=`
          <div class="fav"><img src="${faviconFor(item.url)}" alt=""></div>
          <a class="open" href="${item.url}" target="_blank" rel="noopener">${item.name}</a>
        `;
        cards.appendChild(c);
      });
    }

    async function loadJson(){
      try{const r=await fetch(`${JSON_PATH}?v=${Date.now()}`,{cache:"no-store"});
      if(!r.ok)throw 0;list=await r.json();}catch{list=[];}render();
    }

    function normalizeUrl(raw){
      let s=raw.trim();if(!s.startsWith("http"))s="https://"+s;
      try{return new URL(s).toString();}catch{throw new Error("כתובת לא תקינה");}
    }

    function add(){
      err.hidden=true;
      const n=inpName.value.trim(),u=inpUrl.value.trim();
      if(!n||!u){err.textContent="נא למלא את שני השדות";err.hidden=false;return;}
      try{const url=normalizeUrl(u);list.unshift({name:n,url});inpName.value=inpUrl.value="";
      render();copyAndOpen();}catch(e){err.textContent=e.message;err.hidden=false;}
    }

    function copyAndOpen(){
      const txt=JSON.stringify(list,null,2);
      const open=()=>window.open("https://github.com/Cc2k1975/reuven2k/edit/main/data/links.json","_blank");
      navigator.clipboard.writeText(txt).then(open,open);
    }

    btnSave.addEventListener("click",add);
    loadJson();
  </script>
</body>
</html>
