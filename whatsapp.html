<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp PTT</title>
    <style>
        :root { --wa-green: #25D366; --wa-dark: #075E54; }
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 15px; user-select: none; -webkit-user-select: none; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); width: 100%; max-width: 400px; text-align: center; }
        .box { background: #f8f9fa; border: 2px solid #eaebec; border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: right; }
        .label { font-size: 12px; color: #666; font-weight: bold; }
        .field { font-size: 18px; font-weight: bold; color: var(--wa-dark); min-height: 25px; word-break: break-word; }
        
        /* 驻转专 专 */
        .ptt-btn { 
            width: 200px; height: 200px; border-radius: 50%; border: none;
            background-color: #34b7f1; color: white; font-size: 20px; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            margin: 20px auto; display: block; touch-action: none;
            transition: transform 0.1s, background-color 0.2s;
        }
        .ptt-btn:active, .ptt-btn.active { 
            background-color: #ff4b2b; transform: scale(0.95); box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-small { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-paste { background-color: #6c757d; color: white; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color: var(--wa-dark); margin-top: 0;">抓 拽  砖</h2>
    
    <div class="box">
        <div class="label">住驻专 驻:</div>
        <div id="phoneField" class="field">---</div>
    </div>
    
    <div class="box">
        <div class="label">注 砖转砖:</div>
        <div id="msgField" class="field" style="font-weight: normal;">---</div>
    </div>

    <button class="btn-small btn-paste" onclick="pasteFromClipboard()"> 拽 住驻专 专</button>

    <button id="pttBtn" class="ptt-btn">
        拽 专<br>
    </button>

    <p id="status" style="font-size: 14px; color: #888;">拽专 住驻专  注. 砖专专  砖.</p>
    
    <button class="btn-small" style="background:#eee" onclick="location.reload()">拽 </button>
</div>

<script>
    let recognition;
    let lockedNumber = "";
    let fullText = "";

    function setupSpeech() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new Speech();
        recognition.lang = 'he-IL';
        recognition.continuous = true;
        recognition.interimResults = true;

        recognition.onresult = (event) => {
            let currentText = "";
            for (let i = 0; i < event.results.length; i++) {
                currentText += event.results[i][0].transcript;
            }
            fullText = currentText;
            updateDisplay(currentText);
        };
    }

    function updateDisplay(text) {
        const phoneElem = document.getElementById('phoneField');
        const msgElem = document.getElementById('msgField');

        if (!lockedNumber) {
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 9) {
                lockedNumber = digits.substring(0, 10);
                phoneElem.innerText = lockedNumber;
            } else {
                phoneElem.innerText = digits;
            }
        }

        if (lockedNumber) {
            let messagePart = text.replace(lockedNumber, '').trim();
            // 拽 住驻专 驻 砖驻注 注转 注
            messagePart = messagePart.replace(/[0-9\-]{7,}/g, '').trim();
            msgElem.innerText = messagePart || "---";
        }
    }

    const pttBtn = document.getElementById('pttBtn');

    // 驻拽爪 转转 拽
    function startRecording(e) {
        e.preventDefault();
        if (!recognition) setupSpeech();
        
        fullText = "";
        pttBtn.classList.add('active');
        pttBtn.innerHTML = "拽砖...<br>";
        document.getElementById('status').innerText = "砖专专 砖住转 专";
        
        recognition.start();
    }

    // 驻拽爪 驻住拽转 拽 砖
    function stopRecording(e) {
        e.preventDefault();
        pttBtn.classList.remove('active');
        pttBtn.innerHTML = "拽 专<br>";
        
        if (recognition) {
            recognition.stop();
        }

        // 转 拽 注 转爪 专 砖
        setTimeout(() => {
            sendToWhatsApp();
        }, 500);
    }

    //  专注 注 注专 (Push-to-Talk)
    pttBtn.addEventListener('pointerdown', startRecording);
    window.addEventListener('pointerup', (e) => {
        if (pttBtn.classList.contains('active')) {
            stopRecording(e);
        }
    });

    async function pasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 9) {
                lockedNumber = digits;
                document.getElementById('phoneField').innerText = lockedNumber;
            }
        } catch (e) { alert("砖专 砖 "); }
    }

    function sendToWhatsApp() {
        let num = document.getElementById('phoneField').innerText.replace(/\D/g, '');
        let msg = document.getElementById('msgField').innerText.trim();
        if (msg === "---") msg = "";
        
        if (!num || num.length < 9) {
            document.getElementById('status').innerText = "砖: 住驻专  ";
            return;
        }

        if (num.startsWith('0')) num = '972' + num.substring(1);
        
        const url = `https://wa.me/${num}?text=${encodeURIComponent(msg)}`;
        window.location.href = url;
    }

    // 注转 转驻专 拽砖专 爪 专
    window.oncontextmenu = function(event) {
        event.preventDefault();
        event.stopPropagation();
        return false;
    };
</script>
</body>
</html>
