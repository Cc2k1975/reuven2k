<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PhotoFun Booth HD</title>

<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Varela+Round&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    height:100vh;
    overflow:hidden;
    font-family:'Varela Round',sans-serif;
}
.screen{
    position:absolute;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    flex-direction:column;
}
.screen.active{display:flex;}

#final-strip{
    width:100vw;
    height:100vh;
    object-fit:cover;
}

#camera-feed{
    width:100%;
    height:100%;
    object-fit:cover;
    transform:scaleX(-1);
}

.start-btn{
    font-family:'Fredoka One';
    font-size:3rem;
    padding:20px 60px;
    border-radius:50px;
    border:none;
    background:#4ecdc4;
    color:white;
    cursor:pointer;
}
</style>
</head>

<body>

<canvas id="photoCanvas" style="display:none"></canvas>

<div id="screen-start" class="screen active">
    <h1 style="font-family:'Fredoka One';font-size:3.5rem">עמדת צילום</h1>
    <h2 id="event-title-display" style="font-family:'Fredoka One'">מסיבת פורים</h2>
    <button id="btn-start" class="start-btn">התחל</button>
</div>

<div id="screen-camera" class="screen">
    <video id="camera-feed" autoplay playsinline muted></video>
</div>

<div id="screen-preview" class="screen">
    <img id="final-strip">
</div>

<script>
const totalPhotos = 3;
const photos = [];
let current = 0;
let stream = null;

let eventName = "מסיבת פורים";
let eventDate = "24.1.2026";
let selectedBg = "1.jpg";   // רקע נבחר

document.getElementById("btn-start").onclick = async()=>{
    current = 0;
    photos.length = 0;
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
    document.getElementById("camera-feed").srcObject = stream;
    show("screen-camera");
    shoot();
};

function shoot(){
    if(current>=totalPhotos){
        stream.getTracks().forEach(t=>t.stop());
        buildStrip();
        return;
    }
    setTimeout(()=>{
        const v = document.getElementById("camera-feed");
        const c = document.createElement("canvas");
        c.width=v.videoWidth;
        c.height=v.videoHeight;
        const x=c.getContext("2d");
        x.translate(c.width,0);
        x.scale(-1,1);
        x.drawImage(v,0,0);
        photos.push(c);
        current++;
        shoot();
    },1500);
}

function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

function buildStrip(){
    const canvas=document.getElementById("photoCanvas");
    const ctx=canvas.getContext("2d");

    const W=900,H=1920;
    canvas.width=W;
    canvas.height=H;

    const photoSize=460;
    const gap=55;
    const top=260;

    const x=(W-photoSize)/2;
    const y=[top, top+photoSize+gap, top+(photoSize+gap)*2];

    const drawBg=img=>{
        const s=Math.max(W/img.width,H/img.height);
        const sw=W/s, sh=H/s;
        ctx.drawImage(img,(img.width-sw)/2,(img.height-sh)/2,sw,sh,0,0,W,H);
    };

    const drawPhoto=(p,dx,dy)=>{
        const s=Math.min(p.width,p.height);
        ctx.drawImage(p,(p.width-s)/2,(p.height-s)/2,s,s,dx,dy,photoSize,photoSize);
    };

    const drawText=()=>{
        const yText=H-140;
        ctx.textAlign="center";

        const g=ctx.createLinearGradient(0,0,W,0);
        g.addColorStop(0,"#ff2d2d");
        g.addColorStop(.5,"#ffd400");
        g.addColorStop(1,"#00d084");

        ctx.font='78px "Fredoka One"';
        ctx.lineWidth=10;
        ctx.strokeStyle="white";
        ctx.fillStyle=g;
        ctx.strokeText(eventName,W/2,yText);
        ctx.fillText(eventName,W/2,yText);

        ctx.font='52px "Varela Round"';
        ctx.fillStyle="#6c63ff";
        ctx.strokeText(eventDate,W/2,yText+70);
        ctx.fillText(eventDate,W/2,yText+70);
    };

    if(selectedBg){
        const bg=new Image();
        bg.src=selectedBg;
        bg.onload=()=>{
            drawBg(bg);
            photos.forEach((p,i)=>drawPhoto(p,x,y[i]));
            drawText();
            finish();
        };
    }else{
        ctx.fillStyle="#fff";
        ctx.fillRect(0,0,W,H);
        photos.forEach((p,i)=>drawPhoto(p,x,y[i]));
        drawText();
        finish();
    }

    function finish(){
        document.getElementById("final-strip").src=canvas.toDataURL("image/jpeg",0.92);
        show("screen-preview");
    }
}
</script>

</body>
</html>