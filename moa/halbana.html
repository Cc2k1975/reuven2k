<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מעביר קוד ל-DOCX</title>

  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

  <style>
    :root{
      --bg:#f3f4f6; --panel:#ffffff; --text:#111827;
      --muted:#6b7280; --green:#16a34a; --green2:#15803d;
      --border:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg); color:var(--text);
      height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .card{
      width:min(900px, 100%);
      height:min(720px, 100%);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      display:flex; flex-direction:column;
      overflow:hidden;
    }
    header{
      padding:18px 20px;
      border-bottom:1px solid var(--border);
    }
    h1{margin:0; font-size:18px}
    .hint{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.4}
    .content{padding:16px 20px; display:flex; flex-direction:column; gap:12px; flex:1}

    textarea{
      flex:1;
      width:100%;
      resize:none;
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      font-family:Consolas, "Courier New", monospace;
      font-size:14px;
      line-height:1.5;
      outline:none;

      /* ===== השינוי היחיד ===== */
      direction: ltr;
      text-align: left;
    }

    textarea:focus{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.15)}
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .leftRow{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:var(--muted); font-size:13px;
    }
    .btn{
      border:none;
      border-radius:14px;
      padding:12px 18px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      background:var(--green);
      color:white;
      transition:.15s transform, .15s background;
      min-width:170px;
    }
    .btn:hover{background:var(--green2)}
    .btn:active{transform:scale(.98)}
    .btn.secondary{
      background:#e5e7eb; color:#111827; font-weight:600;
      min-width:170px;
    }
    .btn.secondary:hover{background:#d1d5db}
    .toast{
      position:fixed;
      bottom:18px;
      left:18px;
      background:#111827;
      color:white;
      padding:12px 14px;
      border-radius:14px;
      box-shadow:var(--shadow);
      font-size:14px;
      max-width:min(560px, calc(100vw - 36px));
      display:none;
      white-space:pre-line;
    }
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>מעביר קוד ל־DOCX</h1>
      <div class="hint">
        שם הקובץ נוצר אוטומטית לפי תאריך ושעה:
        <code>DDMMYYYY_HHMMSS.docx</code>
      </div>
    </header>

    <div class="content">
      <!-- גם כאן הגדרה מפורשת, למקרה של דפדפנים בעייתיים -->
      <textarea id="textArea" dir="ltr" placeholder="Paste code / English text here..."></textarea>

      <div class="row">
        <div class="leftRow">
          <span id="charCount">0 תווים</span>
          <span>•</span>
          <span id="lineCount">0 שורות</span>
          <span>•</span>
          <span>שם קובץ: <b id="fileNamePreview"></b></span>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn secondary" id="clearBtn">נקה</button>
          <button class="btn" id="saveBtn">שמור DOCX</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const textArea = document.getElementById('textArea');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const toast = document.getElementById('toast');
  const charCount = document.getElementById('charCount');
  const lineCount = document.getElementById('lineCount');
  const fileNamePreview = document.getElementById('fileNamePreview');

  const pad2 = n => String(n).padStart(2, "0");

  function buildFileName(d = new Date()) {
    return `${pad2(d.getDate())}${pad2(d.getMonth()+1)}${d.getFullYear()}_${pad2(d.getHours())}${pad2(d.getMinutes())}${pad2(d.getSeconds())}.docx`;
  }

  function updatePreviewName() {
    fileNamePreview.textContent = buildFileName();
  }

  function computeCounts() {
    const v = textArea.value || "";
    charCount.textContent = `${v.length} תווים`;
    lineCount.textContent = v ? v.replace(/\r\n/g,"\n").split("\n").length : 0;
  }

  function showToast(msg) {
    toast.textContent = msg;
    toast.style.display = "block";
    setTimeout(()=>toast.style.display="none",3000);
  }

  async function saveToDocx() {
    const content = textArea.value.replace(/\r\n/g,"\n").trimEnd();
    if (!content.trim()) return showToast("שגיאה: התיבה ריקה");

    const lines = content.split("\n");
    const doc = new docx.Document({
      sections:[{
        children: lines.map(l=>new docx.Paragraph({
          children:[new docx.TextRun({text:l,font:"Courier New"})],
          spacing:{before:0,after:0,line:276}
        }))
      }]
    });

    const blob = await docx.Packer.toBlob(doc);
    const fileName = buildFileName();
    saveAs(blob, fileName);

    showToast(`נשמר: ${fileName}`);
    textArea.value="";
    computeCounts();
    updatePreviewName();
  }

  saveBtn.onclick = saveToDocx;
  clearBtn.onclick = ()=>{ textArea.value=""; computeCounts(); };
  textArea.oninput = computeCounts;

  window.onkeydown = e=>{
    if((e.ctrlKey||e.metaKey)&&e.key==="s"){e.preventDefault();saveToDocx();}
  };

  computeCounts();
  updatePreviewName();
})();
</script>
</body>
</html>
