<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××©×—×§ ×—×™×¤×•×© - ××¦×‘ ×”×™×©×¨×“×•×ª</title>
    <style>
        body { 
            font-family: system-ui; background: #000; color: white; 
            margin: 0; overflow: hidden; height: 100vh; touch-action: none;
        }

        #ui-layer {
            position: absolute; top: 0; width: 100%; z-index: 100;
            background: rgba(0,0,0,0.7); padding: 10px; text-align: center;
            pointer-events: none;
        }

        #timer-display { font-size: 24px; color: #e74c3c; font-weight: bold; margin-top: 5px; }
        #instruction-display { font-size: 18px; color: #f1c40f; margin-top: 5px; }

        #game-viewport {
            width: 100vw; height: 100vh; position: relative;
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }

        #world {
            position: relative; transform-origin: center;
            width: 100%; display: flex; align-items: center; justify-content: center;
        }

        #game-image { width: 100%; height: auto; pointer-events: none; }

        #hidden-object {
            position: absolute; z-index: 50; line-height: 1;
            display: none; white-space: nowrap;
            user-select: none; touch-action: none;
            transform: translate(-50%, -50%);
        }

        #admin-panel {
            display: none; position: fixed; bottom: 10px; left: 50%;
            transform: translateX(-50%); background: rgba(30, 39, 46, 0.95);
            padding: 12px; border-radius: 20px; border: 2px solid #f1c40f;
            z-index: 1000; width: 95%; max-width: 420px;
        }

        .mode-selector { display: flex; gap: 10px; margin-bottom: 10px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 10px; border: 2px solid #555; background: #1e272e; color: white; }
        .mode-btn.active { background: #f1c40f; color: black; }

        .emoji-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin: 10px 0; max-height: 60px; overflow-y: auto; }
        .emoji-btn { font-size: 20px; background: #34495e; border: none; padding: 5px; border-radius: 5px; }
        
        .selector { background: #34495e; color: white; padding: 8px; width: 49%; border-radius: 5px; border: none; }
        .text-input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; box-sizing: border-box; }
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: bold; }
        .save-btn { background: #2ecc71; color: white; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="ui-layer">
        <div>×©×œ×‘: <span id="level-num">1</span></div>
        <div id="instruction-display">×—×¤×© ××ª ×”××•×‘×™×™×§×˜</div>
        <div id="timer-display">30</div>
    </div>

    <div id="game-viewport">
        <div id="world">
            <img id="game-image" src="1.png">
            <div id="hidden-object">ğŸ‰</div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="mode-selector">
            <button id="btn-mode-img" class="mode-btn active" onclick="setEditMode('IMAGE')">×¢×¨×•×š ×ª××•× ×”</button>
            <button id="btn-mode-obj" class="mode-btn" onclick="setEditMode('OBJECT')">×¢×¨×•×š ×¤×¨×™×˜</button>
        </div>

        <input type="text" id="stage-instruction" class="text-input" placeholder="××” ×”××©×™××” ×œ×©×œ×‘ ×–×”?">

        <div style="display:flex; justify-content: space-between;">
            <select id="stage-select" class="selector" onchange="loadStage()">
                <script>for(let i=0; i<10; i++) document.write(`<option value="${i}">×©×œ×‘ ${i+1}</option>`)</script>
            </select>
            <select id="bg-select" class="selector" onchange="updateBG()">
                <option value="1.png">×ª××•× ×” 1</option>
                <option value="2.png">×ª××•× ×” 2</option>
            </select>
        </div>

        <div class="emoji-grid">
            <script>
                ['ğŸ‰','ğŸš—','ğŸ¤','ğŸ’','ğŸ•','âš½','ğŸš€','ğŸ¦','ğŸ¸','ğŸ©','ğŸš','ğŸ•¶ï¸','ğŸ”‘','ğŸ„','ğŸ§¸','ğŸš²','ğŸ¦€','ğŸ¦‹','âš“','ğŸ'].forEach(e => 
                    document.write(`<button class="emoji-btn" onclick="setEmoji('${e}')">${e}</button>`));
            </script>
        </div>

        <div class="btn-group">
            <button class="btn save-btn" onclick="saveStage()">×©××•×¨ ×©×œ×‘</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="toggleAdmin(false)">×¡×’×•×¨</button>
        </div>
    </div>

    <script>
        let gameData = JSON.parse(localStorage.getItem('myGameData')) || Array(10).fill(null).map(() => ({
            emoji: 'ğŸ‰', x: 50, y: 50, size: 30, bg: '1.png', text: '××¦× ××ª ×”××•×‘×™×™×§×˜'
        }));

        let currentLevel = 0, isAdminOpen = false, editTarget = 'IMAGE';
        let pressTimer, scale = 1, lastDist = 0, objSize = 30;
        let posX = 0, posY = 0, startX = 0, startY = 0;
        let timeLeft = 30, timerInterval;

        const world = document.getElementById('world'), viewport = document.getElementById('game-viewport');
        const obj = document.getElementById('hidden-object'), img = document.getElementById('game-image');
        const admin = document.getElementById('admin-panel'), timerEl = document.getElementById('timer-display');

        viewport.ontouchstart = (e) => {
            if(isAdminOpen) {
                if(e.touches.length === 1) {
                    startX = e.touches[0].clientX - (editTarget === 'IMAGE' ? posX : 0);
                    startY = e.touches[0].clientY - (editTarget === 'IMAGE' ? posY : 0);
                }
                return;
            }

            pressTimer = setTimeout(() => {
                const password = prompt("× × ×œ×”×–×™×Ÿ ×¡×™×¡××” ×œ×›× ×™×¡×” ×œ×”×’×“×¨×•×ª:");
                if (password === "4451") {
                    toggleAdmin(true);
                } else if (password !== null) {
                    alert("×¡×™×¡××” ×©×’×•×™×”!");
                }
            }, 10000);

            if(e.touches.length === 1) { startX = e.touches[0].clientX - posX; startY = e.touches[0].clientY - posY; }
        };

        viewport.ontouchend = () => { clearTimeout(pressTimer); lastDist = 0; };

        function toggleAdmin(show) {
            isAdminOpen = show;
            admin.style.display = show ? 'block' : 'none';
            if(!show) { 
                scale = 1; posX = 0; posY = 0; updateTransform(); 
                startTimer(); 
            } else { 
                clearInterval(timerInterval); 
            }
            loadStage();
        }

        viewport.ontouchmove = (e) => {
            e.preventDefault();
            if (e.touches.length > 0) clearTimeout(pressTimer);

            if(isAdminOpen && editTarget === 'OBJECT') {
                if(e.touches.length === 1) {
                    let rect = img.getBoundingClientRect();
                    obj.style.left = ((e.touches[0].clientX - rect.left) / rect.width) * 100 + '%';
                    obj.style.top = ((e.touches[0].clientY - rect.top) / rect.height) * 100 + '%';
                }
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);
                    if(lastDist > 0) { objSize += (dist - lastDist) * 0.5; obj.style.fontSize = Math.max(5, objSize) + 'px'; }
                    lastDist = dist;
                }
            } else {
                if(e.touches.length === 1) { posX = e.touches[0].clientX - startX; posY = e.touches[0].clientY - startY; }
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);
                    if(lastDist > 0) { scale *= (dist / lastDist); scale = Math.max(1, Math.min(10, scale)); }
                    lastDist = dist;
                }
            }
            updateTransform();
        };

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 30;
            timerEl.innerText = timeLeft;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    // ×”×©×›×œ×•×œ ×”×—×“×©: ×—×–×¨×” ×œ×©×œ×‘ 1 ×‘××§×¨×” ×©×œ ×”×¤×¡×“
                    alert("× ×›×©×œ×ª! ×—×•×–×¨×™× ×œ×©×œ×‘ ×”×¨××©×•×Ÿ...");
                    currentLevel = 0; 
                    resetGamePosition();
                    loadStage();
                }
            }, 1000);
        }

        function resetGamePosition() {
            scale = 1; posX = 0; posY = 0; updateTransform();
            startTimer();
        }

        function updateTransform() { world.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`; }

        obj.onclick = () => {
            if(!isAdminOpen) {
                clearInterval(timerInterval);
                alert("××¦××ª! ×¢×•×‘×¨×™× ×”×œ××”.");
                currentLevel = (currentLevel + 1) % 10;
                resetGamePosition();
                loadStage();
            }
        };

        function setEditMode(m) {
            editTarget = m;
            document.getElementById('btn-mode-img').classList.toggle('active', m === 'IMAGE');
            document.getElementById('btn-mode-obj').classList.toggle('active', m === 'OBJECT');
        }

        function setEmoji(e) { obj.innerText = e; }
        function updateBG() { img.src = document.getElementById('bg-select').value; }

        function loadStage() {
            let idx = isAdminOpen ? document.getElementById('stage-select').value : currentLevel;
            let data = gameData[idx];
            document.getElementById('level-num').innerText = parseInt(idx) + 1;
            document.getElementById('instruction-display').innerText = data.text || '×—×¤×© ××ª ×”××•×‘×™×™×§×˜';
            img.src = data.bg;
            obj.innerText = data.emoji;
            obj.style.left = data.x + '%'; obj.style.top = data.y + '%';
            objSize = data.size || 30; obj.style.fontSize = objSize + 'px';
            obj.style.display = 'block';
            if(isAdminOpen) {
                document.getElementById('bg-select').value = data.bg;
                document.getElementById('stage-instruction').value = data.text || '';
            }
        }

        function saveStage() {
            let idx = document.getElementById('stage-select').value;
            gameData[idx] = {
                emoji: obj.innerText, bg: document.getElementById('bg-select').value,
                x: parseFloat(obj.style.left), y: parseFloat(obj.style.top), 
                size: objSize, text: document.getElementById('stage-instruction').value
            };
            localStorage.setItem('myGameData', JSON.stringify(gameData));
            alert("×”×©×œ×‘ × ×©××¨!");
        }

        window.onload = () => { loadStage(); startTimer(); };
    </script>
</body>
</html>
