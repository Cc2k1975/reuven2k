<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>כלי כיול מיקומים</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: #333;
      color: white;
      font-family: 'Rubik', sans-serif;
      text-align: center;
      margin: 0;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .instructions {
      background: #444;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #666;
    }

    #scalable-wrapper {
      position: relative;
      width: 100%;
      display: flex;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 20px;
    }

    #fixed-canvas {
      position: relative;
      width: 600px;
      background: #fff;
      transform-origin: top center;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    #bgImage {
      width: 100%;
      display: block;
      pointer-events: none; /* כדי שהגרירה לא תיתקע על התמונה */
      user-select: none;
    }

    .draggable-item {
      position: absolute;
      transform: translate(-50%, -50%);
      color: #000;
      font-weight: 500;
      cursor: grab;
      user-select: none;
      background: rgba(255, 255, 0, 0.3); /* רקע צהוב שקוף לזיהוי */
      padding: 2px 5px;
      border: 1px dashed red; /* מסגרת אדומה לדיוק */
      white-space: nowrap;
      z-index: 100;
      touch-action: none; /* מונע גלילה בזמן גרירה במובייל */
    }

    .draggable-item:active {
      cursor: grabbing;
      background: rgba(0, 255, 0, 0.5);
      border-color: green;
    }

    /* עיצוב הפונטים כמו במקור */
    .t-name{ font-size:18px; }
    .t-id{ font-size:18px; direction:ltr; }
    .t-date{ font-size:17px; direction:ltr; }
    .t-days{ font-size:17px; direction:ltr; }
    .t-bottom-doctor{ font-size:13px; }
    .t-bottom-date{ font-size:15px; direction:ltr; }

    #output-area {
      width: 90%;
      height: 150px;
      margin-top: 10px;
      background: #222;
      color: #0f0;
      font-family: monospace;
      direction: ltr;
      padding: 10px;
      border: 1px solid #555;
    }

    button.get-coords {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="instructions">
    <strong>מצב כיול:</strong><br>
    1. גרור את האלמנטים (הטקסטים המוקפים באדום) למקום המדויק.<br>
    2. בסיום לחץ על הכפתור הירוק למטה.<br>
    3. העתק את הטקסט שמופיע ושלח לי אותו.
  </div>

  <div id="scalable-wrapper">
    <div id="fixed-canvas">
      <img id="bgImage" src="mahala.jpg" onload="fitToScreen()" onerror="alert('שים תמונה mahala.jpg!')">

      <div class="draggable-item t-name" id="nameText" style="left: 50%; top: 30%;">שיין צרלס</div>
      <div class="draggable-item t-id" id="idText" style="left: 50%; top: 35%;">1-02737305/9</div>
      
      <div class="draggable-item t-date" id="fromText" style="left: 60%; top: 40%;">26/01/26</div>
      <div class="draggable-item t-date" id="toText" style="left: 45%; top: 40%;">28/01/26</div>
      <div class="draggable-item t-days" id="daysText" style="left: 30%; top: 40%;">3</div>

      <div class="draggable-item t-bottom-doctor" id="doctorText" style="left: 50%; top: 70%;">הופק במקור ע"י ד"ר ילדרמן אירינה...</div>
      <div class="draggable-item t-bottom-date" id="bottomDateText" style="left: 80%; top: 70%;">26/01/26</div>

    </div>
  </div>

  <button class="get-coords" onclick="generateReport()">✅ הצג נתוני מיקום להעתקה</button>
  <textarea id="output-area" placeholder="הנתונים יופיעו כאן..."></textarea>

  <script>
    // --- Scale Logic ---
    function fitToScreen(){
      const wrapper = document.getElementById('scalable-wrapper');
      const canvas  = document.getElementById('fixed-canvas');
      const originalWidth = 600;
      const availableWidth = wrapper.clientWidth || wrapper.offsetWidth;
      const scale = Math.min(availableWidth / originalWidth, 1);
      canvas.style.transform = `scale(${scale})`;
      
      if(canvas.clientHeight > 0) {
        wrapper.style.height = (canvas.clientHeight * scale) + "px";
      }
    }
    window.addEventListener('resize', fitToScreen);
    window.addEventListener('load', fitToScreen);

    // --- Drag Logic ---
    const draggables = document.querySelectorAll('.draggable-item');
    const container = document.getElementById('fixed-canvas');

    draggables.forEach(elm => {
      let isDragging = false;
      
      // Touch events
      elm.addEventListener('touchstart', (e) => {
        isDragging = true;
        e.preventDefault(); // Prevent scrolling
      }, {passive: false});

      elm.addEventListener('touchmove', (e) => {
        if(!isDragging) return;
        const touch = e.touches[0];
        moveElement(elm, touch.clientX, touch.clientY);
      }, {passive: false});

      elm.addEventListener('touchend', () => isDragging = false);

      // Mouse events
      elm.addEventListener('mousedown', (e) => {
        isDragging = true;
        e.preventDefault();
      });

      window.addEventListener('mousemove', (e) => {
        if(!isDragging) return;
        moveElement(elm, e.clientX, e.clientY);
      });

      window.addEventListener('mouseup', () => isDragging = false);
    });

    function moveElement(elm, clientX, clientY) {
      // Get container bounding rect
      const rect = container.getBoundingClientRect();
      
      // Calculate position relative to container (accounting for scale)
      // Since scale transforms the visual, we need to map clientX back to unscaled coordinate space?
      // Actually, easier: (clientX - rect.left) gives pixels from left edge of SCALED container.
      // Divide by rect.width to get percentage. This is robust regardless of scale.
      
      let xPercent = ((clientX - rect.left) / rect.width) * 100;
      let yPercent = ((clientY - rect.top) / rect.height) * 100;

      // Bound check (optional, keep inside 0-100)
      // xPercent = Math.max(0, Math.min(100, xPercent));
      // yPercent = Math.max(0, Math.min(100, yPercent));

      elm.style.left = xPercent.toFixed(2) + '%';
      elm.style.top = yPercent.toFixed(2) + '%';
    }

    function generateReport() {
      let report = "אנא העתק את השורות האלו:\n--------------------------\n";
      
      const items = [
        {id: 'nameText', name: 'שם מלא'},
        {id: 'idText', name: 'תעודת זהות'},
        {id: 'fromText', name: 'מתאריך'},
        {id: 'toText', name: 'עד תאריך'},
        {id: 'daysText', name: 'ימים'},
        {id: 'doctorText', name: 'רופא תחתון'},
        {id: 'bottomDateText', name: 'תאריך תחתון'}
      ];

      items.forEach(item => {
        const el = document.getElementById(item.id);
        report += `${item.id}: left: ${el.style.left}, top: ${el.style.top}\n`;
      });

      const area = document.getElementById('output-area');
      area.value = report;
      area.select(); // Auto select for easier copying
    }
  </script>
</body>
</html>
