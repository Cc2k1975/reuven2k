<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>תיק עבודות - פן אקספרס</title>
<style>
  :root{
    --gap:10px;
    --thumb-radius:12px;
    --open-dur:700ms;
    --shadow:0 10px 28px rgba(255,215,0,.25);
  }
  html,body{
    margin:0;
    background:#000;
    color:#d4af37;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }
  .wrap{max-width:980px;margin:14px auto 28px;padding:0 12px}
  h1{
    font-size:1.6rem;
    font-weight:900;
    margin:14px 4px;
    text-align:center;
    color:#ffd700;
  }
  .note{font-size:.9rem;color:#d4af37;margin:0 4px 10px;text-align:center}

  .gallery{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr));
    gap:var(--gap);
  }
  @media (min-width:700px){ .gallery{ grid-template-columns:repeat(3, minmax(0,1fr)) } }
  @media (min-width:1000px){ .gallery{ grid-template-columns:repeat(4, minmax(0,1fr)) } }

  .thumb{
    position:relative; overflow:hidden; border-radius:var(--thumb-radius);
    background:#222; aspect-ratio:1/1; box-shadow:0 1px 0 rgba(255,215,0,.1) inset;
  }
  .thumb img{
    width:100%; height:100%; object-fit:cover; display:block;
    transform:scale(0.975);
    transition:transform 200ms ease, filter 200ms ease;
  }
  .thumb:hover img{ transform:scale(1.0); filter:contrast(1.05) saturate(1.05) }

  .lightbox{
    position:fixed; inset:0; background:rgba(0,0,0,.86);
    display:flex; align-items:center; justify-content:center;
    opacity:0; pointer-events:none; transition:opacity var(--open-dur) ease; z-index:9999;
  }
  .lightbox.open{ opacity:1; pointer-events:auto }
  .lb-img-wrap{
    max-width:94vw; max-height:86vh;
    transform:translateY(12px) scale(.955);
    transition:transform var(--open-dur) cubic-bezier(.22,.7,.2,1);
  }
  .lightbox.open .lb-img-wrap{ transform:translateY(0) scale(1) }
  .lightbox img{
    max-width:94vw; max-height:86vh; width:auto; height:auto;
    border-radius:16px; box-shadow:var(--shadow); display:block;
  }

  .lb-close{
    position:fixed; top:18px; inset-inline-end:18px;
    width:52px; height:52px; border-radius:50%;
    background:rgba(255,255,255,.1); border:2px solid rgba(255,255,255,.25);
    color:#ff2d2d; font-weight:900; font-size:2rem; line-height:48px;
    text-align:center; cursor:pointer; user-select:none;
    backdrop-filter:saturate(150%) blur(6px);
    transition:transform 180ms ease, background 180ms ease;
  }
  .lb-close:hover{ transform:scale(1.15) rotate(5deg); background:rgba(255,255,255,.18) }

  .empty{
    background:#111; border:1px dashed #bfa76f; color:#d4af37;
    padding:18px; border-radius:12px; text-align:center; margin-top:14px;
  }

  footer{
    text-align:center; font-size:.75rem; color:#bfa76f; margin:18px 0 6px;
  }
  .bottom-info{
    text-align:center; font-size:.8rem; color:#bfa76f; margin-bottom:20px;
  }

  .toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    background:#111; color:#ffd700; font-size:.85rem; padding:10px 14px;
    border-radius:10px; box-shadow:0 8px 24px rgba(255,215,0,.25);
    opacity:0; pointer-events:none; transition:opacity 300ms ease;
    z-index:10000;
  }
  .toast.show{ opacity:1 }

  .back-btn, .nav-btn {
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    margin:0 auto 22px;
    padding:12px 18px;
    max-width:240px;
    background:#000;
    color:#ffd700;
    border:1px solid #ffd700;
    border-radius:10px;
    font-size:1rem;
    font-weight:700;
    text-align:center;
    text-decoration:none;
    box-shadow:0 0 12px rgba(255,215,0,0.25);
    transition:all .25s ease;
  }
  .back-btn:hover, .nav-btn:hover {
    background:#ffd700;
    color:#000;
    transform:scale(1.05);
  }
  .back-btn img, .nav-btn img {
    width:20px;
    height:20px;
    vertical-align:middle;
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>תיק עבודות - פן אקספרס</h1>

    <a href="https://reuven2k.com/mayfen.html" class="back-btn">
      <img src="https://cdn-icons-png.flaticon.com/512/685/685655.png" alt="גלריה" />
      חזרה להזמנת תור
    </a>

    <a href="https://waze.com/ul?ll=33.003292%2C35.108864&navigate=yes" class="nav-btn" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Waze_logo.svg" alt="Waze" />
      נווט ל פן־אקספרס
    </a>

    <div id="gallery" class="gallery" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none"></div>
  </div>

  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="תצוגת תמונה מוגדלת">
    <button class="lb-close" id="lbClose" aria-label="סגור">×</button>
    <div class="lb-img-wrap"><img id="lbImg" alt=""></div>
  </div>

  <footer id="versionFooter">גרסה: v1.06</footer>
  <div class="bottom-info" id="dbg"></div>
  <div id="toast" class="toast">התמונות עודכנו</div>

<script>
const VERSION = "v1.06";
document.getElementById("versionFooter").textContent = "גרסה: " + VERSION;

const CFG = { user:"Cc2k1975", repo:"reuven2k", branch:"main", path:"images" };
const REFRESH_MS = 30000;
const IMG_EXTS = ["jpg","jpeg","png","gif","webp","avif"];
const dbgEl = document.getElementById("dbg");
const toastEl = document.getElementById("toast");
let lastSignature = "";

function setDebug(msg){ dbgEl.textContent = msg; console.log("[gallery]", msg); }
function showEmpty(msg){ const el=document.getElementById("empty"); el.style.display="block"; el.innerHTML=msg; }
function showToast(text="התמונות עודכנו"){ toastEl.textContent=text; toastEl.classList.add("show"); setTimeout(()=>toastEl.classList.remove("show"),1800); }

async function loadImagesFromGithub(){
  const {user,repo,branch,path}=CFG;
  const api=`https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
  const res=await fetch(api);
  if(!res.ok){ showEmpty("שגיאה בטעינה ("+res.status+")"); throw new Error("GitHub API error"); }
  const items=await res.json();
  return items.filter(it=>it.type==="file" && IMG_EXTS.includes(it.name.split(".").pop().toLowerCase())).map(it=>it.download_url).sort((a,b)=>a.localeCompare(b));
}

function createThumb(src){
  const div=document.createElement("div"); div.className="thumb";
  const img=document.createElement("img");
  img.src=src; img.loading="lazy"; img.decoding="async"; img.alt="עבודה";
  div.appendChild(img); div.addEventListener("click",()=>openLightbox(src));
  return div;
}
function renderGallery(urls){
  const gal=document.getElementById("gallery"); gal.innerHTML="";
  if(!urls.length){ showEmpty("אין קבצי תמונה בתיקייה"); return; }
  document.getElementById("empty").style.display="none";
  urls.forEach(u=>gal.appendChild(createThumb(u)));
  setDebug(`נטענו בהצלחה. סה״כ תמונות: ${urls.length}`);
}

const lb=document.getElementById("lightbox");
const lbImg=document.getElementById("lbImg");
const lbClose=document.getElementById("lbClose");
function openLightbox(src){ lbImg.src=src; lb.classList.add("open"); lb.setAttribute("aria-hidden","false"); document.body.style.overflow="hidden"; }
function closeLightbox(){ lb.classList.remove("open"); lb.setAttribute("aria-hidden","true"); setTimeout(()=>{lbImg.src="";},300); document.body.style.overflow=""; }
lb.addEventListener("click",(e)=>{ if(e.target===lb||e.target===lbClose) closeLightbox(); });
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeLightbox(); });

function signature(arr){ return arr.join("|"); }
async function refreshGallery(silent=false){
  try{
    const urls=await loadImagesFromGithub();
    const sig=signature(urls);
    if(sig!==lastSignature){
      renderGallery(urls);
      if(lastSignature && !silent) showToast();
      lastSignature=sig;
    }
  }catch(e){ console.error(e); }
}

(async function init(){
  await refreshGallery(true);
  setInterval(refreshGallery, REFRESH_MS);
})();
</script>
</body>
</html>
