<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Charles BBQ â€“ ×¨×©×™××ª ×§× ×™×•×ª ×¢×œ ×”××©</title>

<style>
/* ----- ××™×Ÿ ×©×™× ×•×™ ×¤×” ×‘×›×œ×œ ----- */
:root{
    --bg-top:#0f172a;
    --bg-bottom:#1e293b;
    --card-bg:#ffffff;
    --card-radius:16px;
    --card-shadow:0 12px 30px rgba(15,23,42,0.35);
    --accent:#f97316;
    --accent-soft:#fff7ed;
    --accent-strong:#ea580c;
    --text-main:#0f172a;
    --text-muted:#6b7280;
    --chip-bg:#e5e7eb;
}
*{box-sizing:border-box;}
body{
    margin:0;
    min-height:100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
    background:linear-gradient(to bottom,var(--bg-top),var(--bg-bottom));
    color:#fff;
    padding:16px 12px 80px;
}
.app-shell{max-width:900px;margin:0 auto;}
.hero{text-align:center;margin-bottom:18px;}
.hero-badge{
    display:inline-flex;align-items:center;gap:6px;
    background:rgba(15,23,42,0.9);
    border:1px solid rgba(148,163,184,0.7);
    border-radius:999px;padding:4px 10px;font-size:11px;margin-bottom:6px;
}
.hero-badge-dot{width:8px;height:8px;border-radius:999px;background:#22c55e;box-shadow:0 0 10px rgba(34,197,94,0.9);}
.hero-title{font-size:26px;font-weight:800;letter-spacing:.08em;cursor:pointer;}
.hero-sub{font-size:14px;color:#cbd5f5;}

.card{
    background:var(--card-bg);
    border-radius:var(--card-radius);
    box-shadow:var(--card-shadow);
    padding:14px;margin-bottom:16px;
}
.card-header{
    display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;
}
.card-title{font-size:17px;font-weight:700;color:var(--text-main);}
.card-tag{
    font-size:11px;padding:2px 8px;border-radius:999px;
    background:var(--chip-bg);color:var(--text-muted);
}

.row{
    display:grid;grid-template-columns:1.6fr auto auto;
    column-gap:6px;align-items:center;
    padding:8px 0;border-bottom:1px solid #e5e7eb;font-size:14px;
}
.row:last-child{border-bottom:none;}
.row label{display:flex;align-items:center;gap:6px;color:var(--text-main);}
.row-amount,.row-cost{text-align:center;color:var(--text-main);}
.amount-label,.cost-label{font-size:11px;color:var(--text-muted);margin-bottom:2px;}
.amount-value{font-size:15px;font-weight:700;}
.cost-value{font-size:17px;font-weight:800;}

.people-input input{
    width:120px;padding:7px 10px;font-size:16px;
    border-radius:999px;border:1px solid #cbd5e1;text-align:center;
}

.summary-box{
    background:var(--accent-soft);border-radius:14px;
    padding:10px 12px;
}
.summary-label{font-size:13px;color:var(--text-muted);}
.summary-value-main{
    font-size:22px;font-weight:800;color:var(--accent-strong);
}

.section-title{
    font-size:13px;text-transform:uppercase;
    letter-spacing:.1em;color:var(--text-muted);margin-bottom:4px;
}

.footer-buttons{
    position:fixed;bottom:0;left:0;right:0;background:#0f172a;
    padding:10px 12px;display:grid;grid-template-columns:repeat(3,1fr);
    gap:8px;box-shadow:0 -6px 16px rgba(0,0,0,0.4);z-index:20;
}
button{
    border:none;border-radius:999px;padding:10px;
    font-size:14px;font-weight:600;cursor:pointer;
    display:flex;align-items:center;justify-content:center;gap:6px;
}
.btn-print{background:#1e293b;color:#e5e7eb;}
.btn-pdf{background:#22c55e;color:#052e16;}
.btn-whatsapp{background:#25d366;color:white;}

@media print{
    body{background:#ffffff;padding:0;}
    .footer-buttons{display:none !important;}
    .card{box-shadow:none;border-radius:0;margin:0 0 6px;}
    .hero-badge{display:none;}
}

.admin-overlay{
    position:fixed;inset:0;background:rgba(15,23,42,0.85);
    display:none;align-items:center;justify-content:center;z-index:50;
}
.admin-panel{
    background:#ffffff;color:var(--text-main);
    border-radius:16px;padding:16px;width:90%;max-width:500px;max-height:80vh;
    box-shadow:0 18px 40px rgba(0,0,0,0.6);
    display:flex;flex-direction:column;
}
.admin-title{font-size:18px;font-weight:700;margin-bottom:4px;}
.admin-sub{font-size:12px;color:var(--text-muted);margin-bottom:10px;}
.admin-list{
    flex:1;overflow-y:auto;
    border-top:1px solid #e5e7eb;border-bottom:1px solid #e5e7eb;
    margin:8px 0;
}
.admin-row{
    display:grid;grid-template-columns:1.5fr auto auto;
    gap:6px;align-items:center;
    padding:6px 0;border-bottom:1px solid #f3f4f6;font-size:14px;
}
.admin-row:last-child{border-bottom:none;}
.admin-name{font-weight:600;}
.admin-row input{
    width:80px;padding:4px 6px;border-radius:999px;
    border:1px solid #cbd5e1;text-align:center;
}
.admin-unit{font-size:13px;color:var(--text-muted);}
.admin-buttons{display:flex;justify-content:flex-end;gap:8px;margin-top:6px;}
.admin-btn{
    padding:7px 12px;border-radius:999px;border:none;
    cursor:pointer;font-size:13px;font-weight:600;
}
.admin-cancel{background:#e5e7eb;color:#374151;}
.admin-save{background:#22c55e;color:#052e16;}
</style>
</head>

<body>
<div class="app-shell">

    <!-- HEADER -->
    <div class="hero">
        <div class="hero-badge">
            <span class="hero-badge-dot"></span>
            <span>××—×©×‘×•×Ÿ ×¢×œ ×”××© â€“ CHARLES BBQ</span>
        </div>
        <div id="heroTitle" class="hero-title">CHARLES BBQ</div>
        <div class="hero-sub">××›× ×™×¡×™× ××¡×¤×¨ ×¡×•×¢×“×™×, ××¡×× ×™× ××” ×§×•× ×™× â€“ ×•×”××—×©×‘×•×Ÿ ×¢×•×©×” ××ª ×›×œ ×”×—×™×©×•×‘×™×</div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×›××•×ª ××©×ª×ª×¤×™×</div>
            <div class="card-tag">×©×œ×‘ 1</div>
        </div>
        <div class="people-input">
            <input id="people" type="number" value="1" min="1" oninput="calc()">
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×¡×™×›×•× ×”×•×¦××”</div>
            <div class="card-tag">××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª</div>
        </div>
        <div class="summary-box">
            <div class="summary-label">×¡×”×´×› ×”×•×¦××”</div>
            <div class="summary-value-main"><span id="totalCost">0.00</span> â‚ª</div>

            <div class="summary-label" style="margin-top:8px;">×œ×›×œ ××©×ª×ª×£</div>
            <div class="summary-value-main"><span id="perPerson">0.00</span> â‚ª</div>

            <div class="summary-label" style="margin-top:8px;">×›××•×ª ×‘×©×¨ ×œ×¡×•×¢×“ (×’×¨×)</div>
            <div class="summary-value-main"><span id="meatPerPerson">0</span> ×’×¨×</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×‘×©×¨×™× ×•×“×’×™×</div>
            <div class="card-tag">×›××•×ª ××—×•×©×‘×ª ×œ×¤×™ ×¡×•×¢×“×™×</div>
        </div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="meatList"></div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×¡×œ×˜×™×, ×ª×•×¡×¤×•×ª ×•×œ×—××™×</div>
            <div class="card-tag">×›×•×œ×œ ×¡×œ×˜×™×, ×¤×™×ª×•×ª, ×™×¨×§×•×ª</div>
        </div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="sidesList"></div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×©×ª×™×™×” ×•×§×™× ×•×—×™×</div>
            <div class="card-tag">×©×ª×™×™×” ××ª×•×§×”, ××™×, ×‘×™×¨×”, ×™×™×Ÿ, ×§×™× ×•×—</div>
        </div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="drinksList"></div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×—×“×´×¤, × ×™×§×™×•×Ÿ ×•×ª×¤×¢×•×œ</div>
            <div class="card-tag">×¤×—××™×, ×’×–, ×—×“×´×¤, ×“×œ×§ ×•×¢×•×“</div>
        </div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="otherList"></div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×œ× ×œ×©×›×•×— ×œ×§×—×ª</div>
            <div class="card-tag">×¦×™×•×“ ×—×©×•×‘ ×œ×× ×’×œ</div>
        </div>
        <div id="noForgetList"></div>
    </div>

</div>

<div class="footer-buttons">
    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ×”×“×¤×¡</button>
    <button class="btn-pdf" onclick="window.print()">ğŸ“„ PDF</button>
    <button class="btn-whatsapp" onclick="sendWhatsapp()">ğŸŸ¢ ×•×•×¦××¤</button>
</div>

<!-- ×—×œ×•×Ÿ ××“××™×Ÿ -->
<div id="adminOverlay" class="admin-overlay">
    <div class="admin-panel">
        <div class="admin-title">×”×’×“×¨×ª ××—×™×¨×™× â€“ ××¦×‘ ×× ×”×œ</div>
        <div class="admin-sub">×œ×—×¦×ª 3 ×©× ×™×•×ª ×¢×œ CHARLES BBQ â€“ ×›××Ÿ ××¤×©×¨ ×œ×¢×“×›×Ÿ ××—×™×¨×™ ××•×¦×¨×™×. ×”× ×ª×•× ×™× × ×©××¨×™× ×‘×“×¤×“×¤×Ÿ.</div>
        <div id="adminList" class="admin-list"></div>
        <div class="admin-buttons">
            <button class="admin-btn admin-cancel" onclick="closeAdmin()">×‘×™×˜×•×œ</button>
            <button class="admin-btn admin-save" onclick="saveAdmin()">×©××™×¨×ª ××—×™×¨×™×</button>
        </div>
    </div>
</div>

<script>
/* ------------------------------------------------------
   × ×ª×•× ×™× × ×˜×¢× ×™× ××”×©×¨×ª â€“ ×‘××§×•× DATA ×”×§×‘×•×¢×”
------------------------------------------------------ */

let DATA = [];
const JSON_URL = "https://reuven2k.com/data/meat.json";

/* ××•×¦×¨×™× ××¡×•×’ ×™×—×™×“×•×ª (×œ× ×§"×’) */
const UNIT_ITEMS = new Set([
    "×¡×œ×˜","×¤×™×ª×”","× ×¢× ×¢","×‘×§×‘×•×§ ×©×ª×™×” ××ª×•×§×”",
    "×‘×™×¨×”","×™×™×Ÿ","××™×","×¤×—××™×","×©××Ÿ",
    "× ×™×™×¨ × ×™×’×•×‘ (×—×‘×™×œ×” ×©×œ 6)","×¡×›×•× + ×¦×œ×—×•×ª",
    "×ª×‘× ×™×•×ª ××œ×•××™× ×™×•×","××™×›×œ ×’×–"
]);

/* ×¤×¨×™×˜×™× ×©×ª××™×“ ×›××•×ª× 1 */
const FIXED_ITEMS = new Set([
    "× ×¢× ×¢","×¤×—××™×","×©××Ÿ","×“×œ×§",
    "× ×™×™×¨ × ×™×’×•×‘ (×—×‘×™×œ×” ×©×œ 6)",
    "×ª×‘× ×™×•×ª ××œ×•××™× ×™×•×","××™×›×œ ×’×–"
]);

/* ×¨×©×™××ª "×œ× ×œ×©×›×•×—" */
const NO_FORGET = [
    "×× ×’×œ","××œ×§×—×™×™×","×’× ×¨×˜×•×¨","×§×•×‘×™×ª ×›×•×—","×’×¨×™×œ× ×“×”","×¤×¨×•×–×§×˜×•×¨",
    "××™×›×œ ×“×œ×§","×©×•×œ×—× ×•×ª","×‘×•×¦×¨×™×","×¡×›×™× ×™×","×¤×œ×¤×œ ××œ×—",
    "××¤×¦×œ ×—×©××œ","×××¨×™×š ×—×©××œ","×›×™×¡××•×ª","××§×¨×Ÿ",
    "×¢×¨×›×ª ×¢×–×¨×” ×¨××©×•× ×”","××¤×ª ×©×•×œ×—×Ÿ","×¦×™×“× ×™×•×ª","×§×¨×—×•× ×™×","×’×–×™×•×ª","×¨×›×‘ ×’×“×•×œ"
];

/* ------------------------------------------------------
   ×˜×¢×™× ×ª ×”××•×¦×¨×™× ××”×©×¨×ª
------------------------------------------------------ */
async function loadDataFromServer(){
    try{
        const res = await fetch(JSON_URL);
        DATA = await res.json();

        applySavedPrices();   // ×˜×•×¢×Ÿ ×¢×¨×›×™× ×©×©×•× ×• ×‘×× ×”×œ
        renderLists();        // ×‘×•× ×” ××ª ×›×œ ×”×©×•×¨×•×ª
        calc();               // ××—×©×‘ ×›××• ×ª××™×“
    } catch(err){
        console.error("Error loading meat.json", err);
        alert("×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ×¨×©×™××ª ××•×¦×¨×™× ××”×©×¨×ª");
    }
}

/* ×©××™×¨×ª ××—×™×¨×™× ××§×•××™×ª */
function applySavedPrices(){
    try{
        const raw = localStorage.getItem("charlesBBQPrices");
        if(!raw) return;
        const map = JSON.parse(raw);
        DATA = DATA.map(item=>{
            if(map[item.name] != null){
                return {...item, price:Number(map[item.name])};
            }
            return item;
        });
    }catch(e){ console.log("load error", e); }
}

/* ------------------------------------------------------
   ×™×¦×™×¨×ª ×©×•×¨×•×ª (××•×ª×• ×“×‘×¨ ×›××• ×§×•×“×)
------------------------------------------------------ */
function buildRow(item){
    const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
    const labelText = UNIT_ITEMS.has(item.name) ? "×™×—×™×“×•×ª" : "××©×§×œ (×§×´×’)";
    return `
        <div class="row">
            <label>
                <input type="checkbox" data-name="${id}" onchange="calc()">
                ${item.name}
            </label>
            <div class="row-amount">
                <div class="amount-label">${labelText}</div>
                <div class="amount-value" id="amount-${id}">0.00</div>
            </div>
            <div class="row-cost">
                <div class="cost-label">××—×™×¨ (â‚ª)</div>
                <div class="cost-value" id="cost-${id}">0.0</div>
            </div>
        </div>
    `;
}

/* ------------------------------------------------------
   ×‘× ×™×™×ª ×›×œ ×”×¨×©×™××•×ª
------------------------------------------------------ */
function renderLists(){
    DATA.forEach(item=>{
        const html = buildRow(item);

        if(item.category==="meat")   meatList.insertAdjacentHTML("beforeend", html);
        if(item.category==="sides")  sidesList.insertAdjacentHTML("beforeend", html);
        if(item.category==="drinks") drinksList.insertAdjacentHTML("beforeend", html);
        if(item.category==="other")  otherList.insertAdjacentHTML("beforeend", html);
    });

    NO_FORGET.forEach(n=>{
        noForgetList.insertAdjacentHTML(
            "beforeend",
            `<div class="row"><label><input type="checkbox"> ${n}</label></div>`
        );
    });
}

/* ------------------------------------------------------
   ×—×™×©×•×‘ ×›××• ×”××§×•×¨ 1:1
------------------------------------------------------ */
function calc(){
    const people = Number(document.getElementById("people").value) || 1;
    let total = 0, meatKg = 0;

    DATA.forEach(item=>{
        const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
        const cb = document.querySelector(`input[data-name="${id}"]`);

        if(cb && cb.checked){
            let amount = FIXED_ITEMS.has(item.name)
                ? 1
                : item.perPerson * people;

            const cost = amount * item.price;

            document.getElementById(`amount-${id}`).textContent = amount.toFixed(2);
            document.getElementById(`cost-${id}`).textContent   = cost.toFixed(1);

            total += cost;
            if(item.category==="meat") meatKg += amount;

        } else {
            document.getElementById(`amount-${id}`).textContent = "0.00";
            document.getElementById(`cost-${id}`).textContent   = "0.0";
        }
    });

    totalCost.textContent = total.toFixed(2);
    perPerson.textContent = (total / people).toFixed(2);

    meatPerPerson.textContent = ((meatKg / people) * 1000).toFixed(0);
}

/* ------------------------------------------------------
   ×•×•×¦××¤ ×›××• ×”××§×•×¨×™
------------------------------------------------------ */
function sendWhatsapp(){
    const total = totalCost.textContent;
    const per = perPerson.textContent;
    const meatPer = meatPerPerson.textContent;
    const people = peopleInput.value;

    let msg = `ğŸ”¥ Charles BBQ â€“ ×¨×©×™××ª ×§× ×™×•×ª ×œ×× ×’×œ\n`;
    msg += `××©×ª×ª×¤×™×: ${people}\n`;
    msg += `×¡×”\"×› ×”×•×¦××”: ${total} â‚ª\n`;
    msg += `×œ×›×œ ××©×ª×ª×£: ${per} â‚ª\n`;
    msg += `×›××•×ª ×‘×©×¨ ×œ×¡×•×¢×“: ${meatPer} ×’×¨×\n\n`;
    msg += `×¤×¨×™×˜×™× ×©×¡×™×× ×ª×™:\n`;

    DATA.forEach(item=>{
        const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
        const cb = document.querySelector(`input[data-name="${id}"]`);
        const amount = document.getElementById(`amount-${id}`)?.textContent || "0";
        const cost   = document.getElementById(`cost-${id}`)?.textContent || "0";
        const unit = UNIT_ITEMS.has(item.name) ? "×™×—×™×“×•×ª" : "×§\"×’";

        if(cb && cb.checked){
            msg += `â€¢ ${item.name} â€“ ${amount} ${unit} â€“ ××—×™×¨ ${cost} â‚ª\n`;
        }
    });

    window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(msg), "_blank");
}

/* ------------------------------------------------------
   ×—×œ×•×Ÿ ×× ×”×œ â€“ ×œ×œ× ×©×™× ×•×™ ×›×œ×œ
------------------------------------------------------ */
function openAdmin(){
    adminList.innerHTML = "";
    DATA.forEach((item,idx)=>{
        adminList.insertAdjacentHTML(
            "beforeend",
            `<div class="admin-row">
                <span class="admin-name">${item.name}</span>
                <input type="number" step="0.1" min="0" value="${item.price}" data-idx="${idx}">
                <span class="admin-unit">â‚ª ×œ×™×—×™×“×”</span>
             </div>`
        );
    });

    adminOverlay.style.display = "flex";
}

function closeAdmin(){ adminOverlay.style.display = "none"; }

function saveAdmin(){
    const inputs = document.querySelectorAll("#adminList input[data-idx]");
    const map = {};

    inputs.forEach(i=>{
        const idx = Number(i.dataset.idx);
        const v = parseFloat(i.value);
        if(!isNaN(v)){
            DATA[idx].price = v;
            map[DATA[idx].name] = v;
        }
    });

    localStorage.setItem("charlesBBQPrices", JSON.stringify(map));
    closeAdmin();
    calc();
}

/* ×œ×—×™×¦×” ××¨×•×›×” */
function setupLongPress(){
    let timer=null;
    heroTitle.addEventListener("mousedown", ()=>{ timer=setTimeout(openAdmin,3000); });
    heroTitle.addEventListener("mouseup", ()=>{ clearTimeout(timer); });
}
setupLongPress();

/* ------------------------------------------------------
   ×”×ª×—×œ×ª ×˜×¢×™× ×ª ×”× ×ª×•× ×™×
------------------------------------------------------ */
loadDataFromServer();
</script>

</body>
</html>
