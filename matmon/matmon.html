<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××©×—×§ ×”××˜××•×Ÿ - Cc2k1975</title>
    <style>
        body { font-family: system-ui; background: #000; color: white; margin: 0; overflow: hidden; height: 100vh; touch-action: none; }
        #ui-layer { position: absolute; top: 0; width: 100%; z-index: 100; background: rgba(0,0,0,0.7); padding: 10px; text-align: center; pointer-events: none; }
        #timer-display { font-size: 24px; color: #e74c3c; font-weight: bold; margin-top: 5px; }
        #instruction-display { font-size: 18px; color: #f1c40f; margin-top: 5px; }
        #game-viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        #world { position: relative; transform-origin: center; width: 100%; display: flex; align-items: center; justify-content: center; }
        #game-image { width: 100%; height: auto; pointer-events: none; }
        #hidden-object { position: absolute; z-index: 50; line-height: 1; display: none; white-space: nowrap; transform: translate(-50%, -50%); user-select: none; -webkit-user-select: none; pointer-events: auto; }
        #admin-panel { display: none; position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(30, 39, 46, 0.95); padding: 12px; border-radius: 20px; border: 2px solid #f1c40f; z-index: 1000; width: 95%; max-width: 420px; max-height: 80vh; overflow-y: auto; }
        .mode-selector { display: flex; gap: 10px; margin-bottom: 10px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 10px; border: 2px solid #555; background: #1e272e; color: white; font-weight: bold; }
        .mode-btn.active { background: #f1c40f; color: black; }
        .emoji-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin: 10px 0; }
        .emoji-btn { font-size: 20px; background: #34495e; border: none; padding: 5px; border-radius: 5px; }
        .btn-group { display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap; }
        .btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .save-btn { background: #2ecc71; color: white; }
        .refresh-btn { background: #3498db; color: white; padding: 5px 10px; font-size: 12px; border-radius: 5px; margin-right: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="ui-layer">
        <div>×©×œ×‘: <span id="level-num">1</span> / 20</div>
        <div id="instruction-display">×”×›×Ÿ ××ª ×¢×¦××š...</div>
        <div id="timer-display">30</div>
    </div>

    <div id="game-viewport">
        <div id="world">
            <img id="game-image" src="1.png">
            <div id="hidden-object"></div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="mode-selector">
            <button id="btn-mode-img" class="mode-btn active" onclick="setEditMode('IMAGE')">ğŸ–¼ï¸ ×”×–×– ×ª××•× ×”</button>
            <button id="btn-mode-obj" class="mode-btn" onclick="setEditMode('OBJECT')">ğŸ‰ ×”×–×– ×¤×¨×™×˜</button>
        </div>
        <input type="text" id="stage-instruction" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:none;" placeholder="××©×™××” ×œ×©×œ×‘?">
        <div style="background: #34495e; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
            <label style="font-size: 12px;">×˜×©×˜×•×©: <span id="blur-val">0</span>px</label>
            <input type="range" id="blur-slider" min="0" max="5" step="0.1" value="0" style="width:100%" oninput="updateBlur(this.value)">
        </div>
        <div style="display:flex; flex-direction: column; gap:10px; margin-bottom: 10px;">
            <div style="display:flex; align-items: center;">
                <label style="margin-left:10px;">×©×œ×‘:</label>
                <select id="stage-select" style="flex:1; padding:8px; border-radius:5px;" onchange="loadStage()">
                    <script>for(let i=0; i<20; i++) document.write(`<option value="${i}">×©×œ×‘ ${i+1}</option>`)</script>
                </select>
            </div>
            <div style="display:flex; align-items: center;">
                <label style="margin-left:10px;">×ª××•× ×”:</label>
                <select id="bg-select" style="flex:1; padding:8px; border-radius:5px;" onchange="updateBG()">
                    <option value="1.png">×ª××•× ×” 1</option>
                    <option value="2.png">×ª××•× ×” 2</option>
                    <option value="3.png">×ª××•× ×” 3</option>
                </select>
                <button class="refresh-btn" onclick="updateBG()">ğŸ”„</button>
            </div>
        </div>
        <div class="emoji-grid">
            <script>['ğŸ‰','ğŸš—','ğŸ¤','ğŸ’','ğŸ•','âš½','ğŸš€','ğŸ¦','ğŸ¸','ğŸ©','ğŸš','ğŸ•¶ï¸','ğŸ”‘','ğŸ„','ğŸ§¸','ğŸš²','ğŸ¦€','ğŸ¦‹','âš“','ğŸ'].forEach(e => document.write(`<button class="emoji-btn" onclick="setEmoji('${e}')">${e}</button>`));</script>
        </div>
        <div class="btn-group">
            <button class="btn save-btn" onclick="saveStage()">ğŸ’¾ ×©××•×¨</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="exportData()">ğŸ“‹ ×”×¢×ª×§ ×§×•×“</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="toggleAdmin(false)">âœ– ×¡×’×•×¨</button>
        </div>
    </div>

    <script>
        const HARDCODED_DATA = [{"emoji":"ğŸ‰","bg":"1.png","x":32.68,"y":55.72,"size":9.6,"blur":0.3,"text":"××¦× ××ª ×”××‘×˜×™×—"},{"emoji":"ğŸš—","bg":"1.png","x":35.23,"y":52.49,"size":5.7,"blur":0.3,"text":"××¦× ××ª ×”××›×•× ×™×ª"},{"emoji":"ğŸ§¸","bg":"1.png","x":41.72,"y":37.22,"size":6,"blur":0.2,"text":"××¦× ××ª ×”×“×•×‘×™"},{"emoji":"ğŸ¸","bg":"1.png","x":54.49,"y":56.88,"size":7.4,"blur":0.2,"text":"××¦× ××ª ×”×’×™×˜×¨×”"},{"emoji":"ğŸš²","bg":"1.png","x":41.17,"y":37.27,"size":6.5,"blur":0,"text":"××¦× ××ª ×”××•×¤× ×™×™×"},{"emoji":"âš½","bg":"1.png","x":70.72,"y":50.22,"size":4.7,"blur":0.3,"text":"××¦× ××ª ×”×›×“×•×¨×’×œ"},{"emoji":"ğŸš€","bg":"1.png","x":87.24,"y":39.17,"size":4.9,"blur":0.2,"text":"××¦× ××ª ×”×˜×™×œ"},{"emoji":"ğŸš","bg":"1.png","x":19.97,"y":74.32,"size":12.2,"blur":0,"text":"××¦× ××ª ×”××¡×•×§"},{"emoji":"ğŸ„","bg":"1.png","x":44.0,"y":45.93,"size":4,"blur":0.2,"text":"××¦× ××ª ×”×¤×˜×¨×™×”"},{"emoji":"ğŸ•","bg":"1.png","x":16.87,"y":53.7,"size":8,"blur":0,"text":"××¦× ××ª ×”×¤×™×¦×”"}];
        while(HARDCODED_DATA.length < 20) HARDCODED_DATA.push({"emoji":"ğŸ‰","bg":"1.png","x":50,"y":50,"size":35,"blur":0,"text":"×©×œ×‘ ×¢×¨×™×›×”"});

        let gameData = JSON.parse(localStorage.getItem('myGameData')) || HARDCODED_DATA;
        let currentLevel = 0, isAdminOpen = false, editTarget = 'IMAGE', pressTimer, foundTimer;
        let scale = 1, lastDist = 0, objSize = 35, posX = 0, posY = 0, startX = 0, startY = 0;
        let timeLeft = 30, timerInterval;

        const world = document.getElementById('world'), viewport = document.getElementById('game-viewport');
        const obj = document.getElementById('hidden-object'), img = document.getElementById('game-image');
        const admin = document.getElementById('admin-panel'), timerEl = document.getElementById('timer-display');

        function loadStage() {
            let idx = isAdminOpen ? document.getElementById('stage-select').value : currentLevel;
            let data = gameData[idx];
            document.getElementById('level-num').innerText = parseInt(idx) + 1;
            document.getElementById('instruction-display').innerText = data.text || '×—×¤×© ××ª ×”××•×‘×™×™×§×˜';
            img.src = data.bg;
            img.onload = () => {
                obj.innerText = data.emoji;
                obj.style.left = data.x + '%';
                obj.style.top = data.y + '%';
                objSize = data.size || 35;
                obj.style.fontSize = objSize + 'px';
                obj.style.filter = `blur(${data.blur || 0}px)`;
                obj.style.display = 'block';
            };
            if(isAdminOpen) {
                document.getElementById('bg-select').value = data.bg;
                document.getElementById('stage-instruction').value = data.text || '';
                document.getElementById('blur-slider').value = data.blur || 0;
                document.getElementById('blur-val').innerText = data.blur || 0;
            }
        }

        viewport.ontouchstart = (e) => {
            if(isAdminOpen) {
                if(e.touches.length === 1) {
                    startX = e.touches[0].clientX - (editTarget === 'IMAGE' ? posX : 0);
                    startY = e.touches[0].clientY - (editTarget === 'IMAGE' ? posY : 0);
                }
                return;
            }
            clearTimeout(pressTimer);
            pressTimer = setTimeout(() => {
                if(prompt("×¡×™×¡××”:") === "4451") toggleAdmin(true);
            }, 10000);
            if(e.touches.length === 1) { startX = e.touches[0].clientX - posX; startY = e.touches[0].clientY - posY; }
        };

        viewport.ontouchend = () => { clearTimeout(pressTimer); clearTimeout(foundTimer); lastDist = 0; };

        viewport.ontouchmove = (e) => {
            e.preventDefault();
            clearTimeout(pressTimer);
            clearTimeout(foundTimer);
            if(isAdminOpen && editTarget === 'OBJECT') {
                if(e.touches.length === 1) {
                    let rect = img.getBoundingClientRect();
                    obj.style.left = ((e.touches[0].clientX - rect.left) / rect.width) * 100 + '%';
                    obj.style.top = ((e.touches[0].clientY - rect.top) / rect.height) * 100 + '%';
                }
            } else {
                if(e.touches.length === 1) { posX = e.touches[0].clientX - startX; posY = e.touches[0].clientY - startY; }
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);
                    if(lastDist > 0) { scale *= (dist / lastDist); scale = Math.max(1, Math.min(5, scale)); }
                    lastDist = dist;
                }
            }
            updateTransform();
        };

        // --- ×”×ª×™×§×•×Ÿ ×¢× ×–×•× ×’×‘×•×” × ×’×“ ×¨×××™× ---
        obj.ontouchstart = (e) => {
            if(isAdminOpen) return;
            
            // ×”×©×—×§×Ÿ ×—×™×™×‘ ×œ×”×’×“×™×œ ××ª ×”×ª××•× ×” ×¤×™ 2.5 ×›×“×™ ×©×™×•×›×œ ×œ×œ×—×•×¥!
            if(scale < 2.5) return; 

            e.stopPropagation();
            foundTimer = setTimeout(() => { success(); }, 50); 
        };

        function success() {
            clearInterval(timerInterval);
            if (currentLevel === 19) {
                alert("×›×œ ×”×›×‘×•×“! ×”×’×¢×ª ×œ×©×œ×‘ ×”××—×¨×•×Ÿ ğŸ†\n\n×‘×¦×¢ ×¦×™×œ×•× ××¡×š ×›×¢×ª, ×’×© ×œ×¦'×¨×œ×™ ×•×ª×§×‘×œ 100 ×©×§×œ!");
            } else {
                alert("××¦××ª!");
                currentLevel++;
                resetView(); loadStage(); startTimer();
            }
        }

        function resetView() { scale = 1; posX = 0; posY = 0; updateTransform(); }
        function updateTransform() { world.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`; }
        function toggleAdmin(show) { isAdminOpen = show; admin.style.display = show ? 'block' : 'none'; if(!show) { resetView(); startTimer(); } else clearInterval(timerInterval); loadStage(); }
        function saveStage() { let idx = document.getElementById('stage-select').value; gameData[idx] = { emoji: obj.innerText, bg: document.getElementById('bg-select').value, x: parseFloat(obj.style.left), y: parseFloat(obj.style.top), size: parseFloat(objSize), blur: parseFloat(document.getElementById('blur-slider').value), text: document.getElementById('stage-instruction').value }; localStorage.setItem('myGameData', JSON.stringify(gameData)); alert("× ×©××¨!"); }
        function exportData() { saveStage(); navigator.clipboard.writeText(JSON.stringify(gameData)).then(() => alert("×”×§×•×“ ×”×•×¢×ª×§!")); }
        function updateBlur(v) { document.getElementById('blur-val').innerText = v; obj.style.filter = `blur(${v}px)`; }
        function updateBG() { img.src = document.getElementById('bg-select').value; }
        function setEmoji(e) { obj.innerText = e; }
        function startTimer() { clearInterval(timerInterval); timeLeft = 30; timerEl.innerText = timeLeft; timerInterval = setInterval(() => { timeLeft--; timerEl.innerText = timeLeft; if(timeLeft <= 0) { clearInterval(timerInterval); alert("× ×’××¨ ×”×–××Ÿ! ×—×•×–×¨×™× ×œ×©×œ×‘ 1..."); currentLevel = 0; resetView(); loadStage(); startTimer(); } }, 1000); }

        window.onload = () => { loadStage(); startTimer(); };
    </script>
</body>
</html>
