<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¦×•×¨×‘ WiFi ××§×¦×•×¢×™ ×œ××©×¤×—×ª ×©×™×™×Ÿ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 350px; text-align: center; }
        h2 { margin-top: 0; color: #333; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; direction: ltr; }
        button { background-color: #007bff; color: white; padding: 15px; border: none; border-radius: 8px; width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        #status { margin-top: 20px; font-weight: bold; min-height: 24px; }
        .note { font-size: 12px; color: #666; margin-top: 10px; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ“¡ ×¦×¨×™×‘×ª WiFi (×‘×™× ××¨×™)</h2>
        <p>×”×›× ×¡ ×¤×¨×˜×™× ×•×œ×—×¥ ×¢×œ ×¦×¨×™×‘×”</p>
        
        <input type="text" id="ssid" value="shein" placeholder="×©× ×”×¨×©×ª (SSID)">
        <input type="text" id="password" value="0507449001" placeholder="×¡×™×¡××”">
        
        <button id="writeBtn">×œ×—×¥ ×›××Ÿ ×•×”×¦××“ ×ª×’</button>
        
        <div id="status"></div>
        <div class="note">×§×•×“ ×–×” ×¦×•×¨×‘ ×¤×¨×•×˜×•×§×•×œ WSC ×©×× ×“×¨×•××™×“ ××–×”×” ×›×”×’×“×¨×ª ×¨×©×ª ××•×˜×•××˜×™×ª.</div>
    </div>

    <script>
        const writeBtn = document.getElementById("writeBtn");
        const statusDiv = document.getElementById("status");

        // ×¤×•× ×§×¦×™×” ×©×”×•×¤×›×ª ×˜×§×¡×˜ ×•××¡×¤×¨×™× ×œ××‘× ×” ×”×‘×™× ××¨×™ ×©×× ×“×¨×•××™×“ ×“×•×¨×©
        function buildWscPayload(ssid, password) {
            const SSID_TAG = 0x1045;
            const AUTH_TYPE_TAG = 0x1003;
            const ENCR_TYPE_TAG = 0x100F;
            const NETWORK_KEY_TAG = 0x1027;
            const CREDENTIAL_TAG = 0x100E;

            const encoder = new TextEncoder();
            const ssidBytes = encoder.encode(ssid);
            const passBytes = encoder.encode(password);

            // ×‘× ×™×™×ª ×”-TLV (Tag-Length-Value)
            const parts = [];

            // 1. SSID
            parts.push(shortToBytes(SSID_TAG));
            parts.push(shortToBytes(ssidBytes.length));
            parts.push(ssidBytes);

            // 2. Auth Type (WPA2-PSK = 0x0020)
            parts.push(shortToBytes(AUTH_TYPE_TAG));
            parts.push(shortToBytes(2));
            parts.push(shortToBytes(0x0020)); 

            // 3. Encryption Type (AES = 0x0012) - ×¡×˜× ×“×¨×˜ ×”×™×•×
            parts.push(shortToBytes(ENCR_TYPE_TAG));
            parts.push(shortToBytes(2));
            parts.push(shortToBytes(0x0012));

            // 4. Password
            parts.push(shortToBytes(NETWORK_KEY_TAG));
            parts.push(shortToBytes(passBytes.length));
            parts.push(passBytes);

            // ×—×™×‘×•×¨ ×”×›×œ ×‘×™×—×“
            const flatParts = flatten(parts);

            // ×¢×˜×™×¤×” ×‘×ª×•×š Credential Tag
            const finalPayload = [];
            finalPayload.push(...shortToBytes(CREDENTIAL_TAG));
            finalPayload.push(...shortToBytes(flatParts.length));
            finalPayload.push(...flatParts);

            return new Uint8Array(finalPayload);
        }

        function shortToBytes(val) {
            return [ (val >> 8) & 0xFF, val & 0xFF ];
        }

        function flatten(arr) {
            let res = [];
            arr.forEach(item => {
                if (item instanceof Uint8Array || Array.isArray(item)) {
                    res.push(...item);
                } else {
                    res.push(item);
                }
            });
            return res;
        }

        writeBtn.addEventListener("click", async () => {
            const ssid = document.getElementById("ssid").value;
            const password = document.getElementById("password").value;

            if (!ssid || !password) {
                statusDiv.innerText = "âŒ ×—×¡×¨×™× ×¤×¨×˜×™×";
                statusDiv.style.color = "red";
                return;
            }

            statusDiv.innerText = "â³ ×××ª×™×Ÿ ×œ×ª×’... ×”×¦××“ ×›×¢×ª";
            statusDiv.style.color = "blue";

            try {
                if (!("NDEFReader" in window)) {
                    throw new Error("×“×¤×“×¤×Ÿ ×–×” ×œ× ×ª×•××š ×‘-NFC (× ×¡×” Chrome ×‘×× ×“×¨×•××™×“).");
                }

                const payload = buildWscPayload(ssid, password);
                
                const ndef = new NDEFReader();
                
                // ×›××Ÿ ×”×§×¡×: ×©×™××•×© ×‘-MIME TYPE ×™×™×¢×•×“×™ ×œ×× ×“×¨×•××™×“ WIFI
                await ndef.write({
                    records: [{
                        recordType: "mime",
                        mediaType: "application/vnd.wfa.wsc",
                        data: payload
                    }]
                });

                statusDiv.innerText = "âœ… ×”×¦×¨×™×‘×” ×”×¦×œ×™×—×”! ×–×” ×××•×¨ ×œ×¢×‘×•×“.";
                statusDiv.style.color = "green";

            } catch (error) {
                console.error(error);
                statusDiv.innerText = "âŒ ×©×’×™××”: " + error.message;
                statusDiv.style.color = "red";
            }
        });
    </script>
</body>
</html>
