<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dubai Live Map Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; }
        
        /* שורת חיפוש עליונה */
        .search-container {
            position: fixed; top: 10px; left: 10px; right: 10px;
            z-index: 1000; display: flex; gap: 5px;
            background: rgba(255,255,255,0.9); padding: 10px;
            border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 10px; font-size: 16px; outline: none; }
        button { padding: 10px 20px; background: #ff4757; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* המפה תופסת את כל המסך */
        #map { flex: 1; width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="placeInput" placeholder="רשום מקום (למשל: Airport Terminal 1)">
        <button onclick="searchAndGo()">חפש</button>
    </div>

    <div id="map"></div>

    <script>
        // יצירת המפה ומיקומה על דובאי
        var map = L.map('map').setView([25.2048, 55.2708], 11);

        // טעינת עיצוב המפה (מפות פתוחות)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        var currentMarker;

        async function searchAndGo() {
            const query = document.getElementById('placeInput').value;
            if (!query) return;

            // חיפוש המקום בשרת המפות העולמי
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + " Dubai")}`);
                const data = await response.json();

                if (data.length > 0) {
                    const lat = data[0].lat;
                    const lon = data[0].lon;

                    // הסרת נעץ קודם אם קיים
                    if (currentMarker) map.removeLayer(currentMarker);

                    // הוספת נעץ חדש וזום למקום
                    currentMarker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>${data[0].display_name.split(',')[0]}</b>`)
                        .openPopup();

                    map.setView([lat, lon], 15); // זום פנימה למקום שנמצא
                    document.activeElement.blur(); // סגירת מקלדת בטלפון
                } else {
                    alert("המקום לא נמצא. נסה שם אחר.");
                }
            } catch (e) {
                alert("שגיאת חיבור. וודא שאתה מחובר לאינטרנט.");
            }
        }
    </script>
</body>
</html>
