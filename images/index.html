<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>גלריית עבודות</title>
<style>
  :root{
    --gap:10px;
    --thumb-radius:12px;
    --open-dur:700ms;
    --shadow:0 10px 28px rgba(0,0,0,.20);
  }
  html,body{
    margin:0;
    background:#f7f8fa;
    color:#0f172a;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }
  .wrap{max-width:980px;margin:14px auto 28px;padding:0 12px}
  h1{font-size:1.2rem;font-weight:800;margin:14px 4px;text-align:center;color:#1e293b}
  .note{font-size:.9rem;color:#475569;margin:0 4px 10px;text-align:center}

  /* רשת – 2 עמודות במובייל */
  .gallery{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr));
    gap:var(--gap);
  }
  @media (min-width:700px){ .gallery{ grid-template-columns:repeat(3, minmax(0,1fr)) } }
  @media (min-width:1000px){ .gallery{ grid-template-columns:repeat(4, minmax(0,1fr)) } }

  .thumb{
    position:relative;
    overflow:hidden;
    border-radius:var(--thumb-radius);
    background:#e9edf3;
    aspect-ratio:1/1;
    box-shadow:0 1px 0 rgba(0,0,0,.03) inset;
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    transform:scale(0.975);
    transition:transform 200ms ease, filter 200ms ease;
  }
  .thumb:hover img{
    transform:scale(1.0);
    filter:contrast(1.03) saturate(1.03);
  }

  /* לייטבוקס */
  .lightbox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.86);
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    pointer-events:none;
    transition:opacity var(--open-dur) ease;
    z-index:9999;
  }
  .lightbox.open{
    opacity:1;
    pointer-events:auto;
  }
  .lb-img-wrap{
    max-width:94vw;
    max-height:86vh;
    transform:translateY(12px) scale(.955);
    transition:transform var(--open-dur) cubic-bezier(.22,.7,.2,1);
  }
  .lightbox.open .lb-img-wrap{
    transform:translateY(0) scale(1);
  }
  .lightbox img{
    max-width:94vw;
    max-height:86vh;
    width:auto;
    height:auto;
    border-radius:16px;
    box-shadow:var(--shadow);
    display:block;
  }
  .lb-close{
    position:fixed;
    top:14px;
    inset-inline-end:14px;
    width:38px; height:38px;
    border-radius:999px;
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.22);
    color:#fff;
    font-weight:800;
    line-height:38px;
    text-align:center;
    cursor:pointer;
    user-select:none;
    backdrop-filter:saturate(120%) blur(6px);
    transition:background 160ms ease, transform 160ms ease;
  }
  .lb-close:hover{
    background:rgba(255,255,255,.22);
    transform:scale(1.06);
  }

  .empty{
    background:#fff;
    border:1px dashed #cbd5e1;
    color:#475569;
    padding:18px;
    border-radius:12px;
    text-align:center;
    margin-top:14px;
    word-wrap:break-word;
  }

  footer{
    text-align:center;
    font-size:.75rem;
    color:#64748b;
    margin:18px 0 24px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>גלריית עבודות</h1>
    <p class="note" id="dbg"></p>
    <div id="gallery" class="gallery" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none"></div>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="תצוגת תמונה מוגדלת">
    <button class="lb-close" id="lbClose" aria-label="סגור"><span aria-hidden="true">×</span></button>
    <div class="lb-img-wrap"><img id="lbImg" alt=""></div>
  </div>

  <!-- Footer Version -->
  <footer id="versionFooter">גרסה: v1.01</footer>

<script>
/* ========= גרסה ========= */
const VERSION = "v1.01";
document.getElementById("versionFooter").textContent = "גרסה: " + VERSION;

/* ========= קונפיג שלך ========= */
const CFG = {
  user  : "Cc2k1975",
  repo  : "reuven2k",
  branch: "main",
  path  : "images"
};

const IMG_EXTS = ["jpg","jpeg","png","gif","webp","avif"];
const dbgEl = document.getElementById("dbg");

function setDebug(msg){
  dbgEl.textContent = msg;
  console.log("[gallery]", msg);
}

function showEmpty(msg){
  const el = document.getElementById("empty");
  el.style.display = "block";
  el.innerHTML = msg;
}

async function loadImagesFromGithub(){
  const {user, repo, branch, path} = CFG;
  const api = `https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
  setDebug("טוען תמונות...");
  const res = await fetch(api);
  if(!res.ok){
    showEmpty("שגיאה בטעינה (" + res.status + "). בדוק שהריפו ציבורי ושהנתיב נכון.");
    throw new Error("GitHub API error: " + res.status);
  }
  const items = await res.json();
  const urls = items
    .filter(it => it.type === "file" && IMG_EXTS.includes(it.name.split(".").pop().toLowerCase()))
    .map(it => it.download_url);
  return urls;
}

function createThumb(src){
  const div = document.createElement("div");
  div.className = "thumb";
  const img = document.createElement("img");
  img.src = src;
  img.loading = "lazy";
  img.decoding = "async";
  img.alt = "עבודה";
  div.appendChild(img);
  div.addEventListener("click", ()=>openLightbox(src));
  return div;
}

function renderGallery(urls){
  const gal = document.getElementById("gallery");
  gal.innerHTML = "";
  if(!urls.length){
    showEmpty("לא נמצאו קבצי תמונה בתיקייה images");
    return;
  }
  document.getElementById("empty").style.display = "none";
  urls.forEach(u => gal.appendChild(createThumb(u)));
}

/* ===== לייטבוקס ===== */
const lb = document.getElementById("lightbox");
const lbImg = document.getElementById("lbImg");
const lbClose = document.getElementById("lbClose");

function openLightbox(src){
  lbImg.src = src;
  lb.classList.add("open");
  lb.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden";
}

function closeLightbox(){
  lb.classList.remove("open");
  lb.setAttribute("aria-hidden","true");
  setTimeout(()=>{ lbImg.src = ""; }, 300);
  document.body.style.overflow = "";
}
lb.addEventListener("click", (e)=>{
  if(e.target === lb || e.target === lbClose) closeLightbox();
});
document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeLightbox(); });

(async function init(){
  try{
    const urls = await loadImagesFromGithub();
    renderGallery(urls);
  }catch(err){
    console.error(err);
  }
})();
</script>
</body>
</html>
