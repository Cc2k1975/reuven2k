
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מתורגמן קולי</title>
    <style>
        /* איפוס הגדרות דפדפן */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* מניעת גלילה */
        }
        body {
            display: flex;
            flex-direction: column;
        }

        /* עיצוב הכפתורים הגדולים */
        .mega-button {
            width: 100%;
            height: 50vh; /* 50% מגובה המסך */
            border: none;
            font-family: 'Segoe UI', sans-serif;
            font-size: 4rem; /* טקסט ענק */
            font-weight: 800;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.1s, transform 0.1s;
            outline: none;
            /* מניעת בחירת טקסט בלחיצה ארוכה בנייד */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* צבעים */
        #btn-he { background-color: #0056b3; } /* כחול כהה */
        #btn-en { background-color: #c82333; } /* אדום כהה */

        /* אפקט לחיצה */
        .mega-button:active {
            filter: brightness(85%); /* מכהה מעט בלחיצה */
            transform: scale(0.98);
        }
        
        /* אינדיקציה ויזואלית עדינה בזמן הקשבה */
        .listening {
             animation: pulse 1.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { filter: brightness(100%); }
            to { filter: brightness(130%); }
        }

    </style>
</head>
<body>

    <button id="btn-he" class="mega-button" onmousedown="startListening('he')" onmouseup="stopRecognition()" ontouchstart="startListening('he')" ontouchend="stopRecognition()">
        עברית
    </button>
    
    <button id="btn-en" class="mega-button" onmousedown="startListening('en')" onmouseup="stopRecognition()" ontouchstart="startListening('en')" ontouchend="stopRecognition()">
        ENGLISH
    </button>

    <script>
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        const synthesis = window.speechSynthesis;
        
        // הגדרות לזיהוי מהיר יותר
        recognition.continuous = false;
        recognition.interimResults = false;
        let isListening = false;

        function startListening(lang) {
            if (isListening) return;
            
            synthesis.cancel(); // עצירת דיבור אם קיים
            
            const btnId = lang === 'he' ? 'btn-he' : 'btn-en';
            document.getElementById(btnId).classList.add('listening');

            if (lang === 'he') {
                recognition.lang = 'he-IL';
            } else {
                recognition.lang = 'en-US';
            }

            try {
                recognition.start();
                isListening = true;
            } catch (e) {
                console.error("Error starting recognition:", e);
            }
        }
        
        function stopRecognition() {
            // פונקציה זו מפסיקה את ההאזנה כשהמשתמש עוזב את הכפתור
            // זה עוזר לקבל תוצאה מהירה יותר במקום לחכות לשקט
            if (isListening) {
                recognition.stop();
            }
        }

        // כשהדפדפן מסיים לזהות את הדיבור
        recognition.onresult = async (event) => {
            const transcript = event.results[0][0].transcript;
            console.log("שמעתי:", transcript); // לצרכי ניפוי באגים בקונסול

            // זיהוי שפות יעד לתרגום
            const currentLang = recognition.lang === 'he-IL' ? 'he' : 'en';
            const translateTo = currentLang === 'he' ? 'en' : 'he';

            try {
                // שימוש ב-API המהיר של גוגל
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${currentLang}&tl=${translateTo}&dt=t&q=${encodeURIComponent(transcript)}`;
                const response = await fetch(url);
                const data = await response.json();
                const translatedText = data[0][0][0];

                // הקראת הטקסט
                speak(translatedText, translateTo);

            } catch (error) {
                console.error("שגיאה בתרגום", error);
            }
        };

        // ניקוי מצבים בסיום
        recognition.onspeechend = () => {
             resetButtons();
             isListening = false;
        };
        recognition.onerror = (event) => {
             console.log("שגיאה בזיהוי:", event.error);
             resetButtons();
             isListening = false;
        };

        function resetButtons() {
            document.getElementById('btn-he').classList.remove('listening');
            document.getElementById('btn-en').classList.remove('listening');
        }

        function speak(text, lang) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang === 'he' ? 'he-IL' : 'en-US';
            // ניסיון להגביר מעט את המהירות
            utterance.rate = 1.1; 
            synthesis.speak(utterance);
        }
    </script>
</body>
</html>
