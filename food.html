<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>×‘×—×™×¨×ª ×ª×¤×¨×™×˜</title>
<style>
:root{
  --bg-page:#fffaf0;
  --panel-bg:#ffffff;
  --border:#e2d7b8;
  --text-main:#333;
  --text-dim:#666;
  --green:#3c7a4c;
  --green-dark:#2e5f3b;
  --gold:#c59d2f;
  --err-bg:#a01919;
  --ok-bg:#2e7d32;
  --radius:16px;
  --shadow:0 8px 24px rgba(0,0,0,0.12);
  --shadow-inner:0 0 10px rgba(0,0,0,0.08) inset;
  --btn-bg:#3c7a4c;
  --btn-text:#fff;
  --disabled-bg:#bbb;
  --disabled-text:#fff;
}

/* ×“×£ ×›×œ×œ×™ */
body{
  margin:0;
  background:var(--bg-page);
  font-family:"Heebo",Arial,sans-serif;
  color:var(--text-main);
  display:flex;
  justify-content:center;
  padding:16px;
  text-align:center;
}
.wrap{
  width:100%;
  max-width:480px;
  background:var(--panel-bg);
  border-radius:var(--radius);
  border:2px solid var(--border);
  box-shadow:var(--shadow);
  padding:20px 16px 32px;
  text-align:initial;
}

/* ×”×•×“×¢×•×ª ×¡×˜×˜×•×¡ ×¢×œ×™×•× ×•×ª */
#statusBox{
  display:none;
  border-radius:var(--radius);
  padding:10px 14px;
  margin-bottom:16px;
  font-size:16px;
  font-weight:600;
  color:#fff;
  line-height:1.4;
  text-align:center;
}
#statusBox.ok{background:var(--ok-bg);}
#statusBox.err{background:var(--err-bg);}

/* ×‘×œ×•×§ ×§×‘×œ×ª ×¤× ×™× */
.welcomeBox{
  background:#ffffff;
  border:2px solid var(--border);
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.08);
  padding:16px;
  margin-bottom:16px;
  text-align:right;
  font-family:"Heebo", Arial, sans-serif;
}
.welcomeMainRow{
  display:flex;
  flex-wrap:nowrap;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
}
.welcomeIcon{
  font-size:24px;
  line-height:1;
}
.welcomeTitle{
  font-size:20px;
  font-weight:700;
  color:var(--green-dark);
  white-space:nowrap; /* ×œ× ×œ×©×‘×•×¨ ×©×•×¨×” ×‘××©×¤×˜ */
}
.welcomeSubInfo{
  margin-top:8px;
  font-size:14px;
  line-height:1.4;
  color:#555;
}
.welcomeSubInfo div{
  white-space:nowrap;
}

/* ××—×¨×™ ×©×œ×™×—×” */
#afterSubmitBox{
  display:none;
  background:#eef9f1;
  border:2px solid #b8dfc2;
  border-radius:var(--radius);
  padding:16px;
  text-align:center;
  font-size:16px;
  line-height:1.5;
  font-weight:600;
  color:#2e7d32;
  box-shadow:var(--shadow-inner);
  margin-bottom:16px;
}

/* ×›×¨×˜×™×¡ ×”×˜×•×¤×¡ */
.formCard{
  background:#fff;
  border:2px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow-inner);
  padding:16px;
  margin-bottom:16px;
}
.formCard h2{
  margin:0 0 12px 0;
  font-size:18px;
  font-weight:700;
  color:var(--green);
  text-align:right;
}

/* ×©×“×•×ª ×‘×—×™×¨×” */
.selectRow{
  display:flex;
  flex-direction:column;
  margin-bottom:12px;
}
.selectRow label{
  font-size:15px;
  font-weight:600;
  color:var(--text-main);
  margin-bottom:6px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.selectRow label .takenTag{
  font-size:12px;
  font-weight:700;
  color:#a01919;
  background:#fff0f0;
  border:1px solid #a01919;
  border-radius:12px;
  padding:2px 8px;
  display:none;
}
.selectRow select{
  background:#fff;
  border:2px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow-inner);
  padding:10px 12px;
  font-size:16px;
  color:var(--text-main);
  font-family:inherit;
}

/* ×›×¤×ª×•×¨ ×©×œ×™×—×” */
#sendBtn{
  width:100%;
  background:var(--btn-bg);
  color:var(--btn-text);
  border:0;
  border-radius:var(--radius);
  font-size:18px;
  font-weight:700;
  padding:14px 16px;
  box-shadow:var(--shadow);
  cursor:pointer;
  margin-top:8px;
  text-align:center;
}
#sendBtn:active{
  background:var(--green-dark);
}
#sendBtn.disabled{
  background:var(--disabled-bg);
  color:var(--disabled-text);
  cursor:not-allowed;
}

/* ×¤×•×˜×¨ */
.footerInfo{
  text-align:center;
  font-size:13px;
  color:var(--text-dim);
  margin-top:24px;
}
</style>
</head>
<body>
<div class="wrap">

  <!-- ×¤×¡ ×¡×˜×˜×•×¡ (××¦×‘, ×©×’×™××•×ª, ×”×¦×œ×—×”) -->
  <div id="statusBox"></div>

  <!-- ×‘×¨×•×›×™× ×”×‘××™× ×œ××©×¤×—×” + ××™×§×•× + ×ª××¨×™×š -->
  <div class="welcomeBox">
    <div class="welcomeMainRow">
      <div class="welcomeIcon">ğŸ½ï¸</div>
      <div class="welcomeTitle" id="welcomeTitleText">×‘×¨×•×›×™× ×”×‘××™× ××©×¤×—×ª ???</div>
    </div>
    <div class="welcomeSubInfo">
      <div id="eventLocationLine">× ×¤×’×©×™× ×‘: ...</div>
      <div id="eventDateLine">×‘×ª××¨×™×š: ...</div>
    </div>
  </div>

  <!-- ×”×•×“×¢×ª ×ª×•×“×” ××—×¨×™ ×©×œ×™×—×” -->
  <div id="afterSubmitBox">
    ×ª×•×“×”! ×”×‘×—×™×¨×” ×©×œ×š × ×©××¨×” ×‘×”×¦×œ×—×” âœ…  
    ××™×Ÿ ×¦×•×¨×š ×œ××œ× ×©×•×‘.
  </div>

  <!-- ×”×˜×•×¤×¡ ×¢×¦××• -->
  <div id="formCard" class="formCard">
    <h2>×‘×—×¨/×™ ××” ××ª×” ××‘×™×</h2>

    <div class="selectRow">
      <label>×× ×” ×‘×©×¨×™×ª <span class="takenTag" data-tag="meat">×ª×¤×•×¡</span></label>
      <select id="meatSelect"><option value="">×‘×—×¨ ×× ×” ×‘×©×¨×™×ªâ€¦</option></select>
    </div>

    <div class="selectRow">
      <label>×¤×—××™××” <span class="takenTag" data-tag="carb">×ª×¤×•×¡</span></label>
      <select id="carbSelect"><option value="">×‘×—×¨ ×¤×—××™××”â€¦</option></select>
    </div>

    <div class="selectRow">
      <label>×¡×œ×˜ 1 <span class="takenTag" data-tag="salad1">×ª×¤×•×¡</span></label>
      <select id="salad1Select"><option value="">×‘×—×¨ ×¡×œ×˜ ×¨××©×•×Ÿâ€¦</option></select>
    </div>

    <div class="selectRow">
      <label>×¡×œ×˜ 2 <span class="takenTag" data-tag="salad2">×ª×¤×•×¡</span></label>
      <select id="salad2Select"><option value="">×‘×—×¨ ×¡×œ×˜ ×©× ×™â€¦</option></select>
    </div>

    <div class="selectRow">
      <label>×©×ª×™×™×” <span class="takenTag" data-tag="drink">×ª×¤×•×¡</span></label>
      <select id="drinkSelect"><option value="">×‘×—×¨ ×©×ª×™×™×”â€¦</option></select>
    </div>

    <div class="selectRow">
      <label>×§×™× ×•×— <span class="takenTag" data-tag="dessert">×ª×¤×•×¡</span></label>
      <select id="dessertSelect"><option value="">×‘×—×¨ ×§×™× ×•×—â€¦</option></select>
    </div>

    <button id="sendBtn">×©×œ×—</button>
  </div>

  <div class="footerInfo">×’×¨×¡×” 2.6 Â· food.html</div>
</div>

<script>
// ===== ×¤×¨××˜×¨×™× ×©×œ ×”-BIN =====
const BIN_ID     = "68ff447a43b1c97be9844c29";
const MASTER_KEY = "$2a$10$4rynniEMuvwqg2nDb5KSEe/lAVYp8a7L3xWzp9GsO6n49OfXc3FCO";
const API        = "https://api.jsonbin.io/v3/b";

// DOM
const statusBox          = document.getElementById("statusBox");
const afterSubmitBox     = document.getElementById("afterSubmitBox");
const formCard           = document.getElementById("formCard");

const welcomeTitleText   = document.getElementById("welcomeTitleText");
const eventLocationLine  = document.getElementById("eventLocationLine");
const eventDateLine      = document.getElementById("eventDateLine");

const meatSelect         = document.getElementById("meatSelect");
const carbSelect         = document.getElementById("carbSelect");
const salad1Select       = document.getElementById("salad1Select");
const salad2Select       = document.getElementById("salad2Select");
const drinkSelect        = document.getElementById("drinkSelect");
const dessertSelect      = document.getElementById("dessertSelect");

const sendBtn            = document.getElementById("sendBtn");

// ××¦×‘ ×¤× ×™××™
let recordData   = null;
let myCode       = null;
let myFamilyName = "";
let formOpen     = true;

// ===== ×¢×•×–×¨×™× =====

// ×”×•×“×¢×” ×¢×œ×™×•× ×”
function showStatus(msg, ok){
  statusBox.style.display="block";
  statusBox.className = ok ? "ok" : "err";
  statusBox.textContent=msg;
}

// ×œ×”×‘×™× ××ª ×”-code ××”-URL: ?code=2
function getCodeFromURL(){
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get("code") || "";
}

// ×”×¦×’×ª ×©× ×”××©×¤×—×” + ××™×§×•× + ×ª××¨×™×š
function renderHeaderInfo(){
  // ×©× ×”××©×¤×—×”
  welcomeTitleText.textContent = "×‘×¨×•×›×™× ×”×‘××™× " + myFamilyName;

  // ×©×•×¨×ª ××™×§×•×
  const loc = recordData?.eventLocation || "";
  if(loc){
    eventLocationLine.textContent = "× ×¤×’×©×™× ×‘: " + loc;
  } else {
    eventLocationLine.textContent = "";
  }

  // ×©×•×¨×ª ×ª××¨×™×š
  const dt = recordData?.eventDate || "";
  if(dt){
    eventDateLine.textContent = "×‘×ª××¨×™×š: " + dt;
  } else {
    eventDateLine.textContent = "";
  }
}

// ×‘×•× ×” ××ª ×›×œ ×”××•×¤×¦×™×•×ª ×‘×›×œ select ×œ×¤×™ menuOptions
// ×•×“×•××’ ×œ×”×•×¨×™×“ ×¤×¨×™×˜×™× ×©×›×‘×¨ × ×œ×§×—×• ×¢"×™ ××©×¤×—×•×ª ××—×¨×•×ª
function buildSelectOptions(){
  const menuOptions = recordData?.menuOptions || {};

  // ××™ ×›×‘×¨ ×œ×§×— ××”
  const taken = {
    meat:new Set(),
    carb:new Set(),
    salad1:new Set(),
    salad2:new Set(),
    drink:new Set(),
    dessert:new Set()
  };

  const answers = Array.isArray(recordData?.["×‘×—×™×¨×•×ª"])
    ? recordData["×‘×—×™×¨×•×ª"]
    : [];

  answers.forEach(rec=>{
    if(!rec || !rec.code) return;
    if(rec.code !== myCode){
      if(rec["×× ×”"])      taken.meat.add(rec["×× ×”"]);
      if(rec["×¤×—××™××”"])   taken.carb.add(rec["×¤×—××™××”"]);
      if(rec["×¡×œ×˜1"])     taken.salad1.add(rec["×¡×œ×˜1"]);
      if(rec["×¡×œ×˜2"])     taken.salad2.add(rec["×¡×œ×˜2"]);
      if(rec["×©×ª×™×™×”"])    taken.drink.add(rec["×©×ª×™×™×”"]);
      if(rec["×§×™× ×•×—"])    taken.dessert.add(rec["×§×™× ×•×—"]);
    }
  });

  function fillSelect(selectEl, arr, takenSet, placeholderTxt){
    // ×©×•××¨ ××ª ×”××•×¤×¦×™×” ×”×¨××©×•× ×” ×× ×›×‘×¨ ×§×™×™××ª
    const firstOption = selectEl.querySelector("option[value='']");
    selectEl.innerHTML = "";

    if(firstOption){
      selectEl.appendChild(firstOption);
    }else{
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = placeholderTxt;
      selectEl.appendChild(opt);
    }

    (arr||[]).forEach(item=>{
      const op=document.createElement("option");
      op.value=item;
      op.textContent=item;
      if(takenSet.has(item)){
        op.disabled=true;
        op.textContent = item+" (×ª×¤×•×¡)";
      }
      selectEl.appendChild(op);
    });
  }

  fillSelect(meatSelect   , menuOptions.meat   || [], taken.meat   , "×‘×—×¨ ×× ×” ×‘×©×¨×™×ªâ€¦");
  fillSelect(carbSelect   , menuOptions.carb   || [], taken.carb   , "×‘×—×¨ ×¤×—××™××”â€¦");
  fillSelect(salad1Select , menuOptions.salad1 || [], taken.salad1 , "×‘×—×¨ ×¡×œ×˜ ×¨××©×•×Ÿâ€¦");
  fillSelect(salad2Select , menuOptions.salad2 || [], taken.salad2 , "×‘×—×¨ ×¡×œ×˜ ×©× ×™â€¦");
  fillSelect(drinkSelect  , menuOptions.drink  || [], taken.drink  , "×‘×—×¨ ×©×ª×™×™×”â€¦");
  fillSelect(dessertSelect, menuOptions.dessert|| [], taken.dessert, "×‘×—×¨ ×§×™× ×•×—â€¦");

  // ××¦×™×’ ×ª×’ "×ª×¤×•×¡" ×œ×™×“ ×©× ×”×§×˜×’×•×¨×™×” ×× ××™×Ÿ ×‘×›×œ×œ ××•×¤×¦×™×” ×—×•×¤×©×™×ª
  updateTakenTag("meat"   , menuOptions.meat   || [], taken.meat);
  updateTakenTag("carb"   , menuOptions.carb   || [], taken.carb);
  updateTakenTag("salad1" , menuOptions.salad1 || [], taken.salad1);
  updateTakenTag("salad2" , menuOptions.salad2 || [], taken.salad2);
  updateTakenTag("drink"  , menuOptions.drink  || [], taken.drink);
  updateTakenTag("dessert", menuOptions.dessert|| [], taken.dessert);
}

// ×× ××™×Ÿ ××¤×™×œ×• ××¤×©×¨×•×ª ××—×ª ×¤× ×•×™×” ×‘×§×˜×’×•×¨×™×” â€“ ××¦×™×’ "×ª×¤×•×¡"
function updateTakenTag(cat, arr, takenSet){
  const tagEl = document.querySelector(`.takenTag[data-tag="${cat}"]`);
  if(!tagEl) return;
  let allTaken=true;
  for(const item of arr){
    if(!takenSet.has(item)){
      allTaken=false;
      break;
    }
  }
  tagEl.style.display = allTaken ? "inline-block":"none";
}

// ×‘×“×™×§×” ×× ×”××©×¤×—×” ×”×–×• ×›×‘×¨ ××™×œ××” ×‘×¢×‘×¨
function alreadySubmitted(){
  const answers = Array.isArray(recordData?.["×‘×—×™×¨×•×ª"])
    ? recordData["×‘×—×™×¨×•×ª"]
    : [];
  return answers.some(r=>r.code===myCode);
}

// ×”×¤×¢×œ×”/×›×™×‘×•×™ ×©×œ ×”×˜×•×¤×¡
function setFormEnabled(enabled){
  if(enabled){
    formCard.style.opacity="1";
    formCard.style.pointerEvents="auto";
    sendBtn.classList.remove("disabled");
  }else{
    formCard.style.opacity="0.5";
    formCard.style.pointerEvents="none";
    sendBtn.classList.add("disabled");
  }
}

// ×¨×¢× ×•×Ÿ ××”×©×¨×ª
async function refreshData(silent){
  if(!silent){
    showStatus("×˜×•×¢×Ÿ × ×ª×•× ×™×...", true);
  }
  try{
    const res = await fetch(`${API}/${BIN_ID}/latest`, {
      headers:{ "X-Master-Key": MASTER_KEY }
    });
    const j = await res.json();

    recordData = j.record || null;
    formOpen   = recordData?.formOpen !== false;

    if(!silent){
      showStatus("", true);
      statusBox.style.display="none";
    }
  }catch(err){
    console.error(err);
    showStatus("×©×’×™××” ×‘×˜×¢×™× ×”", false);
  }
}

// ×‘×“×™×§×” ×œ×¤× ×™ ×©×œ×™×—×” ×× ××™×©×”×• ××—×¨ ×œ×§×— ×‘×™× ×ª×™×™× ××ª ××” ×©×‘×—×¨×ª×™
function someoneElseTookNow(vals){
  const answers = Array.isArray(recordData?.["×‘×—×™×¨×•×ª"])
    ? recordData["×‘×—×™×¨×•×ª"]
    : [];
  const usedByOthers = {
    meat:new Set(),
    carb:new Set(),
    salad1:new Set(),
    salad2:new Set(),
    drink:new Set(),
    dessert:new Set()
  };
  answers.forEach(rec=>{
    if(rec.code!==myCode){
      if(rec["×× ×”"])      usedByOthers.meat.add(rec["×× ×”"]);
      if(rec["×¤×—××™××”"])   usedByOthers.carb.add(rec["×¤×—××™××”"]);
      if(rec["×¡×œ×˜1"])     usedByOthers.salad1.add(rec["×¡×œ×˜1"]);
      if(rec["×¡×œ×˜2"])     usedByOthers.salad2.add(rec["×¡×œ×˜2"]);
      if(rec["×©×ª×™×™×”"])    usedByOthers.drink.add(rec["×©×ª×™×™×”"]);
      if(rec["×§×™× ×•×—"])    usedByOthers.dessert.add(rec["×§×™× ×•×—"]);
    }
  });

  if(usedByOthers.meat.has(vals.meatVal)) return true;
  if(usedByOthers.carb.has(vals.carbVal)) return true;
  if(usedByOthers.salad1.has(vals.s1Val)) return true;
  if(usedByOthers.salad2.has(vals.s2Val)) return true;
  if(usedByOthers.drink.has(vals.drinkVal)) return true;
  if(usedByOthers.dessert.has(vals.dessertVal)) return true;
  return false;
}

// ×©×œ×™×—×”
async function submitForm(){
  const meatVal    = meatSelect.value.trim();
  const carbVal    = carbSelect.value.trim();
  const s1Val      = salad1Select.value.trim();
  const s2Val      = salad2Select.value.trim();
  const drinkVal   = drinkSelect.value.trim();
  const dessertVal = dessertSelect.value.trim();

  if(!meatVal || !carbVal || !s1Val || !s2Val || !drinkVal || !dessertVal){
    showStatus("×—×¡×¨ ×¤×¨×™×˜. ×ª××œ× ×”×›×œ.", false);
    return;
  }

  // ×¨×™×¢× ×•×Ÿ ×œ×¤× ×™ ×©××™×¨×” ×›×“×™ ×œ×•×•×“× ×©×œ× × ×ª×¤×¡ ×¢×›×©×™×•
  await refreshData(true);
  if(!recordData){
    showStatus("×©×’×™××” ×‘×˜×¢×™× ×” ××—×“×©", false);
    return;
  }

  // ××™×©×”×• ××—×¨ ×‘×“×™×•×§ ×œ×§×—?
  const conflict = someoneElseTookNow({
    meatVal, carbVal, s1Val, s2Val, drinkVal, dessertVal
  });
  if(conflict){
    showStatus("××™×©×”×• ×‘×—×¨ ××ª ××•×ª×” ×× ×” ×¢×›×©×™×•. ×ª×‘×—×¨ ××—×“×©.", false);
    buildSelectOptions();
    return;
  }

  // ×”×˜×•×¤×¡ × ×¡×’×¨?
  if(recordData.formOpen === false){
    showStatus("×”×˜×•×¤×¡ × ×¡×’×¨. ×“×‘×¨ ×¢× ×”×××¨×’×Ÿ.", false);
    return;
  }

  // ×›×‘×¨ ××™×œ××ª×™?
  if(alreadySubmitted()){
    showStatus("×›×‘×¨ ××™×œ××ª. ××™×Ÿ ×¦×•×¨×š ×©×•×‘.", true);
    return;
  }

  // ××›×™×Ÿ ××ª ×”×¨×©×•××” ×©×œ×™
  const newRec = {
    code: myCode,
    "×©×": myFamilyName,
    "×× ×”": meatVal,
    "×¤×—××™××”": carbVal,
    "×¡×œ×˜1": s1Val,
    "×¡×œ×˜2": s2Val,
    "×©×ª×™×™×”": drinkVal,
    "×§×™× ×•×—": dessertVal,
    ts: new Date().toISOString()
  };

  const updatedAnswers = Array.isArray(recordData["×‘×—×™×¨×•×ª"])
    ? [...recordData["×‘×—×™×¨×•×ª"], newRec]
    : [newRec];

  // ×’×•×£ ××œ× ×œ×©××™×¨×” (×× ×—× ×• ××©××¨×™× ×”×›×œ, ×œ× ××•×—×§×™× ×›×œ×•×)
  const body = {
    formOpen: (recordData.formOpen !== false),
    map: recordData.map || {},
    menuOptions: recordData.menuOptions || {},
    "×‘×—×™×¨×•×ª": updatedAnswers,
    eventLocation: recordData.eventLocation || "",
    eventDate: recordData.eventDate || ""
  };

  try{
    const res = await fetch(`${API}/${BIN_ID}`, {
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        "X-Master-Key": MASTER_KEY
      },
      body: JSON.stringify(body)
    });
    if(!res.ok){
      showStatus("×©××™×¨×” × ×›×©×œ×” .× ×¡×” ×©×•×‘.", false);
      return;
    }

    showStatus("×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×” âœ…", true);
    afterSubmitBox.style.display="block";
    setFormEnabled(false);

  }catch(err){
    console.error(err);
    showStatus("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª", false);
  }
}

// ===== Init =====
(async function init(){
  myCode = getCodeFromURL().trim();
  if(!myCode){
    showStatus("×›×“×™ ×œ×‘×—×•×¨ ××ª×” ×—×™×™×‘ ×œ×”×™×›× ×¡ ××”×§×™×©×•×¨ ×”××™×©×™ ×©×œ×š", false);
    setFormEnabled(false);
    return;
  }

  await refreshData(true);

  if(!recordData){
    showStatus("×©×’×™××” ×‘×˜×¢×™× ×”", false);
    setFormEnabled(false);
    return;
  }

  // ×©× ×”××©×¤×—×” ×œ×¤×™ ×”-map
  myFamilyName = recordData.map && recordData.map[myCode]
    ? recordData.map[myCode]
    : "××©×¤×—×” ×œ× ××–×•×”×”";

  // ××¦×™×’ ×›×•×ª×¨×ª ×¢×œ×™×•× ×” ("×‘×¨×•×›×™× ×”×‘××™×...", "× ×¤×’×©×™× ×‘...", "×‘×ª××¨×™×š...")
  renderHeaderInfo();

  // ×”×˜×•×¤×¡ ×¤×ª×•×—?
  if(recordData.formOpen === false){
    showStatus("×”×˜×•×¤×¡ ×›×¨×’×¢ ×¡×’×•×¨. ×“×‘×¨ ×¢× ×”×××¨×’×Ÿ.", false);
    setFormEnabled(false);
    return;
  }

  // ×›×‘×¨ ××™×œ××ª×™?
  if(alreadySubmitted()){
    showStatus("×›×‘×¨ ××™×œ××ª. ×ª×•×“×” ×¨×‘×” ğŸ™", true);
    afterSubmitBox.style.display="block";
    setFormEnabled(false);
    return;
  }

  // ×‘×•× ×” ××¤×©×¨×•×™×•×ª ×œ×‘×—×™×¨×” ×¢× ×¡×™××•×Ÿ '×ª×¤×•×¡'
  buildSelectOptions();

  showStatus("×‘×—×¨ ××” ××ª×” ××‘×™× âœ¨", true);
  setFormEnabled(true);
})();

// ×œ×—×™×¦×” ×¢×œ ×©×œ×—
sendBtn.addEventListener("click", ()=>{
  if(sendBtn.classList.contains("disabled")) return;
  submitForm();
});
</script>
</body>
</html>
