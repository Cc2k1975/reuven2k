<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>××™×©×•×¨ ××—×œ×” - ××—×•×œ×œ</title>

  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --text:#111;
    }

    html, body { height:100%; }
    body{
      font-family:'Rubik', sans-serif;
      background:#222;
      margin:0;
      padding:10px;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      overflow-x:hidden;
      -webkit-text-size-adjust:100%;
      box-sizing:border-box;
      color:#fff;
    }

    /* ×¤×× ×œ ×©×œ×™×˜×” */
    .controls{
      background:#333;
      padding:14px;
      border-radius:12px;
      border:1px solid #555;
      width:100%;
      max-width:560px;
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:14px;
      box-sizing:border-box;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .field{
      flex:1 1 170px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:170px;
    }
    label{
      font-size:0.85rem;
      color:#ddd;
      font-weight:800;
    }
    input[type="text"], input[type="date"]{
      padding:12px;
      border-radius:10px;
      border:none;
      font-family:'Rubik', sans-serif;
      width:100%;
      font-size:16px;
      box-sizing:border-box;
      outline:none;
      background:#fff;
      color:#000;
    }
    button{
      background:#4CAF50;
      color:#fff;
      border:none;
      padding:12px;
      border-radius:12px;
      font-weight:900;
      font-size:1.05rem;
      cursor:pointer;
      margin-top:2px;
    }
    .hint{
      color:#bbb;
      font-size:0.85rem;
      line-height:1.35;
    }

    /* ×¢×•×˜×£ ×¨×¡×¤×•× ×¡×™×‘×™ */
    #scalable-wrapper{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      overflow:hidden;
      position:relative;
    }

    /* ×§× ×‘×¡ ×§×©×™×— */
    #fixed-canvas{
      position:relative;
      width:600px;
      flex-shrink:0;
      background:#fff;
      box-shadow:0 0 20px rgba(0,0,0,0.5);
      transform-origin:top center;
    }

    #bgImage{
      display:block;
      width:100%;
      height:auto;
      user-select:none;
      pointer-events:none;
    }

    /* ×©×›×‘×ª ×˜×§×¡×˜ */
    .abs{
      position:absolute;
      transform:translate(-50%, -50%);
      transform-origin:center center;
      color:var(--text);
      white-space:nowrap;
      user-select:none;
      pointer-events:none;
      text-align:center;
      /* ×§×¨×™×¡×¤ */
      -webkit-font-smoothing:antialiased;
      text-rendering:geometricPrecision;
    }

    /* ×˜×™×¤×•×’×¨×¤×™×” (×›××• ××¡××š) */
    .txt-normal{ font-size:16px; font-weight:600; }
    .txt-strong{ font-size:18px; font-weight:800; }
    .txt-small{ font-size:14px; font-weight:600; }
    .txt-id{ font-size:18px; font-weight:900; letter-spacing:0.2px; direction:ltr; }

    /* =========================
       POSITIONS (××—×•×–×™×)
       ×¤×” ××ª×” ××©× ×” ×× ×¦×¨×™×š
       ========================= */

    /* ×©× ××œ× + ×ª"×– (×‘×ª×•×š ×”×©×•×¨×” ×©×œ "×©× ××œ× / ×ª×¢×•×“×ª ×–×”×•×ª") */
    .pos-name { left:70.8%; top:33.7%; }
    .pos-id   { left:35.0%; top:33.7%; }

    /* ×©×•×¨×ª ×”×™×¢×“×¨×•×ª: ××ª××¨×™×š / ×¢×“ ×ª××¨×™×š / ×¡×”"×› ×™××™× */
    .pos-from { left:49.2%; top:39.9%; }
    .pos-to   { left:61.2%; top:39.9%; }
    .pos-days { left:36.4%; top:39.9%; }

    /* ×ª××¨×™×š ×‘×ª×—×ª×™×ª (×‘××¡×’×¨×ª ×”×™×× ×™×ª ×œ××˜×”) */
    .pos-bottom-date { left:71.6%; top:79.6%; }

    /* ========================= */

  </style>
</head>

<body>

  <div class="controls">
    <div class="row">
      <div class="field">
        <label>×©× ××œ×:</label>
        <input type="text" id="fullNameInput" value="×©×™×™×Ÿ ×¦×¨×œ×¡" oninput="syncAll()" />
      </div>
      <div class="field">
        <label>×ª×¢×•×“×ª ×–×”×•×ª:</label>
        <input type="text" id="idInput" value="1-02737305/9" oninput="syncAll()" />
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>××ª××¨×™×š (×ª×—×™×œ×ª ××—×œ×”):</label>
        <input type="date" id="fromDate" onchange="syncAll()" />
      </div>
      <div class="field">
        <label>×¢×“ ×ª××¨×™×š (×¡×™×•× ××—×œ×”):</label>
        <input type="date" id="toDate" onchange="syncAll()" />
      </div>
    </div>

    <div class="hint">
      ××¡×¤×¨ ×”×™××™× ××—×•×©×‘ ××•×˜×•××˜×™×ª (×›×•×œ×œ ×™×•× ×”×ª×—×œ×” ×•×™×•× ×¡×™×•×).<br>
      ×”×ª××¨×™×š ×œ××˜×” ×™×™×§×‘×¢ ××•×˜×•××˜×™×ª ×œ×ª××¨×™×š ×ª×—×™×œ×ª ×”××—×œ×”.
    </div>

    <button onclick="saveImage()">ğŸ“· ×©××•×¨ ×›×§×•×‘×¥ JPG</button>
  </div>

  <div id="scalable-wrapper">
    <div id="fixed-canvas">
      <img id="bgImage" src="mahala.jpg" onload="fitToScreen()" onerror="alert('×—×¡×¨×” ×ª××•× ×” mahala.jpg ×‘××•×ª×” ×ª×™×§×™×™×”!')" alt="×¨×§×¢">

      <!-- ×©× ××œ× -->
      <div class="abs pos-name">
        <div class="txt-strong" id="outName">×©×™×™×Ÿ ×¦×¨×œ×¡</div>
      </div>

      <!-- ×ª"×– -->
      <div class="abs pos-id">
        <div class="txt-id" id="outId">1-02737305/9</div>
      </div>

      <!-- ××ª××¨×™×š -->
      <div class="abs pos-from">
        <div class="txt-normal" id="outFrom">26/08/25</div>
      </div>

      <!-- ×¢×“ ×ª××¨×™×š -->
      <div class="abs pos-to">
        <div class="txt-normal" id="outTo">28/08/25</div>
      </div>

      <!-- ×¡×”"×› ×™××™× -->
      <div class="abs pos-days">
        <div class="txt-strong" id="outDays">3</div>
      </div>

      <!-- ×ª××¨×™×š ×ª×—×ª×•×Ÿ (×–×”×” ×œ×ª×—×™×œ×ª ××—×œ×”) -->
      <div class="abs pos-bottom-date">
        <div class="txt-normal" id="outBottomDate">25/08/25</div>
      </div>

    </div>
  </div>

  <script>
    // --- ×”×ª×××” ×œ× ×™×™×“ (Scale) ---
    function fitToScreen(){
      const wrapper = document.getElementById('scalable-wrapper');
      const canvas  = document.getElementById('fixed-canvas');
      const img     = document.getElementById('bgImage');

      const originalWidth = 600;
      const availableWidth = wrapper.clientWidth || wrapper.offsetWidth;
      const scale = Math.min(availableWidth / originalWidth, 1);

      canvas.style.transform = `scale(${scale})`;

      requestAnimationFrame(() => {
        if (canvas.clientHeight > 0) {
          wrapper.style.height = (canvas.clientHeight * scale) + "px";
        } else {
          wrapper.style.height = "auto";
          setTimeout(fitToScreen, 80);
        }
      });
    }
    window.addEventListener('load', fitToScreen);
    window.addEventListener('resize', fitToScreen);

    // --- ×¢×–×¨×™ ×ª××¨×™×š ---
    function pad2(n){ return String(n).padStart(2,'0'); }

    // dd/mm/yy
    function formatDDMMYY(d){
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const yy = String(d.getFullYear()).slice(-2);
      return `${dd}/${mm}/${yy}`;
    }

    // ×—×™×©×•×‘ ×™××™× ×›×•×œ×œ (inclusive)
    function diffDaysInclusive(d1, d2){
      const a = new Date(d1.getFullYear(), d1.getMonth(), d1.getDate());
      const b = new Date(d2.getFullYear(), d2.getMonth(), d2.getDate());
      const ms = b - a;
      const days = Math.floor(ms / 86400000) + 1;
      return days;
    }

    function syncAll(){
      const fullName = document.getElementById('fullNameInput').value.trim();
      const idNum    = document.getElementById('idInput').value.trim();
      const fromVal  = document.getElementById('fromDate').value;
      const toVal    = document.getElementById('toDate').value;

      document.getElementById('outName').innerText = fullName || '';
      document.getElementById('outId').innerText = idNum || '';

      if(fromVal){
        const fromD = new Date(fromVal);
        const fromTxt = formatDDMMYY(fromD);
        document.getElementById('outFrom').innerText = fromTxt;

        // ×œ××˜×” = ×ª×—×™×œ×ª ××—×œ×”
        document.getElementById('outBottomDate').innerText = fromTxt;
      } else {
        document.getElementById('outFrom').innerText = '';
        document.getElementById('outBottomDate').innerText = '';
      }

      if(toVal){
        const toD = new Date(toVal);
        document.getElementById('outTo').innerText = formatDDMMYY(toD);
      } else {
        document.getElementById('outTo').innerText = '';
      }

      // ×™××™× (×¨×§ ×× ×™×© ×©× ×™ ×ª××¨×™×›×™×)
      if(fromVal && toVal){
        const fromD = new Date(fromVal);
        const toD = new Date(toVal);

        // ×× ×”××©×ª××© ×‘×—×¨ ×”×¤×•×š â€“ × ×ª×§×Ÿ ××•×˜×•××˜×™×ª
        if(toD < fromD){
          document.getElementById('outDays').innerText = '';
          return;
        }

        const days = diffDaysInclusive(fromD, toD);
        document.getElementById('outDays').innerText = String(days);
      } else {
        document.getElementById('outDays').innerText = '';
      }
    }

    // ××ª×—×•×œ ×“×™×¤×•×œ×˜×™× ×œ×“×•×’××” (×›××• ×‘×ª××•× ×”)
    (function init(){
      // ×‘×¨×™×¨×ª ××—×“×œ: ×× ××™×Ÿ ×‘×—×™×¨×”, ×œ× ××›×¨×™×— â€“ ×¨×§ ×××œ× ×¤×œ×˜ ×“×•×’××”
      syncAll();
    })();

    function saveImage(){
      const canvas = document.getElementById('fixed-canvas');
      const originalTransform = canvas.style.transform;

      canvas.style.transform = 'scale(1)';

      html2canvas(canvas, {
        useCORS: true,
        scale: 2,
        backgroundColor: null
      }).then(c => {
        const link = document.createElement('a');
        link.download = "mahala_filled.jpg";
        link.href = c.toDataURL("image/jpeg", 0.92);
        link.click();
      }).finally(() => {
        canvas.style.transform = originalTransform;
        fitToScreen();
      });
    }
  </script>

</body>
</html>
