<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תוצאה חיה - מתוקן</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding-top: 50px;
        }

        .container {
            width: 90%;
            max-width: 400px;
            padding: 30px;
            border: 1px solid #333;
            border-radius: 20px;
            background: #111;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,255,0,0.1);
        }

        .score {
            font-size: 90px;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
            line-height: 1;
            font-variant-numeric: tabular-nums;
        }

        .label { font-size: 18px; color: #aaa; margin-bottom: 10px; }
        .status { font-size: 14px; color: #666; margin-top: 20px; }

        /* כפתור להצגת מידע טכני במקרה של תקלה */
        .debug-btn {
            margin-top: 30px;
            background: transparent; border: 1px solid #333;
            color: #333; font-size: 12px; padding: 5px;
            cursor: pointer;
        }
        
        #debug-area {
            display: none;
            width: 90%; height: 200px;
            background: #222; color: #0f0;
            font-family: monospace; font-size: 10px;
            margin-top: 20px; overflow: auto;
            text-align: left; direction: ltr;
            padding: 10px; border: 1px solid #444;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="label">תוצאה נוכחית:</div>
        <div class="score" id="scoreBoard">-- : --</div>
        <div class="status" id="statusMsg">מתחבר...</div>
    </div>

    <button class="debug-btn" onclick="toggleDebug()">הצג מידע טכני (למקרה שלא עובד)</button>
    <div id="debug-area">טוען נתונים גולמיים...</div>

    <script>
        const GAME_ID = "1066561";
        const PROXY = "https://api.codetabs.com/v1/proxy?quest=";
        const TARGET = `https://www.football.org.il/leagues/games/game/?game_id=${GAME_ID}`;

        async function fetchScore() {
            const scoreDiv = document.getElementById('scoreBoard');
            const statusDiv = document.getElementById('statusMsg');
            const debugArea = document.getElementById('debug-area');

            try {
                statusDiv.innerText = "מושך נתונים...";
                
                // 1. מביאים את המידע
                const res = await fetch(PROXY + encodeURIComponent(TARGET + "&t=" + Date.now()));
                if (!res.ok) throw new Error("תקלת רשת");
                
                const html = await res.text();
                
                // כותבים ללוג הטכני למקרה הצורך
                debugArea.innerText = "אורך דף שהתקבל: " + html.length + " תווים\n\n" + html.substring(0, 2000); 

                // 2. מנקים את כל ה-HTML ומשאירים רק טקסט
                // זה הופך את "<span>2</span> : <span>1</span>" ל-"2 : 1"
                let cleanText = html.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ');
                
                // 3. מחפשים תבנית של תוצאה בתוך הטקסט הנקי
                // מחפש: רווח, מספר, נקודותיים, מספר, רווח
                // דוגמאות שיתפסו: " 2 : 1 ", " 0:0 "
                const match = cleanText.match(/\s(\d{1,2})\s*:\s*(\d{1,2})\s/);

                if (match) {
                    // יש תוצאה!
                    // בודקים שזה לא השעה (למשל 14:00)
                    // בדרך כלל תוצאות הן עם רווחים ליד הנקודותיים, ושעות בלי.
                    
                    let s1 = match[1];
                    let s2 = match[2];
                    
                    scoreDiv.innerText = `${s2} : ${s1}`; // שים לב: אולי צריך להפוך את הסדר
                    statusDiv.innerText = "עודכן: " + new Date().toLocaleTimeString();
                    statusDiv.style.color = "#888";
                } else {
                    // ניסיון גיבוי - חיפוש ספציפי יותר למבנה של ההתאחדות אם הטקסט הנקי נכשל
                    // לפעמים זה מופיע כ "תוצאת מחצית: 0:0"
                    const backup = cleanText.match(/(\d+)\s*:\s*(\d+)/);
                    if (backup && backup[1].length < 3 && backup[2].length < 3) { // מוודא שזה לא שנה 2026
                         scoreDiv.innerText = `${backup[2]} : ${backup[1]}`;
                         statusDiv.innerText = "זוהה במצב גיבוי";
                    } else {
                        statusDiv.innerText = "הדף התקבל אך התוצאה לא זוהתה";
                        statusDiv.style.color = "orange";
                    }
                }

            } catch (e) {
                console.error(e);
                statusDiv.innerText = "שגיאה בחיבור";
                statusDiv.style.color = "red";
            }
        }

        function toggleDebug() {
            const d = document.getElementById('debug-area');
            d.style.display = d.style.display === 'none' ? 'block' : 'none';
        }

        // הפעלה
        fetchScore();
        setInterval(fetchScore, 20000);

    </script>
</body>
</html>
