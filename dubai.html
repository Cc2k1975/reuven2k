<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>×“×•×‘××™ ××˜×¨×• - PRO</title>
  <style>
    :root { --brand: #2563eb; --bg: #f8fafc; --red: #ef4444; --yellow: #fff9c4; --green: #16a34a; }
    body { margin: 0; font-family: system-ui, sans-serif; background: var(--bg); padding: 10px; color: #1e293b; }
    .card { background: white; border-radius: 20px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 500px; margin: auto; }
    
    /* ××—×©×‘×•×Ÿ ×”××¨×” ××©×§×œ ×œ×“×™×¨×”× */
    .converter { background: #e2e8f0; padding: 12px; border-radius: 12px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 8px; align-items: center; border: 1px solid #cbd5e1; }
    .conv-row { display: flex; gap: 10px; align-items: center; width: 100%; justify-content: center; }
    .converter input { width: 80px; padding: 8px; border-radius: 8px; border: 2px solid var(--brand); font-weight: bold; font-size: 16px; text-align: center; }
    .converter span { font-weight: bold; font-size: 14px; min-width: 60px; }

    .selectors { display: grid; grid-template-columns: 1fr 45px 1fr; align-items: end; gap: 5px; margin-bottom: 20px; }
    label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 6px; color: #475569; }
    select { width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #cbd5e1; background: #fff; font-size: 15px; }
    optgroup { font-size: 18px; font-weight: 900; background: #f1f5f9; }

    .swap-btn { background: #f1f5f9; border: 2px solid #cbd5e1; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
    .btn { width: 100%; padding: 18px; background: var(--brand); color: white; border: none; border-radius: 14px; font-size: 20px; font-weight: 800; cursor: pointer; }

    .route-container { margin-top: 25px; border-top: 3px solid #e2e8f0; padding-top: 20px; }
    .v-step { display: flex; gap: 12px; position: relative; padding-bottom: 22px; }
    .v-step:not(:last-child)::after { content: ''; position: absolute; right: 10px; top: 24px; width: 5px; height: 100%; background: var(--red); z-index: 1; }
    .v-dot { width: 26px; height: 26px; border-radius: 50%; background: #fff; border: 5px solid var(--red); z-index: 2; flex-shrink: 0; }
    .v-text { font-size: 16px; flex-grow: 1; }
    
    .walk-box { background: var(--yellow); padding: 12px; border-radius: 10px; margin-top: 10px; border: 2px solid #fbc02d; }
    .exit-info { color: var(--green); font-weight: 800; display: block; margin-top: 5px; border-top: 1px dashed #16a34a; padding-top: 5px; }
    
    #compass-container { display: none; text-align: center; margin-top: 15px; padding: 15px; background: #000; color: #0f0; border-radius: 15px; }
    #arrow { font-size: 50px; transition: transform 0.2s; display: inline-block; }
  </style>
</head>
<body>

<div class="card">
  <div class="converter">
    <div class="conv-row">
      <span>â‚ª ×©×§×œ×™×:</span>
      <input type="number" id="ils_input" placeholder="0" oninput="convertIlsToAed(this.value)">
      <span> = </span>
      <b id="aed_res" style="color: var(--brand); width: 60px; text-align: center;">0</b> <span>×“×™×¨×”×</span>
    </div>
    <div class="conv-row">
      <span>×“×•×‘××™ AED:</span>
      <input type="number" id="aed_input" placeholder="0" oninput="convertAedToIls(this.value)">
      <span> = </span>
      <b id="ils_res" style="color: var(--brand); width: 60px; text-align: center;">0</b> <span>×©×§×œ×™×</span>
    </div>
  </div>

  <div class="selectors">
    <div><label>××•×¦×</label><select id="from"></select></div>
    <div class="swap-btn" onclick="swap()">â‡„</div>
    <div><label>×™×¢×“</label><select id="to"></select></div>
  </div>

  <button class="btn" onclick="buildRoute()">×ª×›× ×Ÿ ××¡×œ×•×œ</button>

  <div id="output" style="display:none;" class="route-container">
    <div id="vMap"></div>
    <div id="compass-container">
      <div>ğŸ§­ ××›×•×•×Ÿ ×œ×™×¢×“ (×¦× ××”×ª×—× ×” ×•×”×ª×§×“×)</div>
      <div id="arrow">â¬†</div>
      <div id="dist-gps">×”××›×©×™×¨ ××•×›×Ÿ - ×”×ª×—×œ ×œ×œ×›×ª</div>
    </div>
  </div>
</div>

<script>
const RED_LINE = ["DMCC", "Sobha Realty", "Al Khail", "Onpassive", "Business Bay", "Burj Khalifa / Dubai Mall", "Financial Centre", "Emirates Towers", "World Trade Centre", "Max", "ADCB", "BurJuman", "Union", "Deira City Centre", "Al Rigga", "GGICO", "Airport T1", "Airport T3", "Mall of the Emirates", "Equiti", "Mashreq", "Dubai Internet City"];

const DATA = {
  "âœˆï¸ ×©×“×” ×ª×¢×•×¤×”": [
    { id: "air3", name: "×©×“×” ×ª×¢×•×¤×” ×˜×¨××™× ×œ 3", station: "Airport T3", exit: "Exit 1 - Departure", walk: "3 ×“×§'" },
    { id: "air1", name: "×©×“×” ×ª×¢×•×¤×” ×˜×¨××™× ×œ 1", station: "Airport T1", exit: "Exit 1 - Arrivals", walk: "3 ×“×§'" }
  ],
  "ğŸ¨ ××œ×•× ×•×ª": [
    { id: "lux", name: "××œ×•×Ÿ LUXE JBR", station: "DMCC", exit: "Exit 1 (JBR Side)", walk: "12 ×“×§'" },
    { id: "para", name: "××œ×•×Ÿ Paramount", station: "Business Bay", exit: "Exit 1 (SZR South)", walk: "10 ×“×§'" }
  ],
  "ğŸ›’ ×§× ×™×•×ª ×‘×–×•×œ": [
    { id: "d2d_k", name: "DAY TO DAY ×›×¨××” (×–×•×œ)", station: "ADCB", exit: "Exit 1 (Sheikh Khalifa St)", walk: "5 ×“×§'" },
    { id: "d2d_d", name: "DAY TO DAY ×“×™×™×¨×” (×–×•×œ)", station: "Deira City Centre", exit: "Exit 1 (City Centre Side)", walk: "2 ×“×§'" },
    { id: "gift_v", name: "GIFT VILLAGE (××ª× ×•×ª ×‘×–×•×œ)", station: "Max", exit: "Exit 1 (Zabeel Park)", walk: "8 ×“×§'" }
  ],
  "ğŸ½ï¸ ××•×›×œ ×‘×–×•×œ (×¢×“ 50 ×©×—)": [
    { id: "safadi", name: "AL SAFADI (×¢×“ 50 ×©×—)", station: "Emirates Towers", exit: "Exit 1 (DIFC Side)", walk: "6 ×“×§'" },
    { id: "fish_h", name: "FISH HUT (×¢×“ 50 ×©×—)", station: "Mall of the Emirates", exit: "Exit 1 (Al Barsha)", walk: "15 ×“×§'" }
  ]
};

// ×œ×•×’×™×§×ª ×”××¨×” ××¢×•×“×›× ×ª ×œ×¤×™ ×©×¢×¨ 1.18
const RATE = 1.18;

function convertIlsToAed(val) {
  const res = val / RATE;
  document.getElementById('aed_res').innerText = val ? res.toFixed(1) : "0";
}

function convertAedToIls(val) {
  const res = val * RATE;
  document.getElementById('ils_res').innerText = val ? res.toFixed(1) : "0";
}

function swap() {
  const f = document.getElementById('from');
  const t = document.getElementById('to');
  const temp = f.value;
  f.value = t.value;
  t.value = temp;
  buildRoute();
}

function fillSelects() {
  let h = '';
  for (let c in DATA) {
    h += `<optgroup label="${c}">`;
    DATA[c].forEach(p => h += `<option value="${p.id}">${p.name}</option>`);
    h += `</optgroup>`;
  }
  document.getElementById('from').innerHTML = h;
  document.getElementById('to').innerHTML = h;
  document.getElementById('from').value = "lux";
}

function buildRoute() {
  let p1, p2;
  for (let c in DATA) {
    let f1 = DATA[c].find(p => p.id === document.getElementById('from').value); if(f1) p1 = f1;
    let f2 = DATA[c].find(p => p.id === document.getElementById('to').value); if(f2) p2 = f2;
  }
  
  const idx1 = RED_LINE.indexOf(p1.station);
  const idx2 = RED_LINE.indexOf(p2.station);
  if (idx1 === -1 || idx2 === -1) return;

  document.getElementById('output').style.display = 'block';
  document.getElementById('compass-container').style.display = 'block';

  let st = RED_LINE.slice(Math.min(idx1, idx2), Math.max(idx1, idx2) + 1);
  if (idx1 > idx2) st.reverse();

  let html = `<div class="v-step"><div class="v-dot active"></div><div class="v-text"><b>×¦× ×: ${p1.name}</b></div></div>`;
  for (let i = 1; i < st.length - 1; i++) {
    html += `<div class="v-step"><div class="v-dot small"></div><div class="v-text" style="color:#64748b;font-size:12px">${st[i]}</div></div>`;
  }
  
  html += `
    <div class="v-step">
      <div class="v-dot active"></div>
      <div class="v-text">
        <b>×¨×“ ×‘×ª×—× ×ª: ${p2.station}</b>
        <div class="walk-box">
          <b>×¡×¤×•×¨: ${st.length - 1} ×ª×—× ×•×ª ×‘××˜×¨×•</b><br>
          <b>×™×¢×“ ×¡×•×¤×™: ${p2.name}</b><br>
          ğŸš¶â€â™‚ï¸ ×”×œ×™×›×”: ×›-${p2.walk}<br>
          <span class="exit-info">ğŸ ×¦× ×‘: ${p2.exit}</span>
        </div>
      </div>
    </div>`;

  document.getElementById('vMap').innerHTML = html;
  startGps();
}

function startGps() {
  if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition(pos => {
      const heading = pos.coords.heading || 0;
      document.getElementById('arrow').style.transform = `rotate(${heading}deg)`;
    }, null, { enableHighAccuracy: true });
  }
}

fillSelects();
</script>
</body>
</html>
