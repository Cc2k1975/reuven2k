<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waze Commander</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #micBtn {
            width: 70vw;
            height: 70vw;
            max-width: 350px;
            max-height: 350px;
            border-radius: 50%;
            border: none;
            background-color: #33ccff;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        #micBtn:active { transform: scale(0.95); }

        #icon { font-size: 4rem; margin-bottom: 10px; }

        #statusText {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            min-height: 30px;
        }

        #debugText {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
            background: #e0e0e0;
            padding: 5px 10px;
            border-radius: 5px;
            display: none;
        }

        .listening {
            background-color: #ff4444 !important;
            animation: pulse 1.0s infinite;
        }

        .success { background-color: #00C853 !important; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
        }
    </style>
</head>
<body>

    <button id="micBtn" onclick="startListening()">
        <div id="icon">⚡</div>
        <div id="btnText">לחץ ודבר</div>
    </button>

    <div id="statusText">המערכת מוכנה</div>
    <div id="debugText"></div>

    <script>
        // ==========================================
        //         איזור עריכת המקומות - שים לב לשינוי!
        // ==========================================
        // במקום https://waze.com השתמשנו ב- waze://
        const locations = {
            "הביתה": "waze://?q=Home", 
            "בית": "waze://?q=Home", 
            "עבודה": "waze://?q=Work",
            "סופר": "waze://?q=Supermarket",
            // דוגמה לכתובת ספציפית:
            // "תל אביב": "waze://?q=Tel%20Aviv"
        };
        // ==========================================

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const micBtn = document.getElementById("micBtn");
        const btnText = document.getElementById("btnText");
        const statusText = document.getElementById("statusText");
        const debugText = document.getElementById("debugText");
        let recognition;
        let isProcessing = false;

        function startListening() {
            if (!SpeechRecognition) {
                alert("הדפדפן לא תומך.");
                return;
            }
            
            if (isProcessing) return;

            recognition = new SpeechRecognition();
            recognition.lang = 'he-IL';
            recognition.interimResults = true;
            recognition.maxAlternatives = 1;

            recognition.start();

            micBtn.className = "listening";
            btnText.innerText = "מקשיב...";
            statusText.innerText = "דבר...";
            debugText.style.display = "none";

            recognition.onresult = (event) => {
                let transcript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');

                debugText.style.display = "block";
                debugText.innerText = `מזהה: "${transcript}"`;

                for (let key in locations) {
                    if (transcript.includes(key)) {
                        recognition.stop();
                        triggerAction(key, locations[key]);
                        return;
                    }
                }
            };

            recognition.onspeechend = () => {
                if (!isProcessing) {
                    resetUI();
                }
            };

            recognition.onerror = (event) => {
                if (event.error === 'no-speech') return;
                resetUI();
                statusText.innerText = "לא שמעתי, נסה שוב";
            };
        }

        function triggerAction(name, url) {
            isProcessing = true;

            micBtn.className = "success";
            btnText.innerText = "פותח...";
            statusText.innerText = `פותח ניווט ל-${name}`;
            
            // השהייה קטנטנה ואז שיגור לאפליקציה
            setTimeout(() => {
                // שימוש ב-location.href עם waze:// גורם למעבר אפליקציה
                // בלי לנווט את הדפדפן לדף חדש, כך שהדף נשאר קיים
                window.location.href = url;
                
                // מחזירים את הכפתור למצב "מוכן" אחרי 2 שניות
                // כדי שיהיה מוכן כשתחזור לאפליקציה
                setTimeout(() => {
                    resetUI();
                    isProcessing = false;
                    statusText.innerText = "המערכת מוכנה לפקודה הבאה";
                }, 2000);
                
            }, 500); 
        }

        function resetUI() {
            micBtn.className = "";
            btnText.innerText = "לחץ ודבר";
        }
    </script>
</body>
</html>
