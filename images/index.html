<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>גלריה – 2 בעמודה + לייטבוקס חלק</title>
<style>
  :root{
    --gap:10px;
    --thumb-radius:12px;
    --open-dur:700ms;       /* ארוך יותר, מקצועי ונעים */
    --shadow:0 10px 28px rgba(0,0,0,.20);
  }
  html,body{margin:0;background:#f7f8fa;color:#0f172a;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:14px auto 28px;padding:0 12px}
  h1{font-size:1.1rem;font-weight:800;margin:14px 4px}
  .note{font-size:.9rem;color:#475569;margin:0 4px 10px}

  /* רשת – 2 עמודות במובייל בוודאות */
  .gallery{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr)) !important;
    gap:var(--gap);
  }
  @media (min-width:700px){ .gallery{ grid-template-columns:repeat(3, minmax(0,1fr)) } }
  @media (min-width:1000px){ .gallery{ grid-template-columns:repeat(4, minmax(0,1fr)) } }

  .thumb{
    position:relative; overflow:hidden; border-radius:var(--thumb-radius);
    background:#e9edf3; aspect-ratio:1/1;
    box-shadow:0 1px 0 rgba(0,0,0,.03) inset;
  }
  .thumb img{
    width:100%; height:100%; object-fit:cover; display:block;
    transform:scale(0.975);         /* “קצת-קצת” קטן */
    transition:transform 200ms ease, filter 200ms ease;
  }
  .thumb:hover img{ transform:scale(1.0); filter:contrast(1.03) saturate(1.03) }

  /* לייטבוקס עם פתיחה/סגירה ארוכה יותר */
  .lightbox{
    position:fixed; inset:0; background:rgba(0,0,0,.86);
    display:flex; align-items:center; justify-content:center;
    opacity:0; pointer-events:none; transition:opacity var(--open-dur) ease;
    z-index:9999;
  }
  .lightbox.open{ opacity:1; pointer-events:auto }
  .lb-img-wrap{
    max-width:94vw; max-height:86vh;
    transform:translateY(12px) scale(.955);
    transition:transform var(--open-dur) cubic-bezier(.22,.7,.2,1);
  }
  .lightbox.open .lb-img-wrap{ transform:translateY(0) scale(1) }
  .lightbox img{
    max-width:94vw; max-height:86vh; width:auto; height:auto;
    border-radius:16px; box-shadow:var(--shadow); display:block;
  }
  .lb-close{
    position:fixed; top:14px; inset-inline-end:14px; width:38px; height:38px;
    border-radius:999px; background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.22); color:#fff; font-weight:800;
    line-height:38px; text-align:center; cursor:pointer; user-select:none;
    backdrop-filter:saturate(120%) blur(6px);
    transition:background 160ms ease, transform 160ms ease;
  }
  .lb-close:hover{ background:rgba(255,255,255,.22); transform:scale(1.06) }

  .empty{
    background:#fff; border:1px dashed #cbd5e1; color:#475569;
    padding:18px; border-radius:12px; text-align:center; margin-top:14px; word-wrap:break-word;
  }
  code{background:#e2e8f0;border-radius:6px;padding:0 .35em}
</style>
</head>
<body>
  <div class="wrap">
    <h1>גלריה</h1>
    <p class="note" id="dbg"></p>
    <div id="gallery" class="gallery" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none"></div>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="תצוגת תמונה מוגדלת">
    <button class="lb-close" id="lbClose" aria-label="סגור"><span aria-hidden="true">×</span></button>
    <div class="lb-img-wrap"><img id="lbImg" alt=""></div>
  </div>

<script>
/* ========= קונפיג =========
   אפשר למלא כאן, או להעביר בפרמטרים לכתובת:
   ?user=reuven2k&repo=site&branch=main&path=images
*/
const CFG = {
  user  : "USERNAME_HERE",
  repo  : "REPO_HERE",
  branch: "main",
  path  : "images"
};

// קריאת פרמטרים מה-URL (נוח לבדיקה בלי לערוך קובץ)
const usp = new URLSearchParams(location.search);
for (const k of ["user","repo","branch","path"]) if (usp.get(k)) CFG[k] = usp.get(k);

const IMG_EXTS = ["jpg","jpeg","png","gif","webp","avif"];
const dbgEl = document.getElementById("dbg");

function setDebug(msg){
  dbgEl.textContent = msg;
  console.log("[gallery]", msg);
}

function showEmpty(msg){
  const el = document.getElementById("empty");
  el.style.display = "block";
  el.innerHTML = msg;
}

async function loadImagesFromGithub(){
  const {user, repo, branch, path} = CFG;
  if(!user || !repo || !branch || !path){
    showEmpty("⚠️ חסר קונפיגורציה. מלא <code>user</code>, <code>repo</code>, <code>branch</code>, <code>path</code> (או העבר אותם בפרמטרים ל-URL).");
    throw new Error("Missing config");
  }
  const api = `https://api.github.com/repos/${encodeURIComponent(user)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
  setDebug(`טוען מ-GitHub API: ${api}`);
  const res = await fetch(api, { headers:{ 'Accept':'application/vnd.github+json' }});
  if(!res.ok){
    let txt = `❌ שגיאת GitHub API (סטטוס ${res.status}).`;
    if(res.status===404) txt += " בדוק שה-repo ציבורי, שהנתיב קיים, ושם משתמש/ריפו/ענף/נתיב נכונים.";
    if(res.status===403) txt += " ייתכן rate limit ללא התחברות, או repo פרטי (דפדפן לא יוכל למשוך בלי token).";
    showEmpty(txt + "<br>עודכן גם בקונסול.");
    throw new Error("GitHub API error " + res.status);
  }
  /** @type {{name:string, type:string, download_url?:string}[]} */
  const items = await res.json();
  // רק קבצי תמונה ישירים (לא תת-תיקיות)
  const urls = items
    .filter(it => it.type==="file" && it.name && IMG_EXTS.includes(it.name.split(".").pop().toLowerCase()))
    .map(it => it.download_url)
    .filter(Boolean);

  // מיון אלפביתי יציב (אפשר לשנות לתאריך לפי צורך אם שומרים metadata)
  urls.sort((a,b)=>a.localeCompare(b));
  return urls;
}

function createThumb(src, alt="תמונה"){
  const div = document.createElement("div");
  div.className = "thumb";
  const img = document.createElement("img");
  img.loading = "lazy";
  img.decoding = "async";
  img.src = src;
  img.alt = alt;
  div.appendChild(img);
  div.addEventListener("click", ()=>openLightbox(src, alt));
  return div;
}

function renderGallery(urls){
  const gal = document.getElementById("gallery");
  gal.innerHTML = "";
  if(!urls.length){
    showEmpty("לא נמצאו קבצי תמונה בתיקייה שציינת. ודא שיש שם קבצים עם סיומות: " + IMG_EXTS.join(", "));
    return;
  }
  document.getElementById("empty").style.display = "none";
  urls.forEach(u => gal.appendChild(createThumb(u)));
}

/* ===== לייטבוקס ===== */
const lb = document.getElementById("lightbox");
const lbImg = document.getElementById("lbImg");
const lbClose = document.getElementById("lbClose");

function openLightbox(src, alt){
  lbImg.src = src; lbImg.alt = alt || "תמונה";
  lb.classList.add("open");
  lb.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden";
}

function closeLightbox(){
  lb.classList.remove("open");
  lb.setAttribute("aria-hidden","true");
  // ננקה את ה-src אחרי שהאנימציה נגמרת כדי למנוע “קפיצה”
  setTimeout(()=>{ lbImg.src = ""; }, 30);
  document.body.style.overflow = "";
}
lb.addEventListener("click", (e)=>{
  if(e.target === lb || e.target === lbClose) closeLightbox();
});
document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeLightbox(); });

/* ===== אתחול ===== */
(async function init(){
  try{
    const urls = await loadImagesFromGithub();
    renderGallery(urls);
  }catch(err){
    console.error(err);
    if(!document.getElementById("empty").innerHTML){
      showEmpty("לא ניתן לטעון תמונות כרגע. ראה פירוט בקונסול (F12).");
    }
  }
})();
</script>
</body>
</html>
