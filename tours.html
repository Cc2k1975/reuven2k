<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>×ª×›× ×•×Ÿ ×˜×™×•×œ ××©×•×“×¨×’ 3.0</title>
  <style>
    /* ×”×’×“×¨×•×ª ×‘×¡×™×¡ ×•×¢×™×¦×•×‘ ××•×‘×™×™×œ ××©×•×¤×¨ (21) */
    :root {
      --primary: #007aff;
      --bg: #f5f5f7;
      --card: #ffffff;
      --text: #1d1d1f;
      --border: #d2d2d7;
      --success: #34c759;
      --danger: #ff3b30;
      --edit: #ff9500;
      --secondary: #5856d6;
    }

    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: var(--bg); color: var(--text); margin: 0; }
    
    h1 { text-align: center; margin-bottom: 20px; font-weight: 700; }

    /* ×“×©×‘×•×¨×“ ×¡×˜×˜×™×¡×˜×™×§×•×ª (30, 68, 122) - ×¢×•×“×›×Ÿ ×œ-5 ×¢××•×“×•×ª */
    .dashboard {
      background: var(--card);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      border: 1px solid var(--border);
      text-align: center;
    }
    .stat-box { 
      flex: 1 1 18%; /* 5 ×¢××•×“×•×ª ×‘×¨×•×—×‘ ××œ× */
      min-width: 120px; 
      padding: 5px;
    }
    .stat-title { font-size: 0.85em; color: #86868b; display: block; margin-bottom: 3px; }
    .stat-value { font-size: 1.2em; font-weight: bold; color: var(--primary); }
    .countdown { color: var(--danger); }
    .fill-needed { color: var(--edit); }

    /* ×§×œ×˜ ×™××™× ××ª×•×›× × ×™× */
    #totalTripDays {
      width: 80px; 
      text-align: center; 
      margin: 5px auto 0; 
      font-size: 1em;
      padding: 5px;
    }

    /* ×˜×•×¤×¡ (46, 95) */
    .form-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .form-group { display: flex; flex-direction: column; }
    
    label { font-size: 0.9em; font-weight: 600; margin-bottom: 5px; color: #333; }
    
    select, input:not([type="checkbox"]), button { 
      font-size: 16px; 
      padding: 10px; 
      border: 1px solid var(--border); 
      border-radius: 8px; 
      background: #fff;
      width: 100%; 
      box-sizing: border-box; 
    }
    
    /* ×©×“×•×ª ×§×˜× ×™× ×œ×–××Ÿ ×¤×¢×™×œ×•×ª (95) */
    .activity-time-input {
        font-size: 0.8em; 
        padding: 6px; 
        margin-top: 5px;
    }
    
    .flight-times-group {
        display: flex;
        gap: 10px;
    }
    .flight-times-group > div { flex: 1; }

    /* ×›×¤×ª×•×¨×™× */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    button { flex: 1; cursor: pointer; font-weight: 600; color: white; border: none; min-width: 120px; }
    .btn-save { background-color: var(--primary); }

    #hotelLink { color: var(--primary); cursor: pointer; text-decoration: none; display: block; margin-top: 5px; font-size: 0.9em; }

    /* ×˜×‘×œ×” */
    .table-wrapper { overflow-x: auto; margin-top: 25px; }
    table { width: 100%; border-collapse: collapse; background: white; min-width: 1000px; border-radius: 8px; overflow: hidden;}
    th, td { border: 1px solid #eee; padding: 10px; text-align: center; font-size: 0.9em; vertical-align: middle; }
    th { background-color: #f2f2f7; font-weight: 600; }
    
    .flight-status { /* 36 */
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 4px;
        display: inline-block;
    }
    .status-fly { background-color: #e0f7fa; color: #00bcd4; }
    .status-no-fly { background-color: #fbe9e7; color: #ff5722; }
    .time-badge { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.75em; margin: 2px 0; display: block;}
    
    /* ×›×¤×ª×•×¨×™ ×¢×¨×™×›×”/××—×™×§×” ×‘×˜×‘×œ×” */
    .table-actions button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        margin: 0 3px;
    }
    .table-actions .delete-btn { color: var(--danger); font-size: 1.2em; }
    .table-actions .edit-btn { color: var(--edit); font-size: 1em; font-weight: bold; }

    /* ××•×‘×™×™×œ */
    @media (max-width: 768px) {
      .form-container { grid-template-columns: 1fr; }
      .dashboard { flex-direction: column; }
      .stat-box { border-bottom: 1px solid #eee; padding-bottom: 10px; }
      .stat-box:last-child { border-bottom: none; }
      .actions button { min-width: 48%; }
    }
  </style>
</head>
<body>

  <h1>âœˆï¸ ×ª×›× ×•×Ÿ ×˜×™×•×œ</h1>

  <div class="dashboard" id="dashboard">
    <div class="stat-box">
      <span class="stat-title">â³ ×™××™× ×¢×“ ×”×˜×™×¡×”</span>
      <span class="stat-value countdown" id="daysToTrip">...</span>
    </div>
    <div class="stat-box">
      <span class="stat-title">ğŸ“… ×¡×”"×› ×™××™ ×˜×™×•×œ ×‘××¡×œ×•×œ</span>
      <span class="stat-value" id="totalDays">0</span>
    </div>
    <div class="stat-box">
      <span class="stat-title">ğŸ—“ï¸ ×™××™× ××ª×•×›× × ×™× ×œ×˜×™×•×œ</span>
      <input type="number" id="totalTripDays" min="1" placeholder="×¡×”×› ×™××™×" oninput="updateSummary()">
    </div>
    <div class="stat-box">
      <span class="stat-title">ğŸ“ ×™××™× × ×“×¨×©×™× ×œ××™×œ×•×™</span>
      <span class="stat-value fill-needed" id="daysToFill">...</span>
    </div>
    <div class="stat-box">
      <span class="stat-title">ğŸ¨ ×—×œ×•×§×ª ×œ×™×œ×•×ª ×œ×¤×™ ×¢×™×¨</span>
      <span class="stat-value" id="cityBreakdown" style="font-size: 0.8em; font-weight: normal;">-</span>
    </div>
  </div>

  <div class="form-container">
    <div class="form-group">
      <label>ğŸ“… ×ª××¨×™×š (107):</label>
      <input type="date" id="date" onchange="updateDateDisplay()">
    </div>
    <input type="hidden" id="dateDisplay">

    <div class="form-group">
      <label>âœˆ ×¡×˜×˜×•×¡ ×˜×™×¡×” / ××¢×‘×¨ 1:</label>
      <select id="flight1" onchange="toggleFlightTimes(1)"></select>
    </div>
    <div class="form-group flight-times-group">
        <div>
            <label>ğŸ›« ×©×¢×ª ×”××¨××” 1 (46):</label>
            <input type="time" id="flightDep1" value="">
        </div>
        <div>
            <label>ğŸ›¬ ×©×¢×ª × ×—×™×ª×” 1 (46):</label>
            <input type="time" id="flightArr1" value="">
        </div>
    </div>

    <div class="form-group">
      <label>âœˆ ×¡×˜×˜×•×¡ ×˜×™×¡×” / ××¢×‘×¨ 2 (××•×¤×¦×™×•× ×œ×™):</label>
      <select id="flight2" onchange="toggleFlightTimes(2)"></select>
    </div>
    <div class="form-group flight-times-group">
        <div>
            <label>ğŸ›« ×©×¢×ª ×”××¨××” 2:</label>
            <input type="time" id="flightDep2" value="">
        </div>
        <div>
            <label>ğŸ›¬ ×©×¢×ª × ×—×™×ª×” 2:</label>
            <input type="time" id="flightArr2" value="">
        </div>
    </div>
    
    <div class="form-group">
      <label>ğŸ™ ×¢×™×¨:</label>
      <select id="city" onchange="filterHotels()"></select>
    </div>

    <div class="form-group">
      <label>ğŸ¨ ××œ×•×Ÿ:</label>
      <select id="hotel" onchange="updateHotelLink()"></select>
      <span id="hotelLink" onclick="openHotelLink()"></span>
    </div>

    <div class="form-group">
      <label>ğŸ ×¤×¢×™×œ×•×ª 1 (×™×•×/×‘×•×§×¨):</label>
      <select id="activity1"></select>
      <input type="text" id="act1Time" class="activity-time-input" placeholder="×–××Ÿ ××©×•×¢×¨ (95)">
    </div>

    <div class="form-group">
      <label>ğŸ ×¤×¢×™×œ×•×ª 2 (××—×”"×¦/×¢×¨×‘):</label>
      <select id="activity2"></select>
      <input type="text" id="act2Time" class="activity-time-input" placeholder="×–××Ÿ ××©×•×¢×¨ (95)">
    </div>
  </div>

  <div class="actions">
    <button class="btn-save" onclick="savePlan()">ğŸ’¾ ×©××•×¨ / ×¢×“×›×Ÿ ××¡×œ×•×œ</button>
    <button class="btn-local" style="background-color: var(--secondary);" onclick="saveLocally()">â˜ ×©××•×¨ × ×ª×•× ×™× ××§×•××™×ª</button>
    <button class="btn-wa" style="background-color: #25D366;" onclick="sendToWhatsApp()">ğŸ“¤ ×©×œ×— ×‘×•×•×˜×¡××¤</button>
    <button class="btn-pdf" style="background-color: var(--edit);" onclick="downloadPDF()">ğŸ“„ ×¦×•×¨ PDF</button>
    <button class="btn-clear" onclick="clearAll()">ğŸ§¹ ××—×§ ××ª ×›×œ ×”××¡×œ×•×œ</button>
  </div>

  <div class="table-wrapper">
    <table id="savedTable" style="display:none;">
      <thead>
        <tr>
          <th>×ª××¨×™×š</th>
          <th>××¢×‘×¨×™×/×˜×™×¡×•×ª</th>
          <th>×¢×™×¨</th>
          <th>××œ×•×Ÿ</th>
          <th>×¤×¢×™×œ×•×™×•×ª</th>
          <th>×¢×¨×™×›×”/××—×™×§×”</th>
        </tr>
      </thead>
      <tbody id="savedBody"></tbody>
    </table>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// --- × ×ª×•× ×™× ××§×•×¨×™×™× (×©×•×—×–×¨×• ×œ×¨×©×™××” ××œ××”) ---
const flights = ["×œ×œ× ××¢×‘×¨", "×˜×™×¡×” ×‘×™× ×œ××•××™×ª", "×˜×™×¡×ª ×¤× ×™×", "××¢×‘×•×¨×ª", "××•×˜×•×‘×•×¡/×•×•××Ÿ", "×¨×›×‘×ª"];
const cities = ["×‘× ×’×§×•×§ (Bangkok)", "×•×•×™×˜×¡× ×“ (Wit Sand)", "×—×•× ×”×™×Ÿ (Hua Hin)", "×œ××•×¡ (Lopburi)", "× ××§×•×Ÿ ×¨××¦'××¡×™××” (Nakhon Ratchasima)", "×¡×•×§×•×ª××™ (Sukhothai)", "×¡×•×¨××˜×× ×™ (Surat Thani)", "×¡×™×× ×¨×™×¤ (Siam Reap)", "×¡×¨××¡×™×Ÿ (Sarasins)", "×¤××™ (PAI)", "×¤×•×§×˜ (Phuket)", "×¤×˜××™×” (Pattaya)", "×¦'×× ×’ ×××™ (Chiang Mai)", "×¦'×× ×’ ×¨××™ (Chiang Rai)", "×§×•×” ×˜××• (Koh Tao)", "×§×•×¡××•×™ (Koh Samui)", "×§×•×¤×™×¤×™ (Koh Phi Phi)", "×§×•×¤× ×’×Ÿ (Koh Phangan)", "×§× ×˜×” (Kanchanaburi)", "×§×¨×‘×™ (Krabi)"];
const allActivities = ["--- ×œ×œ× ×¤×¢×™×œ×•×ª ---", "××•××’×•×ª", "×‘×˜×Ÿ ×’×‘", "×‘×™×§×•×¨ ×‘××§×“×©×™×", "×‘×™×§×•×¨ ×‘×¤××¨×§×™× ×œ××•××™×™×", "×’×œ×™×©×ª ×’×œ×™×", "×”×¤×œ×’×•×ª ×¡×™×¨×” ×‘× ×”×¨×•×ª", "×—×•×•×™×™×ª ×¡×¤××¨×™ ×’'×™×¤×™×", "×˜×™×•×œ×™ ×¤×™×œ×™×", "×˜×¨×§×™× ×‘×”×¨×™×", "×™×", "××•×–×™××•× ×™×", "××•×¤×¢ ", "×¡×¤× ×•××¡××’' ×ª××™×œ× ×“×™", "×¤××¨×§ ××™×", "×¦×œ×™×œ×”", "×§××¨×˜×™× ×’", "×§×•×¨×¡×™ ×‘×™×©×•×œ ×ª××™×œ× ×“×™", "×¨××¤×˜×™× ×’", "×¨×›×™×‘×” ×¢×œ ×¡×•×¡×™×", "×©×•×§×™ ×œ×™×œ×”", "×©×™×™×˜ ", "×©× ×•×¨×§×œ×™× ×’", "×ª×¦×¤×™×•×ª × ×•×£ ××”×¨×™×"];
// ×¨×©×™××ª ×”××œ×•× ×•×ª ×”××œ××” ×©×•×—×–×¨×”, ×›×•×œ×œ ×¡×™× ×•×Ÿ ×œ×¤×™ ×¢×™×¨
const allHotels = [
    { name: "*** ×¤×•×§×˜ ***", link: "nan", city: "×¤×•×§×˜" },
    { name: "Angsana Laguna Phuket â€“ ×¨×™×–×•×¨×˜ ××¤×•××¨ ×‘×—×•×£ ×‘×× ×’ ×˜××•, ×¢× ×‘×¨×™×›×” ×¢× ×§×™×ª ×•××ª×§× ×™× ×œ××©×¤×—×•×ª.", link: "https://www.booking.com/hotel/th/angsana-laguna-phuket.html", city: "×¤×•×§×˜" },
    { name: "Burasari Phuket Resort & Spa â€“ ×¨×™×–×•×¨×˜ ×˜×¨×•×¤×™ ××¤× ×§ ×‘×œ×‘ ×¤×˜×•× ×’ ×‘×™×¥', ×¢× ×¡×¤× ×•×‘×¨×™×›×”.", link: "https://www.booking.com/hotel/th/burasari.html", city: "×¤×•×§×˜" },
    { name: "Hotel Clover Patong Phuket â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘××™×§×•× ××¨×›×–×™ ×‘×œ×‘ ×¤×˜×•× ×’, ×¢× ×‘×¨×™×›×” ×•×©×™×¨×•×ª ××¦×•×™×Ÿ", link: "https://www.booking.com/hotel/th/hotel-clover-patong.html", city: "×¤×•×§×˜" },
    { name: "InterContinental Phuket Resort â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×‘×—×•×£ ×§××œ×”, ×¢× × ×•×£ ×œ×™× ×•×©×™×¨×•×ª ××¢×•×œ×”.", link: "https://www.booking.com/hotel/th/intercontinental-phuket-resort.html", city: "×¤×•×§×˜" },
    { name: "JW Marriott Phuket Resort & Spa â€“ ××œ×•×Ÿ ×—××™×©×” ×›×•×›×‘×™× ×¢× ×—×•×£ ×¤×¨×˜×™, ×¡×¤× ××¤× ×§ ×•×©×™×¨×•×ª ×™×•×¦× ×“×•×¤×Ÿ.", link: "https://www.booking.com/hotel/th/jw-marriott-phuket-resort-and-spa.html", city: "×¤×•×§×˜" },
    { name: "Katathani Phuket Beach Resort â€“ ××œ×•×Ÿ ×¢×œ ×—×•×£ ×§××˜×”, ×¢× ×‘×¨×™×›×•×ª, ××¡×¢×“×•×ª ×•× ×•×£ ×œ×™×.", link: "https://www.booking.com/hotel/th/katathani-phuket-beach-resort.html", city: "×¤×•×§×˜" },
    { name: "Novotel Phuket Karon Beach Resort â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×¢× ×‘×¨×™×›×•×ª, ××•×¢×“×•×Ÿ ×™×œ×“×™× ×•××™×§×•× ×©×§×˜.", link: "https://www.booking.com/hotel/th/novotel-phuket-karon-beach-resort-and-spa.html", city: "×¤×•×§×˜" },
    { name: "Phuket Marriott Resort & Spa, Merlin Beach â€“ ××œ×•×Ÿ ×¢× ×—×•×£ ×¤×¨×˜×™, ×‘×¨×™×›×•×ª ×•×¡×¤× ×‘×¨××” ×’×‘×•×”×”.", link: "https://www.booking.com/hotel/th/phuket-marriott-resort-and-spa-merlin-beach.html", city: "×¤×•×§×˜" },
    { name: "$$The Lantern Resorts Patong$$", link: "https://www.booking.com/hotel/th/the-lantern-resort-patong.html", city: "×¤×•×§×˜" },
    { name: "The Slate Phuket â€“ ×¨×™×–×•×¨×˜ ×™×•×§×¨×ª×™ ×¢× ×¢×™×¦×•×‘ ×ª×¢×©×™×™×ª×™ ×™×™×—×•×“×™, ×—×•×£ ×¤×¨×˜×™ ×•×©×™×¨×•×ª ×‘×¨××” ×’×‘×•×”×”.", link: "https://www.booking.com/hotel/th/the-slate.html", city: "×¤×•×§×˜" },
    
    { name: "*** ×¤××˜×™×” ***", link: "nan", city: "×¤×˜××™×”" },
    { name: "$$The Whisper Hotel$$", link: "https://www.booking.com/hotel/th/the-whisper.html", city: "×¤×˜××™×”" },
    { name: "Amari Pattaya â€“ ××œ×•×Ÿ × ×¢×™× ×•××•×“×¨× ×™ ×‘××¨×›×– ×¤××˜×™×”, ×§×¨×•×‘ ×œ××¡×¢×“×•×ª ×•×©×•×•×§×™×.", link: "https://www.booking.com/hotel/th/amari-pattaya.html", city: "×¤×˜××™×”" },
    { name: "Avani Pattaya Resort â€“ ×¨×™×–×•×¨×˜ ×˜×¨×•×¤×™ ×‘×œ×‘ ×¤××˜×™×”, ×¢× ×‘×¨×™×›×” ×’×“×•×œ×”, ××¡×¢×“×•×ª ×•×©×™×¨×•×ª ××¦×•×™×Ÿ.", link: "https://www.booking.com/hotel/th/avani-pattaya-resort.html", city: "×¤×˜××™×”" },
    { name: "Hilton Pattaya â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× × ×•×£ ×¤× ×•×¨××™ ×œ×™×, ×‘×¨×™×›×ª ×’×’ ×•××¡×¢×“×•×ª ×’×•×¨××”.", link: "https://www.booking.com/hotel/th/hilton-pattaya.html", city: "×¤×˜××™×”" },
    { name: "Holiday Inn Pattaya â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×¢× × ×•×£ ×œ×™×, ×‘×¨×™×›×•×ª ×•××¡×¢×“×•×ª ××’×•×•× ×•×ª.", link: "https://www.booking.com/hotel/th/holiday-inn-pattaya.html", city: "×¤×˜××™×”" },
    { name: "InterContinental Pattaya Resort â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× ×—×•×£ ×¤×¨×˜×™, ×¡×¤× ×•×©×™×¨×•×ª ×‘×¨××” ×’×‘×•×”×”.", link: "https://www.booking.com/hotel/th/inter-continental-pattaya-resort.html", city: "×¤×˜××™×”" },
    { name: "Mercure Pattaya Ocean Resort â€“ ××œ×•×Ÿ ××©×¤×—×ª×™ ×¢× ×¤××¨×§ ××™× ×§×˜×Ÿ, ×‘×¨×™×›×•×ª ×•××™×§×•× × ×•×—.", link: "https://www.booking.com/hotel/th/mercure-pattaya-ocean-resort.html", city: "×¤×˜××™×”" },
    { name: "Pattaya Discovery Beach Hotel â€“ ××œ×•×Ÿ ×§×¨×•×‘ ×œ×—×•×£, ×¢× ×—×“×¨×™× ××¨×•×•×—×™× ×•×‘×¨×™×›×”.", link: "https://www.booking.com/hotel/th/pattaya-discovery-beach.html", city: "×¤×˜××™×”" },
    { name: "Royal Cliff Beach Hotel â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× × ×•×£ ×œ×™×, ××¡×¢×“×•×ª ×•×©×™×¨×•×ª ××¦×•×™×Ÿ.", link: "https://www.booking.com/hotel/th/royal-cliff-beach.html", city: "×¤×˜××™×”" },
    { name: "The Zign Hotel â€“ ××œ×•×Ÿ ×¢× ×¢×™×¦×•×‘ ××•×“×¨× ×™, ×‘×¨×™×›×” ×’×“×•×œ×” ×•××¡×¢×“×•×ª ×˜×•×‘×•×ª.", link: "https://www.booking.com/hotel/th/the-zign.html", city: "×¤×˜××™×”" },

    { name: "*** ×‘× ×’×§×•×§ ***", link: "nan", city: "×‘× ×’×§×•×§" },
    { name: "$$Sleepstation at Pratunam$$", link: "https://www.booking.com/hotel/th/sleepstation-pratu-nam.html", city: "×‘× ×’×§×•×§" },
    { name: "Banyan Tree Bangkok â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× ×¡×¤×, ××¡×¢×“×•×ª ×•×‘×¨ ×¢×œ ×”×’×’.", link: "https://www.booking.com/hotel/th/banyan-tree-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: " Chatrium Hotel Riverside Bangkok â€“ ××œ×•×Ÿ ×¢× × ×•×£ ×œ× ×”×¨, ×‘×¨×™×›×” ×’×“×•×œ×” ×•×©×™×¨×•×ª ××¦×•×™×Ÿ.", link: "https://www.booking.com/hotel/th/chatrium-residence-sathon-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: " Novotel Bangkok Sukhumvit 20 â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘××™×§×•× ××¨×›×–×™, ×§×¨×•×‘ ×œ×§× ×™×•× ×™× ×•×œ××¡×¢×“×•×ª.", link: "https://www.booking.com/hotel/th/novotel-bangkok-sukhumvit-20.html", city: "×‘× ×’×§×•×§" },
    { name: " Shangri-La Hotel Bangkok â€“ ××œ×•×Ÿ ×¢×œ ×’×“×•×ª ×”× ×”×¨, ×¢× ×©×™×¨×•×ª ××¢×•×œ×” ×•××¡×¢×“×•×ª ××’×•×•× ×•×ª.", link: "https://www.booking.com/hotel/th/shangri-la-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: " SO Sofitel Bangkok â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×¢× ×¢×™×¦×•×‘ ×™×™×—×•×“×™, ×‘×¨×™×›×” ×¢×œ ×”×’×’ ×•× ×•×£ ×œ×¢×™×¨.", link: "https://www.booking.com/hotel/th/so-sofitel-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: " The Peninsula Bangkok â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× × ×•×£ ×œ× ×”×¨, ×¡×¤× ×•×©×™×¨×•×ª ×‘×¨××” ×’×‘×•×”×”.", link: "https://www.booking.com/hotel/th/the-peninsula-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: "$$Baiyoke Sky Hotel$$", link: "https://www.booking.com/hotel/th/baiyoke-sky.html", city: "×‘× ×’×§×•×§" },
    { name: "$$Miloft Sathorn Hotel - SHA Plus Certified$$", link: "https://www.booking.com/hotel/th/miloft-sathorn.html", city: "×‘× ×’×§×•×§" },
    { name: "$$Spenza Hotel$$", link: "https://www.booking.com/hotel/th/spenza.html", city: "×‘× ×’×§×•×§" },
    { name: "$$The Berkeley Hotel Pratunam$$", link: "https://www.booking.com/hotel/th/the-berkeley-pratunam-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: "$$The Victory Residences Bangkok$$", link: "https://www.booking.com/hotel/th/the-victory-executive-residences.html", city: "×‘× ×’×§×•×§" },
    { name: "$$Top High Airport Link Hotel, Bangkok$$", link: "https://www.booking.com/hotel/th/top-high-airport-link-bangkok.html", city: "×‘× ×’×§×•×§" },
    { name: "Mandarin Oriental Bangkok â€“ ××œ×•×Ÿ ××¤×•××¨ ×¢× ×©×™×¨×•×ª ×™×•×¦× ×“×•×¤×Ÿ, ××¡×¢×“×•×ª ×’×•×¨××” ×•× ×•×£ ×œ× ×”×¨.", link: "https://www.booking.com/hotel/th/mandarin-oriental-bangkok.html", city: "×‘× ×’×§×•×§" },

    { name: "*** ×§××¨×‘×™ ***", link: "nan", city: "×§×¨×‘×™" },
    { name: "$$Panan Krabi Resort$$", link: "https://www.booking.com/hotel/th/panan-krabi-resort.html", city: "×§×¨×‘×™" },
    { name: " Holiday Inn Resort Krabi Ao Nang Beach â€“ ××œ×•×Ÿ × ×”×“×¨ ×œ××©×¤×—×•×ª, ×¢× ×‘×¨×™×›×” ×’×“×•×œ×”.", link: "https://www.booking.com/hotel/th/holiday-inn-resort-krabi-ao-nang-beach.html", city: "×§×¨×‘×™" },
    { name: " Krabi Heritage Hotel â€“ ××œ×•×Ÿ ××¤× ×§ ×‘××¨×›×– ×§×¨××‘×™, ×¢× ×’×™×©×” ×§×œ×” ×œ××˜×¨×§×¦×™×•×ª.", link: "https://www.booking.com/hotel/th/krabi-heritage.html", city: "×§×¨×‘×™" },
    { name: " Krabi Resort â€“ ××œ×•×Ÿ × ×¢×™× ×•×§×¨×•×‘ ×œ×—×•×£, ××ª××™× ×œ×›×œ ×¡×•×’×™ ×”×ª×™×™×¨×™×.", link: "https://www.booking.com/hotel/th/krabi-resort.html", city: "×§×¨×‘×™" },
    { name: " Krabi Sands Resort â€“ ××œ×•×Ÿ ×§×˜×Ÿ ×•× ×¢×™× ×¢× ×’×™×©×” ×œ×—×•×£ ×•×©×™×¨×•×ª ××™×©×™.", link: "https://www.booking.com/hotel/th/krabi-sands-resort.html", city: "×§×¨×‘×™" },
    { name: " Noppharat Resort â€“ ××œ×•×Ÿ ×§×¨×•×‘ ×œ×—×•×£ × ×•×¤××¨××˜, ×¢× ×—×“×¨×™× × ×•×—×™× ×•×‘×¨×™×›×”.", link: "https://www.booking.com/hotel/th/noppharat-resort.html", city: "×§×¨×‘×™" },
    { name: "Krabi Palm Beach Resort â€“ ××œ×•×Ÿ ×¢× ×‘×¨×™×›×”, ××¡×¢×“×” ×•×’×™×©×” × ×•×—×” ×œ×—×•×£.", link: "https://www.booking.com/hotel/th/krabi-palm-beach-resort.html", city: "×§×¨×‘×™" },
    { name: "Phulay Bay, A Ritz-Carlton Reserve â€“ ××ª×¨ × ×•×¤×© ×™×•×§×¨×ª×™ ×•×©×§×˜ ×¢× ×©×™×¨×•×ª ××™×©×™.", link: "https://www.booking.com/hotel/th/phulay-bay-a-ritz-carlton-reserve.html", city: "×§×¨×‘×™" },
    { name: "Rayavadee â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×•×‘×œ×¢×“×™ ×¢×œ ×—×•×£ ×¤×¨×˜×™, ××ª××™× ×œ× ×•×¤×© ×¨×’×•×¢.", link: "https://www.booking.com/hotel/th/rayavadee.html", city: "×§×¨×‘×™" },

    { name: "*** ×¦'×× ×’ ×××™ ***", link: "nan", city: "×¦'×× ×’ ×××™" },
    { name: "Anantara Chiang Mai Resort â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢×œ ×’×“×•×ª × ×”×¨ ×”×¤×™× ×’, ×¢× ×¢×™×¦×•×‘ ××•×“×¨× ×™ ×•×©×™×¨×•×ª ××¢×•×œ×”.", link: "https://www.booking.com/hotel/th/anantara-chiang-mai-resort.he.html", city: "×¦'×× ×’ ×××™" },
    { name: " U Nimman Chiang Mai â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘××–×•×¨ × ×™×××Ÿ, ×§×¨×•×‘ ×œ×‘×ª×™ ×§×¤×” ×•×—× ×•×™×•×ª.", link: "https://www.booking.com/hotel/th/u-nimman-chiang-mai.he.html", city: "×¦'×× ×’ ×××™" },
    { name: " Yaang Come Village â€“ ××œ×•×Ÿ ×‘×¡×’× ×•×Ÿ ×ª××™×œ× ×“×™ ××¡×•×¨×ª×™, ×¢× ×’× ×™× ×˜×¨×•×¤×™×™× ×•×‘×¨×™×›×”.", link: "https://www.booking.com/hotel/th/yaang-come-village-hotel.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "137 Pillars House â€“ ××œ×•×Ÿ ×‘×•×˜×™×§ ×™×•×§×¨×ª×™ ×¢× ×¢×™×¦×•×‘ ×§×•×œ×•× ×™××œ×™, ×©×™×¨×•×ª ××™×©×™ ×•×‘×¨×™×›×” ×™×¤×”×¤×™×™×”.", link: "https://www.booking.com/hotel/th/137-pillars-house.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "De Naga Hotel Chiang Mai â€“ ××œ×•×Ÿ ×‘×•×˜×™×§ ×‘××¨×›×– ×”×¢×™×¨, ×¢× ×¢×™×¦×•×‘ ×™×™×—×•×“×™ ×•×©×™×¨×•×ª ××¦×•×™×Ÿ.", link: "https://www.booking.com/hotel/th/de-naga-hotel.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "Four Seasons Resort Chiang Mai â€“ ××ª×¨ × ×•×¤×© ××¤×•××¨ ×‘×œ×‘ ×©×“×•×ª ××•×¨×–, ×¢× × ×•×£ ×¢×•×¦×¨ × ×©×™××” ×•××•×•×™×¨×” ×¨×’×•×¢×”.", link: "https://www.booking.com/hotel/th/four-seasons-resort-chiang-mai.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "Le Meridien Chiang Mai â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘××¨×›×– ×”×¢×™×¨, ×§×¨×•×‘ ×œ×©×•×§ ×”×œ×™×œ×” ×•×œ××¡×¢×“×•×ª.", link: "https://www.booking.com/hotel/th/le-meridien-chiang-mai.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "Rachamankha Hotel â€“ ××œ×•×Ÿ ×‘×•×˜×™×§ ×¢× ×¢×™×¦×•×‘ ××¡×•×¨×ª×™, ××•×•×™×¨×” ×©×§×˜×” ×•×§×¨×‘×” ×œ××§×“×©×™×.", link: "https://www.booking.com/hotel/th/rachamankha.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "Shangri-La Hotel Chiang Mai â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢× ××ª×§× ×™× ××¦×•×™× ×™×, ×›×•×œ×œ ×¡×¤× ×•×‘×¨×™×›×” ×’×“×•×œ×”.", link: "https://www.booking.com/hotel/th/shangri-la-chiang-mai.he.html", city: "×¦'×× ×’ ×××™" },
    { name: "Tamarind Village â€“ ××œ×•×Ÿ ×‘×•×˜×™×§ ×‘×œ×‘ ×”×¢×™×¨ ×”×¢×ª×™×§×”, ×¢× ×¢×™×¦×•×‘ ×œ× ×” ××¡×•×¨×ª×™ ×•×©×™×¨×•×ª ×—×.", link: "https://www.booking.com/hotel/th/tamarind-village.he.html", city: "×¦'×× ×’ ×××™" },

    { name: "*** ×¦'×× ×’ ×¨××™ ***", link: "nan", city: "×¦'×× ×’ ×¨××™" },
    { name: " Le Meridien Chiang Rai Resort â€“ ××œ×•×Ÿ ×™×•×§×¨×ª×™ ×¢×œ ×’×“×•×ª × ×”×¨ ×§×•×§...", link: "https://www.booking.com/hotel/th/le-meridien-chiang-rai-resort.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Anantara Golden Triangle Elephant Camp & Resort â€“ ××ª×¨ × ×•×¤×© ×™×•×§×¨×ª×™ ×¢× ××—× ×” ×¤×™×œ×™×...", link: "https://www.booking.com/hotel/th/anantara-golden-triangle-elephant-camp-resort.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Bura Resort Chiang Rai â€“ ××ª×¨ × ×•×¤×© ×‘×˜×‘×¢, ×¢× ×‘×§×ª×•×ª ×¢×¥ ×•× ×•×£ ×œ×”×¨×™×.", link: "https://www.booking.com/hotel/th/bura-resort-chiang-rai.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Dusit Island Resort â€“ ××œ×•×Ÿ ×¢×œ ××™ ×§×˜×Ÿ ×‘× ×”×¨, ×¢× × ×•×£ ×™×¤×”×¤×” ×•××ª×§× ×™× ××¦×•×™× ×™×.", link: "https://www.booking.com/hotel/th/dusit-island-resort-chiang-rai.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Laluna Hotel and Resort â€“ ××œ×•×Ÿ ×¢× ×‘×•× ×’×œ×•×¡ ×‘×’× ×™× ×˜×¨×•×¤×™×™×...", link: "https://www.booking.com/hotel/th/laluna-hotel-resort-chiangrai.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Le Patta Hotel Chiang Rai â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘××¨×›×– ×”×¢×™×¨...", link: "https://www.booking.com/hotel/th/le-patta-hotel-chiang-rai.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " Mora Boutique Hotel â€“ ××œ×•×Ÿ ×‘×•×˜×™×§ ×¢× ×¢×™×¦×•×‘ ××œ×’× ×˜×™...", link: "https://www.booking.com/hotel/th/mora-boutique.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " The Imperial River House Resort â€“ ××œ×•×Ÿ ×¢×œ ×’×“×•×ª ×”× ×”×¨...", link: "https://www.booking.com/hotel/th/the-imperial-river-house-resort.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " The Legend Chiang Rai Boutique River Resort & Spa â€“ ××ª×¨ × ×•×¤×© ×‘×•×˜×™×§ ×¢×œ ×’×“×•×ª ×”× ×”×¨...", link: "https://www.booking.com/hotel/th/the-legend-chiang-rai-river-resort-spa.he.html", city: "×¦'×× ×’ ×¨××™" },
    { name: " The Riverie by Katathani â€“ ××œ×•×Ÿ ××•×“×¨× ×™ ×‘×œ×‘ ×”×¢×™×¨...", link: "https://www.booking.com/hotel/th/the-riverie-by-katathani.he.html", city: "×¦'×× ×’ ×¨××™" },

    { name: "***×§×•×¡××•×™***", link: "nan", city: "×§×•×¡××•×™" },
    { name: "$$Combo Beach Hotel Samui$$", link: "https://www.booking.com/hotel/th/combo-beach-samui.he.html", city: "×§×•×¡××•×™" },
    { name: "$$Arkbar Beach Club$$", link: "https://www.booking.com/hotel/th/arkbar-beach-club.he.html", city: "×§×•×¡××•×™" },
    { name: "$$Chaweng Villawee Hotel$$", link: "https://www.booking.com/hotel/th/chaweng-villawee-hotel.he.html", city: "×§×•×¡××•×™" },
    { name: "$$Muang Samui Spa Resort - SHA Extra Plus$$", link: "https://www.booking.com/hotel/th/muang-samui-spa-resort.he.html", city: "×§×•×¡××•×™" },

    { name: "***×§×•×¤× ×’×Ÿ***", link: "nan", city: "×§×•×¤× ×’×Ÿ" },
    { name: "$$Vannee Golden Sands Beachfront Resort$$", link: "https://www.booking.com/hotel/th/vannee-golden-sands-beachfront-resort.he.html", city: "×§×•×¤× ×’×Ÿ" },
    { name: "$$The Cabin Beach Resort$$", link: "https://www.booking.com/hotel/th/the-cabin-beach-resort.he.html", city: "×§×•×¤× ×’×Ÿ" },
];


// --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×•-UI ---

// ××™×œ×•×™ ×¨×©×™××•×ª ×‘×—×™×¨×”
function fillSelect(id, list) {
  const sel = document.getElementById(id);
  sel.innerHTML = "";
  if(id.startsWith("activity")) {
      sel.appendChild(new Option(list[0], list[0]));
      list = list.slice(1);
  } else {
      sel.appendChild(new Option("--- ×œ×œ× ××¢×‘×¨ ---", "×œ×œ× ××¢×‘×¨"));
  }
  list.forEach(item => sel.appendChild(new Option(item, item)));
}

// ğŸ¨ ×¡×™× ×•×Ÿ ××œ×•× ×•×ª ×œ×¤×™ ×¢×™×¨ ×©× ×‘×—×¨×” (××©×•×¤×¨)
function filterHotels() {
    const selectedCity = document.getElementById("city").value;
    // ×”×¡×¨×ª ×¡×•×’×¨×™×™× ×•×˜×§×¡×˜ ×œ×•×¢×–×™ ×œ×¡×™× ×•×Ÿ
    const cleanCityName = selectedCity.split(" (")[0].trim(); 
    const sel = document.getElementById("hotel");
    sel.innerHTML = "";
    sel.appendChild(new Option("", "")); // ××•×¤×¦×™×” ×¨×™×§×”

    // ××¦×™×’ ××œ×•× ×•×ª ×©×ª×•×××™× ×œ×¢×™×¨ ×©× ×‘×—×¨×”
    const filtered = allHotels.filter(h => 
        // ×‘×•×“×§ ×× ×©× ×”×¢×™×¨ × ×›×œ×œ ×‘×©×“×” ×”-city ×©×œ ×”××œ×•×Ÿ
        h.city.includes(cleanCityName)
    );

    filtered.forEach(h => {
        const opt = new Option(h.name, h.name);
        opt.dataset.link = h.link;
        if(h.name.includes("***")) { // ×”×“×’×©×ª ×›×•×ª×¨×•×ª ×”××œ×•× ×•×ª
            opt.disabled = true;
            opt.style.fontWeight = "bold";
            opt.style.backgroundColor = "#f7f7f7";
        }
        sel.appendChild(opt);
    });
    
    // ×× ×¡×” ×œ×‘×—×•×¨ ××ª ×”××œ×•×Ÿ ×”××—×¨×•×Ÿ ×©× ×‘×—×¨, ×× ×§×™×™×
    const currentData = JSON.parse(document.getElementById("savedTable").dataset.currentEdit || "{}");
    if (currentData.hotel) {
        sel.value = currentData.hotel;
    }

    updateHotelLink(); 
}

function updateHotelLink() {
  const sel = document.getElementById("hotel");
  const link = sel.options[sel.selectedIndex]?.dataset.link;
  const label = document.getElementById("hotelLink");
  if(link && link !== "nan") {
      label.textContent = "ğŸ¨ ×œ×—×¥ ×œ×¤×¨×˜×™ ×”××œ×•×Ÿ";
      label.dataset.url = link;
  } else {
      label.textContent = "";
      label.dataset.url = "";
  }
}

function openHotelLink() {
  const url = document.getElementById("hotelLink").dataset.url;
  if (url) window.open(url, '_blank');
}

// ××¢×“×›×Ÿ ××ª ×©×“×” ×”×˜×§×¡×˜ ×”× ×¡×ª×¨ ×¢×‘×•×¨ ×”×˜×‘×œ×”
function updateDateDisplay() {
    const dateInput = document.getElementById("date").value;
    if (!dateInput) {
        document.getElementById("dateDisplay").value = "";
        return;
    }
    const d = new Date(dateInput);
    // ×”×•×¡×¤×ª×™ +1 ×œ×™×•× ×›×“×™ ×œ×ª×§×Ÿ ×‘×¢×™×•×ª UTC ×§×œ×•×ª
    d.setDate(d.getDate() + 1);
    const displayDate = d.toLocaleDateString("he-IL", { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });
    document.getElementById("dateDisplay").value = displayDate;
}

// ××™×™×§×•× ×™ ×¤×¢×™×œ×•×ª ×—×›××™× (27, 158)
function getSmartEmoji(text) {
    if(!text || text.includes("×œ×œ×")) return "â–ªï¸";
    if(text.includes("×˜×™×¡×”") || text.includes("××¢×‘×•×¨×ª") || text.includes("××•×˜×•×‘×•×¡") || text.includes("×¨×›×‘×ª")) return "âœˆï¸";
    if(text.includes("×™×") || text.includes("×‘×˜×Ÿ ×’×‘") || text.includes("×—×•×£")) return "ğŸ–ï¸";
    if(text.includes("×¦×œ×™×œ×”") || text.includes("×©× ×•×¨×§×œ×™× ×’")) return "ğŸ¤¿";
    if(text.includes("××§×“×©") || text.includes("××•×–×™××•×Ÿ")) return "ğŸ›ï¸";
    if(text.includes("×©×•×§")) return "ğŸ›ï¸";
    if(text.includes("××¡××’") || text.includes("×¡×¤×")) return "ğŸ’†";
    if(text.includes("×¤×™×œ×™×")) return "ğŸ˜";
    if(text.includes("×¤××¨×§ ××™×") || text.includes("×§××¨×˜×™× ×’")) return "ğŸ¢";
    if(text.includes("×§×•×¨×¡×™ ×‘×™×©×•×œ")) return "ğŸ§‘â€ğŸ³";
    return "ğŸ”¹";
}

// --- ×œ×•×’×™×§×ª ×©××™×¨×” ×•×˜×‘×œ×” ---

// ×‘×“×™×§×ª ×˜×¢×•×™×•×ª (110)
function validateForm() {
    const date = document.getElementById("date").value;
    const city = document.getElementById("city").value;
    if (!date) { alert("âš ï¸ ×—×•×‘×” ×œ×‘×—×•×¨ ×ª××¨×™×š!"); return false; }
    if (!city) { alert("âš ï¸ ×—×•×‘×” ×œ×‘×—×•×¨ ×¢×™×¨!"); return false; }
    return true;
}

function savePlan() {
  if(!validateForm()) return;

  const data = {
    date: document.getElementById("dateDisplay").value, // ×”×ª××¨×™×š ×”××¢×•×¦×‘
    dateRaw: document.getElementById("date").value, // ×”×ª××¨×™×š ×”×’×•×œ××™ ×œ××™×•×Ÿ (YYYY-MM-DD)
    flight1: document.getElementById("flight1").value,
    flightDep1: document.getElementById("flightDep1").value,
    flightArr1: document.getElementById("flightArr1").value,
    flight2: document.getElementById("flight2").value,
    flightDep2: document.getElementById("flightDep2").value,
    flightArr2: document.getElementById("flightArr2").value,
    city: document.getElementById("city").value,
    hotel: document.getElementById("hotel").value,
    act1: document.getElementById("activity1").value,
    act1Time: document.getElementById("act1Time").value,
    act2: document.getElementById("activity2").value,
    act2Time: document.getElementById("act2Time").value
  };

  createRow(data);
  saveLocally();
}

// ×™×¦×™×¨×ª ×©×•×¨×” ×—×“×©×” ×‘×˜×‘×œ×”
function createRow(data) {
    const tableBody = document.getElementById("savedBody");
    
    // × ×™×¡×™×•×Ÿ ×œ××¦×•× ×©×•×¨×” ×§×™×™××ª ×œ×¤×™ ×ª××¨×™×š ×’×•×œ××™ (×œ××§×¨×” ×©×œ ×¢×¨×™×›×”)
    let existingRow = Array.from(tableBody.querySelectorAll("tr")).find(row => 
        row.dataset.rawDate === data.dateRaw
    );

    const row = existingRow || document.createElement("tr");
    row.dataset.rawDate = data.dateRaw;
    row.dataset.json = JSON.stringify(data); // ×©××™×¨×ª ×›×œ ×”× ×ª×•× ×™× ×‘-JSON × ×¡×ª×¨

    // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×”×¦×’×ª ×˜×™×¡×”
    const renderFlight = (flightType, depTime, arrTime) => {
        if (flightType.includes("×œ×œ× ××¢×‘×¨")) return "";
        let html = `<span class="flight-status ${flightType.includes("×œ×œ×") ? 'status-no-fly' : 'status-fly'}">${getSmartEmoji(flightType)} ${flightType}</span>`; // 36
        if (depTime || arrTime) {
            html += '<div style="margin-top: 5px;">';
            if (depTime) html += `<span class="time-badge">ğŸ›« ${depTime}</span>`;
            if (arrTime) html += `<span class="time-badge">ğŸ›¬ ${arrTime}</span>`;
            html += '</div>';
        }
        return html;
    };

    // ×™×¦×™×¨×ª ×ª× ××¢×‘×¨×™×/×˜×™×¡×•×ª (××©×•×¤×¨ ×œ×©×ª×™ ×˜×™×¡×•×ª)
    let flightsHtml = "";
    flightsHtml += renderFlight(data.flight1, data.flightDep1, data.flightArr1);
    flightsHtml += renderFlight(data.flight2, data.flightDep2, data.flightArr2);
    if (!flightsHtml) flightsHtml = "×œ×œ× ××¢×‘×¨×™×";


    // ×™×¦×™×¨×ª ×ª× ×¤×¢×™×œ×•×™×•×ª
    let activitiesHtml = "";
    if(!data.act1.includes("×œ×œ× ×¤×¢×™×œ×•×ª")) {
        activitiesHtml += `<div>${getSmartEmoji(data.act1)} ${data.act1}`;
        if(data.act1Time) activitiesHtml += ` <small style="color:#888;">(${data.act1Time})</small>`;
        activitiesHtml += `</div>`;
    }
    if(!data.act2.includes("×œ×œ× ×¤×¢×™×œ×•×ª")) {
        activitiesHtml += `<div>${getSmartEmoji(data.act2)} ${data.act2}`;
        if(data.act2Time) activitiesHtml += ` <small style="color:#888;">(${data.act2Time})</small>`;
        activitiesHtml += `</div>`;
    }
    if (activitiesHtml === "") activitiesHtml = "××™×Ÿ ×¤×¢×™×œ×•×™×•×ª ××ª×•×›× × ×•×ª";

    row.innerHTML = `
        <td>${data.date}</td>
        <td>${flightsHtml}</td>
        <td>${data.city}</td>
        <td>${data.hotel}</td>
        <td>${activitiesHtml}</td>
        <td class="table-actions">
            <button class="edit-btn" onclick="editRow(this)">âœï¸ ×¢×¨×•×š</button>
            <button class="delete-btn" onclick="deleteRow(this)">ğŸ—‘</button>
        </td>
    `;
    
    if (!existingRow) {
        tableBody.appendChild(row);
    }

    document.getElementById("savedTable").style.display = "table";
    sortRowsByDate(); // 156: ××™×•×Ÿ ××•×˜×•××˜×™ ×××¤×©×¨ "×”×•×¡×¤×” ×‘×××¦×¢"
    clearForm(); // ×× ×§×” ××ª ×”×˜×•×¤×¡ ×œ××—×¨ ×©××™×¨×”/×¢×“×›×•×Ÿ
    document.getElementById("savedTable").dataset.currentEdit = ""; // ×××¤×¡ × ×ª×•×Ÿ ×¢×¨×™×›×”
}

// ×¤×•× ×§×¦×™×™×ª ×¢×¨×™×›×ª ×©×•×¨×”
function editRow(btn) {
    const row = btn.parentNode.parentNode;
    const data = JSON.parse(row.dataset.json);

    // ×©××™×¨×ª ×”× ×ª×•× ×™× ×©××•×ª× ×¢×•×¨×›×™× ×›×¨×’×¢ ×œ×¦×•×¨×š ×˜×¢×™× ×ª ×”××œ×•×Ÿ ×”× ×›×•×Ÿ ×œ××—×¨ ×”×¡×™× ×•×Ÿ
    document.getElementById("savedTable").dataset.currentEdit = JSON.stringify(data);

    // ×˜×¢×™× ×ª ×”× ×ª×•× ×™× ×œ×˜×•×¤×¡
    document.getElementById("date").value = data.dateRaw; 
    updateDateDisplay(); 
    document.getElementById("flight1").value = data.flight1;
    document.getElementById("flightDep1").value = data.flightDep1;
    document.getElementById("flightArr1").value = data.flightArr1;
    document.getElementById("flight2").value = data.flight2 || flights[0]; // ×‘×¨×™×¨×ª ××—×“×œ ×œ"×œ×œ× ××¢×‘×¨" ×× ×¨×™×§
    document.getElementById("flightDep2").value = data.flightDep2;
    document.getElementById("flightArr2").value = data.flightArr2;
    document.getElementById("city").value = data.city;
    
    // ××¢×“×›×Ÿ ××ª ×¨×©×™××ª ×”××œ×•× ×•×ª (×™×©×ª××© ×‘-currentEdit ×›×“×™ ×œ×‘×—×•×¨ ××ª ×”××œ×•×Ÿ)
    filterHotels(); 
    
    document.getElementById("activity1").value = data.act1;
    document.getElementById("act1Time").value = data.act1Time;
    document.getElementById("activity2").value = data.act2;
    document.getElementById("act2Time").value = data.act2Time;
    
    toggleFlightTimes(1);
    toggleFlightTimes(2);
    
    alert(`ğŸ’¡ × ×ª×•× ×™ ×™×•× ${data.date} × ×˜×¢× ×• ×œ×¢×¨×™×›×”. ×œ×—×¥ ×©×•×‘ ×¢×œ "×©××•×¨/×¢×“×›×Ÿ ××¡×œ×•×œ" ×›×“×™ ×œ×©××•×¨ ××ª ×”×©×™× ×•×™×™×.`);
}

function clearForm() {
    document.getElementById("date").value = "";
    document.getElementById("dateDisplay").value = "";
    document.getElementById("flight1").value = flights[0];
    document.getElementById("flightDep1").value = "";
    document.getElementById("flightArr1").value = "";
    document.getElementById("flight2").value = flights[0];
    document.getElementById("flightDep2").value = "";
    document.getElementById("flightArr2").value = "";
    document.getElementById("city").value = "";
    document.getElementById("hotel").innerHTML = '<option value="">×‘×—×¨ ××œ×•×Ÿ</option>';
    document.getElementById("activity1").value = allActivities[0];
    document.getElementById("act1Time").value = "";
    document.getElementById("activity2").value = allActivities[0];
    document.getElementById("act2Time").value = "";
    document.getElementById("hotelLink").textContent = "";
    document.getElementById("savedTable").dataset.currentEdit = "";
    toggleFlightTimes(1); 
    toggleFlightTimes(2); 
}


// ××™×•×Ÿ ×©×•×¨×•×ª ×œ×¤×™ ×ª××¨×™×š ×’×•×œ××™ (156)
function sortRowsByDate() {
    const tbody = document.getElementById("savedBody");
    const rows = Array.from(tbody.querySelectorAll("tr"));
    
    rows.sort((a, b) => {
        return a.dataset.rawDate.localeCompare(b.dataset.rawDate);
    });

    rows.forEach(row => tbody.appendChild(row));
    updateSummary();
}


function deleteRow(btn) {
  if(confirm("âš ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×™×•× ×–×” ××”××¡×œ×•×œ?")) {
      const row = btn.parentNode.parentNode;
      row.remove();
      if (!document.querySelectorAll("#savedBody tr").length)
        document.getElementById("savedTable").style.display = "none";
      saveLocally();
  }
}

function clearAll() {
  if(confirm("âš ï¸ ×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”××¡×œ×•×œ ×œ×¦××™×ª×•×ª. ×œ×”××©×™×š?")) {
      document.getElementById("savedBody").innerHTML = "";
      document.getElementById("savedTable").style.display = "none";
      localStorage.removeItem("tripDataFull");
      localStorage.removeItem("totalTripDays");
      document.getElementById("totalTripDays").value = "";
      updateSummary();
  }
}

// ×©××™×¨×” ××§×•××™×ª (×›×•×œ×œ ×™××™× ××ª×•×›× × ×™×)
function saveLocally() {
  const rows = document.querySelectorAll("#savedBody tr");
  const data = Array.from(rows).map(row => JSON.parse(row.dataset.json));
  localStorage.setItem("tripDataFull", JSON.stringify(data));
  localStorage.setItem("totalTripDays", document.getElementById("totalTripDays").value || "");
}

// ×˜×¢×™× ×” ××§×•××™×ª (×›×•×œ×œ ×™××™× ××ª×•×›× × ×™×)
function loadFromLocalStorage() {
  const data = JSON.parse(localStorage.getItem("tripDataFull") || "[]");
  data.forEach(item => createRow(item));
  
  const plannedDays = localStorage.getItem("totalTripDays");
  document.getElementById("totalTripDays").value = plannedDays;
}

// --- ×œ×•×’×™×§×ª ×“×©×‘×•×¨×“ (30, 68, 122) ---

function updateSummary() {
    const rows = document.querySelectorAll("#savedBody tr");
    const totalDaysInItinerary = rows.length;
    document.getElementById("totalDays").textContent = totalDaysInItinerary;

    if(totalDaysInItinerary === 0) {
        document.getElementById("daysToTrip").textContent = "×˜×¨× × ×§×‘×¢";
        document.getElementById("cityBreakdown").textContent = "-";
    } else {
        // ×¡×¤×™×¨×ª ×œ×™×œ×•×ª ×œ×¤×™ ×¢×™×¨
        const cityCounts = {};
        rows.forEach(row => {
            const data = JSON.parse(row.dataset.json);
            const cityName = data.city.split("(")[0].trim();
            cityCounts[cityName] = (cityCounts[cityName] || 0) + 1;
        });

        let breakdownText = Object.entries(cityCounts)
            .map(([city, count]) => `${city}: ${count} ×œ`)
            .join(" | ");
            
        document.getElementById("cityBreakdown").textContent = breakdownText;

        // ×¡×¤×™×¨×ª ×™××™× ×¢×“ ×”×˜×™×¡×” (122)
        const firstRowDateRaw = rows[0].dataset.rawDate;
        const firstDate = new Date(firstRowDateRaw);
        const today = new Date();
        today.setHours(0, 0, 0, 0); 
        firstDate.setHours(0, 0, 0, 0);

        const diffTime = firstDate.getTime() - today.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const countDiv = document.getElementById("daysToTrip");
        if(diffDays > 0) countDiv.textContent = `×¢×•×“ ${diffDays} ×™××™×!`;
        else if (diffDays === 0) countDiv.textContent = "×”×™×•×!!!";
        else countDiv.textContent = "×”×˜×™×•×œ ×”×ª×—×™×œ";
    }

    // ×—×™×©×•×‘ ×™××™× × ×“×¨×©×™× ×œ××™×œ×•×™
    const totalPlannedDays = parseInt(document.getElementById("totalTripDays").value);
    const daysToFillDiv = document.getElementById("daysToFill");
    
    if (isNaN(totalPlannedDays) || totalPlannedDays <= 0) {
        daysToFillDiv.textContent = "×”×–×Ÿ ×™××™×";
        daysToFillDiv.style.color = 'var(--secondary)';
    } else {
        const remainingDays = totalPlannedDays - totalDaysInItinerary;
        if (remainingDays > 0) {
            daysToFillDiv.textContent = remainingDays;
            daysToFillDiv.style.color = 'var(--danger)';
        } else if (remainingDays < 0) {
            daysToFillDiv.textContent = "âœ” ×‘×•×¦×¢ (+)";
            daysToFillDiv.style.color = 'var(--success)';
        } else {
            daysToFillDiv.textContent = "âœ” ×‘×•×¦×¢";
            daysToFillDiv.style.color = 'var(--success)';
        }
    }
}

// ×”×¦×’×ª/×”×¡×ª×¨×ª ×©×“×•×ª ×–××Ÿ ×× ×”×¡×˜×˜×•×¡ ×”×•× ×˜×™×¡×” (××©×•×¤×¨ ×œ-2 ×˜×™×¡×•×ª)
function toggleFlightTimes(num) {
    const flightType = document.getElementById(`flight${num}`).value;
    const isFlight = flightType.includes("×˜×™×¡×”") || flightType.includes("××¢×‘×•×¨×ª") || flightType.includes("××•×˜×•×‘×•×¡") || flightType.includes("×¨×›×‘×ª");
    
    const depInput = document.getElementById(`flightDep${num}`);
    const arrInput = document.getElementById(`flightArr${num}`);

    // ×× ××™×Ÿ ××¢×‘×¨/×˜×™×¡×”, × ××¤×¡ ××ª ×”×©×¢×•×ª ×›×“×™ ×©×œ× ×™×©××¨×•
    if (!isFlight) {
        depInput.value = "";
        arrInput.value = "";
    }
}

// --- ×¤×•× ×§×¦×™×•×ª ×©××™×¨×ª ×§×‘×¦×™× ---
// (×”×©××¨×ª×™ ××ª ×”×”×•×“×¢×” ×¢×œ PDF ×›×™ ×ª××™×›×ª ×¢×‘×¨×™×ª ××•×‘× ×™×ª ×‘-jsPDF ××•×¨×›×‘×ª)

async function downloadPDF() {
    alert("×”×›×œ×™ ×”×–×” ××™× ×• ×ª×•××š ×‘××•×¤×Ÿ ××œ× ×‘×¢×‘×¨×™×ª ×‘-PDF. ×× × ×”×©×ª××© ×‘××¤×©×¨×•×ª '×”×“×¤×¡×”' ×©×œ ×”×“×¤×“×¤×Ÿ ×•×©××•×¨ ×›×§×•×‘×¥ PDF.");
    window.print();
}

function sendToWhatsApp() {
    const rows = document.querySelectorAll("#savedBody tr");
    if (!rows.length) return alert("××™×Ÿ ×©×•×¨×•×ª ×œ×©×œ×™×—×”");

    let message = "*âœˆï¸ ××¡×œ×•×œ ×”×˜×™×•×œ ×”××œ×:*\n\n";
    
    rows.forEach((row, i) => {
        const data = JSON.parse(row.dataset.json);
        
        message += `*×™×•× ${i+1} (${data.date})*\n`;
        message += `ğŸ™ *×¢×™×¨:* ${data.city}\n`;
        if(data.hotel) message += `ğŸ¨ *××œ×•×Ÿ:* ${data.hotel}\n`;
        
        // ×¡×˜×˜×•×¡ ×˜×™×¡×”/××¢×‘×¨ 1
        if(!data.flight1.includes("×œ×œ× ××¢×‘×¨")) {
            message += `${getSmartEmoji(data.flight1)} *××¢×‘×¨ 1:* ${data.flight1}`;
            if(data.flightDep1) message += ` | ğŸ›« ${data.flightDep1} ğŸ›¬ ${data.flightArr1}`;
            message += `\n`;
        }
         // ×¡×˜×˜×•×¡ ×˜×™×¡×”/××¢×‘×¨ 2
        if(data.flight2 && !data.flight2.includes("×œ×œ× ××¢×‘×¨")) {
            message += `${getSmartEmoji(data.flight2)} *××¢×‘×¨ 2:* ${data.flight2}`;
            if(data.flightDep2) message += ` | ğŸ›« ${data.flightDep2} ğŸ›¬ ${data.flightArr2}`;
            message += `\n`;
        }
        
        // ×¤×¢×™×œ×•×™×•×ª
        if(!data.act1.includes("×œ×œ× ×¤×¢×™×œ×•×ª")) {
            message += `${getSmartEmoji(data.act1)} ×‘×•×§×¨: ${data.act1}`;
            if(data.act1Time) message += ` (${data.act1Time})`;
            message += `\n`;
        }
        
        if(!data.act2.includes("×œ×œ× ×¤×¢×™×œ×•×ª")) {
            message += `${getSmartEmoji(data.act2)} ×¢×¨×‘: ${data.act2}`;
            if(data.act2Time) message += ` (${data.act2Time})`;
            message += `\n`;
        }
        
        message += "------------------\n";
    });

    message += `\nğŸ“Š *×¡×™×›×•× ×œ×™×œ×•×ª:* ${document.getElementById("cityBreakdown").textContent}`;

    const phone = prompt("×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×œ×œ× 0. ×œ×“×•×’××”: 501234567):");
    if (!phone) return;
    const fullPhone = "972" + phone.replace(/^0+/, "").replace(/[^0-9]/g, "");
    const url = "https://wa.me/" + fullPhone + "?text=" + encodeURIComponent(message);
    window.open(url, "_blank");
}

// --- ×˜×¢×™× ×” ×¨××©×•× ×™×ª ---
window.onload = function() {
  fillSelect("flight1", flights);
  fillSelect("flight2", flights);
  fillSelect("city", cities);
  fillSelect("activity1", allActivities);
  fillSelect("activity2", allActivities);
  
  // ×˜×•×¢×Ÿ × ×ª×•× ×™× ×•×©×•××¨×™× ××•×˜×•××˜×™×ª ×× ×”×˜×¢×™× ×” ××¦×™×’×” ××©×”×•
  loadFromLocalStorage();
  updateSummary();
  filterHotels(); // ×˜×•×¢×Ÿ ××ª ×›×œ ×”××œ×•× ×•×ª ×›×‘×¨×™×¨×ª ××—×“×œ ×× ×œ× × ×‘×—×¨×” ×¢×™×¨
  clearForm(); // ×× ×§×” ××ª ×”×˜×•×¤×¡ ×œ××—×¨ ×˜×¢×™× ×”
}
</script>
</body>
</html>
