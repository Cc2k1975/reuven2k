<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מחולל ברית</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root { --main-gold: #896b1a; --text-dark: #3a3a3a; }
        body {
            font-family: 'Rubik', sans-serif; background-color: #222;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 10px; color: white; min-height: 100vh;
        }
        .controls {
            background: #333; padding: 20px; border-radius: 10px; border: 1px solid #444;
            display: flex; flex-direction: column; gap: 15px; width: 95%; max-width: 500px; margin-bottom: 20px;
        }
        input[type="date"] { padding: 12px; border-radius: 6px; border: none; font-family: 'Rubik'; font-size: 16px; width: 100%; }
        button { background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; width: 100%; }
        
        .preview-wrapper { width: 100%; max-width: 600px; display: flex; justify-content: center; }
        .preview-area { 
            position: relative; background: white; width: 600px; /* רוחב קבוע */
            transform-origin: top center; 
        }
        #bgImage { display: block; width: 100%; height: auto; }
        
        /* הקונטיינר המקורי שעבד */
        .text-container {
            position: absolute; left: 50%; transform: translateX(-50%); width: 80%;
            text-align: center; display: flex; flex-direction: column; align-items: center;
            top: 44%; filter: blur(0.6px);
        }
        .scaler-wrapper { width: 100%; display: flex; flex-direction: column; align-items: center; transform: scale(0.8); gap: 4px; }
        
        /* פונטים מקוריים (פיקסלים) */
        .header-quote { color: var(--main-gold); font-weight: 700; font-size: 24px; line-height: 1.1; margin-bottom: 10px; }
        .intro-text { color: var(--text-dark); font-size: 16px; line-height: 1.3; }
        .heb-date { color: var(--text-dark); font-size: 16px; font-weight: 500; margin-top: 5px; }
        .greg-date { color: var(--main-gold); font-weight: 900; font-size: 32px; letter-spacing: 1px; margin: 5px 0; direction: ltr; }
        .location-text { color: var(--text-dark); font-size: 16px; line-height: 1.4; margin-bottom: 15px; }
        .footer-text { color: var(--main-gold); font-weight: 700; font-size: 20px; line-height: 1.2; }
    </style>
</head>
<body>
    <div class="controls">
        <div><label>תאריך האירוע:</label><input type="date" id="dateInput"></div>
        <button onclick="saveImage()">שמור תמונה</button>
        <a href="index.html" style="text-align:center; color:#ccc; margin-top:10px; font-size:0.9rem;">חזרה</a>
    </div>

    <div class="preview-wrapper">
        <div class="preview-area" id="captureTarget">
            <img id="bgImage" src="blank_bg.jpg" onerror="alert('חסר קובץ blank_bg.jpg')" alt="רקע">
            <div class="text-container">
                <div class="scaler-wrapper">
                    <div class="header-quote">"בסימן טוב בא לנו בימינו<br>יבוא הגואל"</div>
                    <div class="intro-text">אנו שמחים להזמינכם לחגוג עימנו<br>את ברית המילה של בננו</div>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div class="heb-date" id="hebDate">טוען...</div>
                        <div class="greg-date" id="gregDate">00.00.0000</div>
                    </div>
                    <div class="location-text">באולמי "יהלום", עין המפרץ<br>בשעה 12:30</div>
                    <div class="footer-text">נשמח לראותכם,<br>דנה ורועי</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function fitToScreen() {
            const wrapper = document.querySelector('.preview-wrapper');
            const preview = document.querySelector('.preview-area');
            const scale = Math.min(wrapper.clientWidth / 600, 1); 
            preview.style.transform = `scale(${scale})`;
            wrapper.style.height = (preview.clientHeight * scale) + 'px';
        }
        window.addEventListener('resize', fitToScreen);
        window.addEventListener('load', fitToScreen);

        function toGematria(num) { const l=['','א','ב','ג','ד','ה','ו','ז','ח','ט','י','יא','יב','יג','יד','טו','טז','יז','יח','יט','כ','כא','כב','כג','כד','כה','כו','כז','כח','כט','ל','לא']; return num>30?num:l[num]; }
        document.getElementById('dateInput').addEventListener('change', function() {
            if(!this.value)return; const d=new Date(this.value);
            const p=new Intl.DateTimeFormat('he-IL-u-ca-hebrew',{weekday:'long',month:'long',day:'numeric'}).formatToParts(d);
            let w='',m='',dn=0; p.forEach(x=>{if(x.type==='weekday')w=x.value;if(x.type==='month')m=x.value;if(x.type==='day')dn=parseInt(x.value)});
            if(!w.includes('יום'))w="יום "+w;
            document.getElementById('hebDate').innerText=`שתתקיים ב${w}, ${toGematria(dn)} ב${m}`;
            // תיקון פורמט תאריך
            document.getElementById('gregDate').innerText=`${String(d.getDate()).padStart(2,'0')}.${String(d.getMonth()+1).padStart(2,'0')}.${d.getFullYear()}`;
        });
        function saveImage() {
            const el = document.getElementById('captureTarget');
            const originalTransform = el.style.transform;
            el.style.transform = 'scale(1)'; 
            html2canvas(el,{useCORS:true,scale:2}).then(c=>{
                const l=document.createElement('a');l.download="brit.jpg";l.href=c.toDataURL("image/jpeg",0.9);l.click();
                el.style.transform = originalTransform;
            });
        }
    </script>
</body>
</html>
