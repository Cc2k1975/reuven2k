<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp Direct - Final Fix</title>
    <style>
        :root { --wa-green: #25D366; --wa-dark: #075E54; }
        body { 
            font-family: system-ui, sans-serif; background-color: #f0f2f5; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; padding: 15px; 
            user-select: none; -webkit-user-select: none; touch-action: manipulation;
        }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); width: 100%; max-width: 400px; text-align: center; }
        .box { background: #f8f9fa; border: 2px solid #eaebec; border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: right; }
        .label { font-size: 12px; color: #666; font-weight: bold; }
        .field { font-size: 18px; font-weight: bold; color: var(--wa-dark); min-height: 25px; word-break: break-all; }
        
        .ptt-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: none;
            background-color: #34b7f1; color: white; font-size: 20px; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            margin: 20px auto; display: block; touch-action: none;
            transition: transform 0.1s; -webkit-tap-highlight-color: transparent;
        }
        .ptt-btn:active { background-color: #ff4b2b; transform: scale(0.95); }

        .btn-paste { width: 100%; padding: 14px; background-color: #6c757d; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color: var(--wa-dark); margin-top: 0;">专 砖</h2>
    
    <div class="box">
        <div class="label">住驻专 注:</div>
        <div id="phoneField" class="field">---</div>
    </div>
    
    <div class="box">
        <div class="label">注:</div>
        <div id="msgField" class="field" style="font-weight: normal;">---</div>
    </div>

    <button class="btn-paste" onclick="pasteFromClipboard()"> 拽 住驻专 专</button>

    <button id="pttBtn" class="ptt-btn">抓 拽<br></button>
    
    <p id="status" style="font-size: 14px; color: #888;">专 住驻专  注 砖专专</p>
    
    <button class="btn-paste" style="background:#eee; color:#333; margin-top:10px;" onclick="location.reload()">拽 </button>
</div>

<script>
    let recognition;
    let lockedNumber = "";
    let finalMsg = "";

    // 砖:  砖注 驻转
    let finalTranscript = "";
    let latestText = "";
    let isListening = false;

    function init() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new Speech();
        recognition.lang = 'he-IL';
        recognition.continuous = true;
        recognition.interimResults = true;

        recognition.onresult = (event) => {
            let interim = "";

            // 拽 专拽 转  砖转注 注砖 (  砖 )
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const t = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += (finalTranscript ? " " : "") + t.trim();
                } else {
                    interim += t;
                }
            }

            latestText = (finalTranscript + " " + interim).trim();
            processText(latestText);
        };

        recognition.onerror = () => {
            isListening = false;
            document.getElementById('status').innerText = "砖  专";
        };

        recognition.onend = () => {
            // onend  拽专  ;  砖 专 isListening
        };
    }

    // 爪专 Regex 砖 转 住驻专   专 注 专/拽驻 (058-7449001 ')
    function buildLooseDigitsRegex(digits) {
        const escaped = digits.split('').map(d => d.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'));
        return new RegExp(escaped.join('\\D*'));
    }

    function processText(text) {
        const phoneElem = document.getElementById('phoneField');
        const msgElem = document.getElementById('msgField');

        // 砖驻转 住驻专 驻 (驻砖 专爪祝 住驻专转 专砖)
        if (!lockedNumber) {
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 10) {
                lockedNumber = digits.substring(0, 10);
                phoneElem.innerText = lockedNumber;
            } else {
                phoneElem.innerText = digits || "---";
            }
        }

        // 砖驻转 注 - 拽 转 住驻专 拽住  (  注 拽驻/专)
        if (lockedNumber) {
            const looseRe = buildLooseDigitsRegex(lockedNumber);
            let messagePart = text.replace(looseRe, '').trim();
            messagePart = messagePart.replace(/^[^a-zA-Z-转]+/, '');
            msgElem.innerText = messagePart || "---";
            finalMsg = messagePart;
        }
    }

    const btn = document.getElementById('pttBtn');

    btn.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        if (!recognition) init();

        lockedNumber = "";
        finalMsg = "";
        finalTranscript = "";
        latestText = "";
        isListening = true;

        document.getElementById('phoneField').innerText = "---";
        document.getElementById('msgField').innerText = "---";
        document.getElementById('status').innerText = "拽砖... 砖专专 砖";

        try { recognition.start(); } catch(_) {}
    });

    // 专注 拽专: 砖专专 爪注 驻转 转 住驻
    window.addEventListener('pointerup', (e) => {
        if (!recognition || !isListening) return;

        isListening = false;
        try { recognition.stop(); } catch(_) {}

        const num = document.getElementById('phoneField').innerText.replace(/\D/g, '');
        if (num.length >= 9) {
            let cleanNum = num.startsWith('0') ? '972' + num.substring(1) : num;
            window.location.href = `https://wa.me/${cleanNum}?text=${encodeURIComponent(finalMsg)}`;
        } else {
            document.getElementById('status').innerText = "  住驻专";
        }
    });

    async function pasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 9) {
                lockedNumber = digits;
                document.getElementById('phoneField').innerText = lockedNumber;
                document.getElementById('status').innerText = "住驻专 拽. 注砖 抓 专 注.";
            }
        } catch (e) { alert("砖专 砖 "); }
    }

    window.oncontextmenu = (e) => { e.preventDefault(); return false; };
</script>
</body>
</html>
1
