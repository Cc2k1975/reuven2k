<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>זיהוי שפה קולי</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f0f2f5;
            --text-color: #333;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            overflow: hidden;
        }

        /* כותרת */
        h1 {
            margin-bottom: 40px;
            color: var(--text-color);
            font-weight: 300;
            font-size: 2rem;
            text-align: center;
        }

        /* עיצוב הלחצן הענק */
        .record-btn {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            outline: none;
        }

        .record-btn svg {
            width: 80px;
            height: 80px;
            fill: var(--primary-color);
            transition: all 0.3s ease;
        }

        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(74, 144, 226, 0.2);
        }

        .record-btn:active {
            transform: scale(0.95);
        }

        /* אנימציה כשהכפתור מקליט */
        .record-btn.listening {
            background: #ff4757;
            animation: pulse 1.5s infinite;
        }

        .record-btn.listening svg {
            fill: white;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            70% { box-shadow: 0 0 0 50px rgba(255, 71, 87, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
        }

        /* אזור התוצאה */
        #result-container {
            margin-top: 50px;
            text-align: center;
            min-height: 100px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #result-container.visible {
            opacity: 1;
        }

        .language-label {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .detected-language {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .transcript-text {
            margin-top: 15px;
            font-size: 1rem;
            color: #888;
            font-style: italic;
        }

        /* הודעת שגיאה או סטטוס */
        .status {
            position: absolute;
            bottom: 30px;
            color: #999;
            font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <h1>לחץ כדי לזהות שפה</h1>

    <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
        <svg viewBox="0 0 24 24">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
    </button>

    <div id="result-container">
        <div class="language-label">השפה שזוהתה:</div>
        <div class="detected-language" id="langDisplay">...</div>
        <div class="transcript-text" id="textDisplay"></div>
    </div>

    <div class="status" id="statusMsg">מוכן להקלטה</div>

    <script>
        const btn = document.getElementById('recordBtn');
        const langDisplay = document.getElementById('langDisplay');
        const textDisplay = document.getElementById('textDisplay');
        const resultContainer = document.getElementById('result-container');
        const statusMsg = document.getElementById('statusMsg');

        // בדיקה אם הדפדפן תומך בזיהוי דיבור
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (!SpeechRecognition) {
            alert("הדפדפן שלך לא תומך בזיהוי דיבור. נסה להשתמש ב-Chrome.");
            btn.disabled = true;
        }

        const recognition = new SpeechRecognition();
        
        // הגדרות זיהוי
        recognition.continuous = false; // מפסיק אוטומטית כשהדיבור נעצר
        recognition.interimResults = false; 
        recognition.maxAlternatives = 1;

        // טריק: אנו לא מגדירים שפה ספציפית כדי לאפשר לדפדפן להשתמש בברירת המחדל שלו
        // או מגדירים רשימה אם הדפדפן תומך בכך (רובם תומכים רק באחת בכל פעם)
        // כאן נסתמך על זיהוי הטקסט שחוזר כדי להבין מה השפה
        
        recognition.onstart = () => {
            btn.classList.add('listening');
            statusMsg.textContent = "מקשיב...";
            resultContainer.classList.remove('visible');
        };

        recognition.onend = () => {
            btn.classList.remove('listening');
            statusMsg.textContent = "מוכן להקלטה";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            const confidence = event.results[0][0].confidence;
            
            identifyLanguage(transcript);
        };

        recognition.onerror = (event) => {
            statusMsg.textContent = "שגיאה: " + event.error;
            btn.classList.remove('listening');
        };

        function toggleRecording() {
            if (btn.classList.contains('listening')) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        // פונקציית זיהוי שפה לפי התווים בטקסט
        function identifyLanguage(text) {
            let detectedLang = "לא ידוע";
            let dir = "ltr";

            // בדיקת תווים בעברית (טווח יוניקוד)
            const hebrewPattern = /[\u0590-\u05FF]/;
            // בדיקת תווים באנגלית/לטינית
            const englishPattern = /[a-zA-Z]/;
            // בדיקת תווים ברוסית
            const russianPattern = /[\u0400-\u04FF]/;
            // בדיקת תווים בערבית
            const arabicPattern = /[\u0600-\u06FF]/;

            if (hebrewPattern.test(text)) {
                detectedLang = "עברית";
                dir = "rtl";
            } else if (russianPattern.test(text)) {
                detectedLang = "רוסית";
                dir = "ltr";
            } else if (arabicPattern.test(text)) {
                detectedLang = "ערבית";
                dir = "rtl";
            } else if (englishPattern.test(text)) {
                // אנגלית ושפות אירופאיות רבות משתמשות באותם תווים, 
                // זהו זיהוי בסיסי לאנגלית
                detectedLang = "אנגלית";
                dir = "ltr";
            }

            // הצגת התוצאה
            langDisplay.textContent = detectedLang;
            textDisplay.textContent = `"${text}"`;
            textDisplay.style.direction = dir;
            
            resultContainer.classList.add('visible');
        }
    </script>
</body>
</html>
