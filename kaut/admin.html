<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ××©×—×§ - ×××•×‘×˜×—</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rubik', sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        
        /* ××¡×š ×›× ×™×¡×” */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000;
        }
        #login-box { background: white; padding: 30px; border-radius: 10px; text-align: center; }
        #pass-input { padding: 10px; font-size: 1.2rem; margin-bottom: 10px; text-align: center; }
        
        /* ×ª×•×›×Ÿ ×¨××©×™ */
        .main-content { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } }

        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: #333; }
        
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        button:hover { opacity: 0.9; }

        .btn-start { background: #27ae60; font-size: 1.2rem; }
        .btn-stop { background: #e74c3c; }
        .btn-add { background: #2980b9; }
        .btn-update { background: #f39c12; }
        .btn-del { background: #c0392b; width: auto; padding: 5px 10px; font-size: 0.8rem; margin: 0; float: left;}

        .question-item { background: #f9f9f9; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .q-text { font-weight: bold; color: #2c3e50; }
        .ans-preview { font-size: 0.85rem; color: #7f8c8d; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-box">
            <h2>ğŸ”’ ×›× ×™×¡×” ×œ×× ×”×œ</h2>
            <input type="password" id="pass-input" placeholder="×”×›× ×¡ ×¡×™×¡××”">
            <button onclick="checkPass()" style="background:#2c3e50;">×›× ×™×¡×”</button>
            <p id="error-msg" style="color:red; display:none;">×¡×™×¡××” ×©×’×•×™×”!</p>
        </div>
    </div>

    <div id="app-content" style="display:none;">
        <h1 style="text-align:center; color:#2c3e50;">×¤×× ×œ × ×™×”×•×œ ×¨××©×™ ğŸ› ï¸</h1>
        
        <div class="main-content">
            
            <div class="col-right">
                
                <div class="card" style="border: 2px solid #27ae60;">
                    <h2>ğŸš€ ×©×œ×™×˜×” ×‘××©×—×§</h2>
                    <p>×©×—×§× ×™× ××—×•×‘×¨×™×: <b id="connected-count">0</b></p>
                    <button class="btn-start" id="start-btn">×”×ª×—×œ ××©×—×§ ×œ×›×•×œ×!</button>
                    <button class="btn-stop" onclick="resetGame()" style="margin-top:20px; background:#7f8c8d;">ğŸ”„ ××™×¤×•×¡ ××œ× (××—×™×§×ª ×©×—×§× ×™×)</button>
                </div>

                <div class="card">
                    <h2>âœï¸ ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª</h2>
                    <label>×›×•×ª×¨×ª ×”××©×—×§ (×œ××©×œ: ×—×™×“×•×Ÿ ×¤×¡×—):</label>
                    <input type="text" id="game-title" placeholder="×©× ×”××©×—×§">
                    <button class="btn-update" onclick="updateTitle()">×¢×“×›×Ÿ ×›×•×ª×¨×ª</button>
                </div>

                <div class="card">
                    <h2>â• ×”×•×¡×£ ×©××œ×”</h2>
                    <input type="text" id="q-text" placeholder="×”×©××œ×”...">
                    <input type="text" id="ans-1" placeholder="×ª×©×•×‘×” 1">
                    <input type="text" id="ans-2" placeholder="×ª×©×•×‘×” 2">
                    <input type="text" id="ans-3" placeholder="×ª×©×•×‘×” 3">
                    <input type="text" id="ans-4" placeholder="×ª×©×•×‘×” 4">
                    <select id="correct-idx">
                        <option value="0">×ª×©×•×‘×” 1 ×”×™× ×”× ×›×•× ×”</option>
                        <option value="1">×ª×©×•×‘×” 2 ×”×™× ×”× ×›×•× ×”</option>
                        <option value="2">×ª×©×•×‘×” 3 ×”×™× ×”× ×›×•× ×”</option>
                        <option value="3">×ª×©×•×‘×” 4 ×”×™× ×”× ×›×•× ×”</option>
                    </select>
                    <button class="btn-add" onclick="addQuestion()">×©××•×¨ ×©××œ×”</button>
                </div>
            </div>

            <div class="col-left">
                <div class="card">
                    <h2>ğŸ“š ×‘× ×§ ×”×©××œ×•×ª (<span id="q-count">0</span>)</h2>
                    <div id="questions-list">
                        </div>
                    <button onclick="loadDefaults()" style="background:#bdc3c7; color:#333; margin-top:20px;">×˜×¢×Ÿ ×©××œ×•×ª ×œ×“×•×’××”</button>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, remove, push, update, onValue, get } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ×”×’×“×¨×•×ª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDJN7sN1lT5Qi8zFV6ad8PtXc6oc7cElY0",
            authDomain: "kaut-72127.firebaseapp.com",
            databaseURL: "https://kaut-72127-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kaut-72127",
            storageBucket: "kaut-72127.firebasestorage.app",
            messagingSenderId: "125458113848",
            appId: "1:125458113848:web:6b7acfd03b629cebb90dcd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentQuestions = [];

        // --- 1. ××‘×˜×—×” ×‘×¡×™×¡×™×ª ---
        window.checkPass = function() {
            const val = document.getElementById('pass-input').value;
            if (val === '4451') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.querySelector('.main-content').style.display = 'grid'; // ××¤×¢×™×œ ××ª ×”×’×¨×™×“
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        };

        // --- 2. ×”××–× ×” ×œ×©××œ×•×ª ×•×œ×”×’×“×¨×•×ª ---
        onValue(ref(db, 'questions'), (snapshot) => {
            const listDiv = document.getElementById('questions-list');
            listDiv.innerHTML = '';
            const data = snapshot.val();
            let count = 0;

            if (data) {
                // ×”××¨×” ×œ××¢×¨×š ×¢× ××¤×ª×—×•×ª ×›×“×™ ×©× ×•×›×œ ×œ××—×•×§
                // Firebase ××—×–×™×¨ ××•×‘×™×™×§×˜ ××• ××¢×¨×š ×ª×œ×•×™ ××™×š ×©××¨× ×•. × ×˜×¤×œ ×‘×©× ×™×”×.
                const entries = Object.entries(data); 
                currentQuestions = entries; // ×©×•××¨×™× ×‘×¦×“
                
                entries.forEach(([key, q]) => {
                    count++;
                    const div = document.createElement('div');
                    div.className = 'question-item';
                    div.innerHTML = `
                        <button class="btn-del" onclick="deleteQ('${key}')">××—×§</button>
                        <div style="margin-right: 60px;">
                            <div class="q-text">${count}. ${q.q}</div>
                            <div class="ans-preview">×ª×©×•×‘×” × ×›×•× ×”: ${q.ans[q.correct]}</div>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            }
            document.getElementById('q-count').innerText = count;
        });

        // ×”××–× ×” ×œ×›×•×ª×¨×ª ×”××©×—×§
        onValue(ref(db, 'gameSettings/title'), (snapshot) => {
            const title = snapshot.val();
            if(title) document.getElementById('game-title').value = title;
        });
        
        // ×”××–× ×” ×œ×›××•×ª ×©×—×§× ×™×
        onValue(ref(db, 'players'), (snap) => {
            document.getElementById('connected-count').innerText = snap.size;
        });

        // --- 3. ×¤×•× ×§×¦×™×•×ª × ×™×”×•×œ ---

        // ×”×ª×—×œ×ª ××©×—×§ (×”×•×¢×‘×¨ ×œ×›××Ÿ!)
        document.getElementById('start-btn').addEventListener('click', () => {
             get(ref(db, 'questions')).then(qSnap => {
                 if(!qSnap.exists()) return alert("××™×Ÿ ×©××œ×•×ª ×‘×‘× ×§!");
                 
                 // ××™×¤×•×¡ × ×™×§×•×“ ×œ×©×—×§× ×™×
                 get(ref(db, 'players')).then(pSnap => {
                    const updates = {};
                    pSnap.forEach(c => {
                        updates['players/' + c.key + '/score'] = 0;
                        updates['players/' + c.key + '/lastAnswerTime'] = 0;
                        updates['players/' + c.key + '/lastAnswerCorrect'] = false;
                    });
                    // ×¡×˜×˜×•×¡ ××©×—×§
                    updates['gameState'] = { 
                        status: 'playing', 
                        qIndex: 0, 
                        startTime: Date.now() 
                    };
                    update(ref(db), updates);
                 });
             });
        });

        window.updateTitle = function() {
            const t = document.getElementById('game-title').value;
            set(ref(db, 'gameSettings/title'), t).then(() => alert('×”×›×•×ª×¨×ª ×¢×•×“×›× ×” ××¦×œ ×›×•×œ×!'));
        };

        window.addQuestion = function() {
            const q = document.getElementById('q-text').value;
            const a1 = document.getElementById('ans-1').value;
            const a2 = document.getElementById('ans-2').value;
            const a3 = document.getElementById('ans-3').value;
            const a4 = document.getElementById('ans-4').value;
            const correct = parseInt(document.getElementById('correct-idx').value);

            if (!q || !a1) return alert("×—×¡×¨×™× × ×ª×•× ×™×!");

            push(ref(db, 'questions'), {
                q: q, ans: [a1, a2, a3, a4], correct: correct
            }).then(() => {
                // × ×™×§×•×™
                document.getElementById('q-text').value = "";
                document.getElementById('ans-1').value = "";
                document.getElementById('ans-2').value = "";
                document.getElementById('ans-3').value = "";
                document.getElementById('ans-4').value = "";
            });
        };

        window.deleteQ = function(key) {
            if(confirm("×œ××—×•×§ ××ª ×”×©××œ×” ×”×–×•?")) {
                remove(ref(db, 'questions/' + key));
            }
        };
        
        // ×¢×•×©×” ××ª ×–×” ×’×œ×•×‘×œ×™ ×›×“×™ ×©×”-HTML ×™×›×™×¨
        window.deleteQ = window.deleteQ; 

        window.resetGame = function() {
            if(!confirm("×–×” ×™×¢×™×£ ××ª ×›×œ ×”×©×—×§× ×™× ×•×™××¤×¡ ×”×›×œ. ×‘×˜×•×—?")) return;
            remove(ref(db, 'players'));
            update(ref(db, 'gameState'), { status: 'waiting', qIndex: 0 });
        };

        window.loadDefaults = function() {
            const defaultQuestions = [
                { q: "×›××” ×§× ×™× ×™×© ×‘×—× ×•×›×™×™×” (×›×•×œ×œ ×”×©××©)?", ans: ["7", "8", "9", "10"], correct: 2 },
                { q: "××”×• ×”×××›×œ ×”××¡×•×¨×ª×™ ×©×œ ×—× ×•×›×”?", ans: ["××¦×•×ª", "×¡×•×¤×’× ×™×•×ª", "××•×–× ×™ ×”××Ÿ", "×ª×¤×•×— ×‘×“×‘×©"], correct: 1 }
            ];
            set(ref(db, 'questions'), defaultQuestions);
        };
    </script>
</body>
</html>
