<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מעביר קוד ל-DOCX</title>

  <!-- FileSaver.js -->
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <!-- docx -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

  <style>
    :root{
      --bg:#f3f4f6; --panel:#ffffff; --text:#111827;
      --muted:#6b7280; --green:#16a34a; --green2:#15803d;
      --border:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg); color:var(--text);
      height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .card{
      width:min(900px, 100%);
      height:min(720px, 100%);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      display:flex; flex-direction:column;
      overflow:hidden;
    }
    header{
      padding:18px 20px;
      border-bottom:1px solid var(--border);
    }
    h1{margin:0; font-size:18px}
    .hint{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.4}
    .content{padding:16px 20px; display:flex; flex-direction:column; gap:12px; flex:1}
    textarea{
      flex:1;
      width:100%;
      resize:none;
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      font-family:Consolas, "Courier New", monospace;
      font-size:14px;
      line-height:1.5;
      outline:none;
    }
    textarea:focus{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.15)}
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .leftRow{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color:var(--muted); font-size:13px;
    }
    .btn{
      border:none;
      border-radius:14px;
      padding:12px 18px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      background:var(--green);
      color:white;
      transition:.15s transform, .15s background;
      min-width:170px;
    }
    .btn:hover{background:var(--green2)}
    .btn:active{transform:scale(.98)}
    .btn.secondary{
      background:#e5e7eb; color:#111827; font-weight:600;
      min-width:170px;
    }
    .btn.secondary:hover{background:#d1d5db}
    .toast{
      position:fixed;
      bottom:18px;
      left:18px;
      background:#111827;
      color:white;
      padding:12px 14px;
      border-radius:14px;
      box-shadow:var(--shadow);
      font-size:14px;
      max-width:min(560px, calc(100vw - 36px));
      display:none;
      white-space:pre-line;
    }
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>מעביר קוד ל־DOCX</h1>
      <div class="hint">
        שם הקובץ נוצר אוטומטית לפי תאריך ושעה:<br>
        <code>DDMMYYYY_HHMMSS.docx</code>
      </div>
    </header>

    <div class="content">
      <textarea id="textArea" placeholder="הדבק כאן את הקוד/טקסט שלך..."></textarea>

      <div class="row">
        <div class="leftRow">
          <span id="charCount">0 תווים</span>
          <span>•</span>
          <span id="lineCount">0 שורות</span>
          <span>•</span>
          <span>שם קובץ: <b id="fileNamePreview"></b></span>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn secondary" id="clearBtn">נקה</button>
          <button class="btn" id="saveBtn">שמור DOCX</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const textArea = document.getElementById('textArea');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const toast = document.getElementById('toast');
  const charCount = document.getElementById('charCount');
  const lineCount = document.getElementById('lineCount');
  const fileNamePreview = document.getElementById('fileNamePreview');

  const pad2 = n => String(n).padStart(2, "0");

  function buildFileName(date = new Date()) {
    const dd = pad2(date.getDate());
    const mm = pad2(date.getMonth() + 1);
    const yyyy = date.getFullYear();
    const hh = pad2(date.getHours());
    const mi = pad2(date.getMinutes());
    const ss = pad2(date.getSeconds());
    return `${dd}${mm}${yyyy}_${hh}${mi}${ss}.docx`;
  }

  function updatePreviewName() {
    fileNamePreview.textContent = buildFileName(new Date());
  }

  function computeCounts() {
    const v = textArea.value || "";
    charCount.textContent = `${v.length} תווים`;
    const lines = v.length ? v.replace(/\r\n/g, "\n").split("\n").length : 0;
    lineCount.textContent = `${lines} שורות`;
  }

  function showToast(msg, ms = 3500) {
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.style.display = 'none', ms);
  }

  async function saveToDocx() {
    const content = (textArea.value || "").replace(/\r\n/g, "\n").trimEnd();
    if (!content.trim()) {
      showToast("שגיאה: התיבה ריקה");
      return;
    }

    try {
      const fileName = buildFileName(new Date());
      const lines = content.split("\n");

      const paragraphs = lines.map(line =>
        new docx.Paragraph({
          children: [new docx.TextRun({ text: line, font: "Courier New" })],
          spacing: { before: 0, after: 0, line: 276 }
        })
      );

      const doc = new docx.Document({
        sections: [{ children: paragraphs }]
      });

      const blob = await docx.Packer.toBlob(doc);
      saveAs(blob, fileName);

      showToast(`נשמר בהצלחה:\n${fileName}`);
      textArea.value = "";
      computeCounts();
      updatePreviewName();
    } catch (e) {
      console.error(e);
      showToast("שגיאה ביצירת הקובץ");
    }
  }

  saveBtn.onclick = saveToDocx;
  clearBtn.onclick = () => {
    textArea.value = "";
    computeCounts();
    showToast("נוקה");
  };

  textArea.addEventListener("input", computeCounts);

  window.addEventListener("keydown", e => {
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
      e.preventDefault();
      saveToDocx();
    }
  });

  computeCounts();
  updatePreviewName();
})();
</script>
</body>
</html>
