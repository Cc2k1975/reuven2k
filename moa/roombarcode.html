<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Barcode Label – Site / Building / Room</title>

  <!-- JsBarcode -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:system-ui,"Heebo","Arial",sans-serif;
      background:#f2f5f9;
      color:#111;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .app{
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.1);
      max-width:360px;
      width:100%;
      padding:18px 16px 16px;
    }

    h1{
      text-align:center;
      font-size:18px;
      margin-bottom:10px;
    }

    .field{margin-bottom:10px;}
    label{display:block;font-size:14px;margin-bottom:4px;}

    select,input{
      width:100%;
      padding:7px 9px;
      font-size:14px;
      border-radius:10px;
      border:1px solid #ccd3de;
      outline:none;
    }

    .buttons{
      margin-top:12px;
      display:flex;
      gap:8px;
    }

    button{
      flex:1;
      cursor:pointer;
      border:none;
      border-radius:999px;
      padding:9px;
      font-size:14px;
      font-weight:600;
    }

    #printBtn{background:#0078ff;color:#fff;}
    #clearBtn{background:#e9edf4;color:#111;}

    /* הדפסה – מציג רק את הברקוד */
    @media print{
      body{margin:0;padding:0;background:#fff;}
      .app{display:none;}
      #printArea{display:block !important;}
    }

    #printArea{
      display:none;
      text-align:center;
      padding:8px;
    }
  </style>
</head>
<body>

  <!-- מסך ראשי -->
  <div class="app">
    <h1>Barcode Label</h1>

    <div class="field">
      <label for="siteSelect">Site (אות באנגלית)</label>
      <select id="siteSelect">
        <option value="">בחר אתר...</option>
        <option value="L">L</option>
        <option value="D">D</option>
        <option value="J">J</option>
        <option value="TER">TER</option>
        <option value="TLV">TLV</option>
        <option value="H">H</option>
      </select>
    </div>

    <div class="field">
      <label for="buildingInput">Building (מספר בלבד)</label>
      <input type="number" id="buildingInput" min="0" step="1" placeholder="לדוגמה: 291">
    </div>

    <div class="field">
      <label for="roomInput">Room (מספר בלבד)</label>
      <input type="number" id="roomInput" min="0" step="1" placeholder="לדוגמה: 6">
    </div>

    <div class="buttons">
      <button id="clearBtn" type="button">איפוס</button>
      <button id="printBtn" type="button">הדפס מדבקה</button>
    </div>
  </div>

  <!-- מה שיודפס בפועל (רק ברקוד) -->
  <div id="printArea">
    <svg id="barcode"></svg>
  </div>

  <script>
    const siteSelect    = document.getElementById('siteSelect');
    const buildingInput = document.getElementById('buildingInput');
    const roomInput     = document.getElementById('roomInput');
    const printBtn      = document.getElementById('printBtn');
    const clearBtn      = document.getElementById('clearBtn');
    const barcodeSvg    = document.getElementById('barcode');

    clearBtn.addEventListener('click', () => {
      buildingInput.value = "";
      roomInput.value = "";
      siteSelect.value = "";
      siteSelect.focus();
    });

    printBtn.addEventListener('click', () => {
      const site  = siteSelect.value.trim();
      const build = buildingInput.value.trim();
      const room  = roomInput.value.trim();

      if(!site){ alert("בחר אתר (אות באנגלית)"); return; }
      if(!build){ alert("הכנס מספר מבנה"); return; }
      if(!room){ alert("הכנס מספר חדר"); return; }

      if(typeof JsBarcode === "undefined"){
        alert("JsBarcode לא נטען (צריך אינטרנט ל-CDN).");
        return;
      }

      // הפורמט שבתוך הברקוד – בדיוק מה שתרצה שייכנס לאקסל
      // לדוגמה: L 291 6
      const data = `${site} ${build} ${room}`;

      try{
        JsBarcode(barcodeSvg, data, {
          format: "CODE128",
          width: 2,
          height: 60,
          displayValue: false   // בלי טקסט מתחת, רק ברקוד
        });

        // הדפסה מידית – המדפסת/סורק כבר יעשו את שלהם
        window.print();

        // אחרי הדפסה – איפוס חדר בלבד (אם תרצה גם אחרים, תשנה כאן)
        roomInput.value = "";
        roomInput.focus();

      } catch(e){
        console.error(e);
        alert("שגיאה ביצירת הברקוד.");
      }
    });
  </script>
</body>
</html>
