<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>כלי כיול - גלילה מלאה</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #333;
      font-family: sans-serif;
      text-align: center;
      /* מאפשר גלילה לגובה */
      overflow-y: auto; 
    }

    .header-instruction {
      background: #222;
      color: #fff;
      padding: 15px;
      position: relative;
      z-index: 10;
      border-bottom: 2px solid #555;
    }

    /* המעטפת שמתאימה את עצמה לרוחב המסך */
    #scalable-wrapper {
      width: 100%;
      margin: 0 auto;
      position: relative;
      overflow: hidden; 
      /* הגובה ייקבע דינמית על ידי ה-Javascript */
    }

    #fixed-canvas {
      width: 600px; /* הרוחב המקורי של התמונה */
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top left;
      background: white;
    }

    #bgImage {
      width: 100%;
      display: block;
      pointer-events: none; /* כדי לא להפריע לגרירה */
    }

    /* עיצוב האלמנטים הנגררים */
    .draggable-item {
      position: absolute;
      transform: translate(-50%, -50%);
      font-weight: bold;
      cursor: grab;
      background: rgba(255, 235, 59, 0.6); /* צהוב שקוף */
      border: 1px solid red;
      padding: 4px 8px;
      white-space: nowrap;
      z-index: 100;
      direction: rtl;
      font-size: 18px; 
      color: black;
      /* חשוב למובייל - מונע גלילה בזמן שגוררים את האלמנט */
      touch-action: none; 
    }

    .draggable-item:active {
      background: rgba(0, 255, 0, 0.6);
      border-color: green;
      cursor: grabbing;
    }

    /* אזור התוצאה למטה */
    .footer-area {
      background: #222;
      padding: 20px;
      color: white;
      min-height: 200px;
      border-top: 2px solid #555;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 300px;
      cursor: pointer;
      margin-bottom: 15px;
    }

    textarea {
      width: 90%;
      height: 150px;
      direction: ltr;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
    }
  </style>
</head>
<body>

  <div class="header-instruction">
    <h3>מצב כיול</h3>
    <p>גרור את הריבועים למקום המדויק על הדף.<br>ניתן לגלול את הדף למטה כדי להגיע לתחתית.</p>
  </div>

  <div id="scalable-wrapper">
    <div id="fixed-canvas">
      <img id="bgImage" src="mahala.jpg" onload="initCanvas()" onerror="alert('חסרה תמונה mahala.jpg')">

      <div class="draggable-item" id="nameText" style="left: 50%; top: 10%;">שם מלא</div>
      <div class="draggable-item" id="idText" style="left: 50%; top: 15%;">תעודת זהות</div>
      
      <div class="draggable-item" id="fromText" style="left: 60%; top: 20%;">מתאריך</div>
      <div class="draggable-item" id="toText" style="left: 45%; top: 20%;">עד תאריך</div>
      <div class="draggable-item" id="daysText" style="left: 30%; top: 20%;">ימים</div>

      <div class="draggable-item" id="doctorText" style="left: 50%; top: 25%;">רופא תחתון</div>
      <div class="draggable-item" id="bottomDateText" style="left: 80%; top: 25%;">תאריך תחתון</div>
    </div>
  </div>

  <div class="footer-area">
    <button onclick="getPositions()">✅ הצג נתונים להעתקה</button>
    <br>
    <textarea id="output" placeholder="הנתונים יופיעו כאן..."></textarea>
  </div>

  <script>
    const wrapper = document.getElementById('scalable-wrapper');
    const canvas = document.getElementById('fixed-canvas');
    const bgImage = document.getElementById('bgImage');
    const ORIGINAL_WIDTH = 600;

    function initCanvas() {
      // חישוב התאמה לרוחב המסך
      const screenWidth = window.innerWidth;
      const scale = screenWidth / ORIGINAL_WIDTH;
      
      // הגדרת ה-Scale
      canvas.style.transform = `scale(${scale})`;
      
      // חישוב הגובה הפיזי שהתמונה תופסת כדי שהדף ייפתח לגלילה
      // אנחנו מחכים רגע שהתמונה תיטען כדי לדעת את הגובה שלה
      setTimeout(() => {
        const imgHeight = bgImage.clientHeight; // גובה מקורי
        const scaledHeight = imgHeight * scale; // גובה אחרי הקטנה
        wrapper.style.height = scaledHeight + "px";
      }, 100);
    }

    window.addEventListener('resize', initCanvas);
    window.addEventListener('load', initCanvas);

    // --- לוגיקה של גרירה ---
    const draggables = document.querySelectorAll('.draggable-item');

    draggables.forEach(elm => {
      let isDragging = false;

      // תמיכה במגע (טלפון)
      elm.addEventListener('touchstart', (e) => {
        isDragging = true;
        // לא עושים preventDefault כאן באופן גורף כדי לאפשר גלילה
        // אבל ברגע שמתחילים לזוז, נבטל גלילה
      }, {passive: false});

      elm.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault(); // מונע את גלילת המסך כשגוררים את האלמנט
        const touch = e.touches[0];
        moveElement(elm, touch.clientX, touch.clientY);
      }, {passive: false});

      elm.addEventListener('touchend', () => { isDragging = false; });

      // תמיכה בעכבר (מחשב)
      elm.addEventListener('mousedown', () => isDragging = true);
      window.addEventListener('mouseup', () => isDragging = false);
      window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        moveElement(elm, e.clientX, e.clientY);
      });
    });

    function moveElement(elm, clientX, clientY) {
      // אנחנו צריכים לחשב את המיקום ביחס ל-Canvas המקורי (בלי ה-Scale)
      // הנוסחה: (מיקום העכבר - מיקום הקנבס) / סקייל
      
      const rect = canvas.getBoundingClientRect();
      const scale = canvas.getBoundingClientRect().width / canvas.offsetWidth; // חישוב ה-scale הנוכחי
      
      const x = (clientX - rect.left) / scale;
      const y = (clientY - rect.top) / scale;

      // המרה לאחוזים (יותר בטוח לרספונסיביות)
      const xPercent = (x / canvas.offsetWidth) * 100;
      const yPercent = (y / canvas.offsetHeight) * 100;

      elm.style.left = xPercent.toFixed(2) + '%';
      elm.style.top = yPercent.toFixed(2) + '%';
    }

    function getPositions() {
      let result = "אנא שלח לי את השורות האלה:\n-------------------------\n";
      const items = [
        {id: 'nameText', label: 'שם'},
        {id: 'idText', label: 'תעודת זהות'},
        {id: 'fromText', label: 'מתאריך'},
        {id: 'toText', label: 'עד תאריך'},
        {id: 'daysText', label: 'ימים'},
        {id: 'doctorText', label: 'רופא תחתון'},
        {id: 'bottomDateText', label: 'תאריך תחתון'},
      ];

      items.forEach(item => {
        const el = document.getElementById(item.id);
        result += `${item.id}: left: ${el.style.left}, top: ${el.style.top}\n`;
      });

      const txt = document.getElementById('output');
      txt.value = result;
      txt.select();
      
      // גלילה למטה לתוצאה
      txt.scrollIntoView({behavior: "smooth"});
    }
  </script>
</body>
</html>
