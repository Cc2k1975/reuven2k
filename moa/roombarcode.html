<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>מדבקת ברקוד – אתר / מבנה / חדר</title>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:system-ui,"Heebo","Arial",sans-serif;
      background:#f2f5f9;
      color:#111;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .app{
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.1);
      max-width:420px;
      width:100%;
      padding:20px 18px 18px;
    }

    h1{text-align:center;font-size:20px;margin-bottom:8px;}
    .subtitle{text-align:center;font-size:13px;color:#667;margin-bottom:16px;}

    .field{margin-bottom:12px;}
    label{display:block;font-size:14px;margin-bottom:4px;}

    select,input[type="text"]{
      width:100%;padding:8px 10px;font-size:14px;
      border-radius:10px;border:1px solid #ccd3de;
    }

    .buttons{
      margin-top:16px;
      display:flex;
      gap:8px;
    }

    button{
      flex:1;
      cursor:pointer;
      border:none;
      border-radius:999px;
      padding:10px;
      font-size:14px;
      font-weight:600;
    }

    #printBtn{background:#0078ff;color:white;}
    #clearRoomBtn{background:#e9edf4;color:#111;}

    /* ---------- מסך תצוגה לפני הדפסה ---------- */
    #previewOverlay{
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:9999;
    }
    #previewBox{
      background:white;
      border-radius:16px;
      padding:20px;
      width:300px;
      text-align:center;
    }

    #previewButtons{
      margin-top:15px;
      display:flex;
      gap:10px;
    }

    #previewButtons button{
      flex:1;
      padding:10px;
      font-size:14px;
      border-radius:12px;
      font-weight:600;
      border:none;
      cursor:pointer;
    }

    #confirmPrint{background:#0078ff;color:white;}
    #cancelPrint{background:#ddd;color:#111;}

    #previewBarcode{width:100%;margin-top:10px;}

    @media print{
      body{padding:0;margin:0;}
      .app, #previewOverlay{display:none;}
      #printArea{display:block !important;}
    }

    #printArea{display:none;text-align:center;padding:12px;}
  </style>
</head>
<body>

  <!-- מסך ראשי -->
  <div class="app">
    <h1>יצירת מדבקת ברקוד</h1>
    <div class="subtitle">אתר + מבנה + חדר</div>

    <div class="field">
      <label>אתר</label>
      <select id="siteSelect">
        <option value="">בחר אתר...</option>
        <option value="נהריה">נהריה</option>
        <option value="עכו">עכו</option>
        <option value="חיפה">חיפה</option>
        <option value="משרד ראשי">משרד ראשי</option>
      </select>
    </div>

    <div class="field">
      <label>מבנה</label>
      <input type="text" id="buildingInput" placeholder="לדוגמה: A או בניין 3" />
    </div>

    <div class="field">
      <label>חדר</label>
      <input type="text" id="roomInput" placeholder="לדוגמה: 204" />
    </div>

    <div class="buttons">
      <button id="clearRoomBtn">איפוס חדר</button>
      <button id="printBtn">הדפס מדבקה</button>
    </div>
  </div>

  <!-- שכבת תצוגה מקדימה -->
  <div id="previewOverlay">
    <div id="previewBox">
      <div>תצוגה לפני הדפסה</div>
      <svg id="previewBarcode"></svg>
      <div id="previewText" style="margin-top:10px;font-size:14px;"></div>

      <div id="previewButtons">
        <button id="cancelPrint">ביטול</button>
        <button id="confirmPrint">הדפס</button>
      </div>
    </div>
  </div>

  <!-- אזור שמודפס בפועל -->
  <div id="printArea">
    <svg id="barcode"></svg>
    <div id="printText" style="margin-top:8px;font-size:14px;"></div>
  </div>

  <script>
    const siteSelect = document.getElementById('siteSelect');
    const buildingInput = document.getElementById('buildingInput');
    const roomInput = document.getElementById('roomInput');
    const printBtn = document.getElementById('printBtn');
    const clearRoomBtn = document.getElementById('clearRoomBtn');

    const previewOverlay = document.getElementById('previewOverlay');
    const previewBarcode = document.getElementById('previewBarcode');
    const previewText = document.getElementById('previewText');

    const printAreaBarcode = document.getElementById('barcode');
    const printText = document.getElementById('printText');

    const confirmPrint = document.getElementById('confirmPrint');
    const cancelPrint = document.getElementById('cancelPrint');

    clearRoomBtn.addEventListener('click', ()=> roomInput.value = "");

    printBtn.addEventListener('click', function(){
      const site = siteSelect.value.trim();
      const building = buildingInput.value.trim();
      const room = roomInput.value.trim();

      if(!site){ alert("בחר אתר"); return; }
      if(!building){ alert("הכנס מבנה"); return; }
      if(!room){ alert("הכנס חדר"); return; }

      const data = `${site}|${building}|${room}`;

      // תצוגה מקדימה
      JsBarcode(previewBarcode, data, {format:"CODE128", width:2, height:60});
      previewText.textContent = `אתר: ${site} | מבנה: ${building} | חדר: ${room}`;

      previewOverlay.style.display = "flex";

      // כפתור ביטול
      cancelPrint.onclick = () => {
        previewOverlay.style.display = "none";
      };

      // כפתור הדפסה
      confirmPrint.onclick = () => {
        JsBarcode(printAreaBarcode, data, {format:"CODE128", width:2, height:60});
        printText.textContent = `אתר: ${site} | מבנה: ${building} | חדר: ${room}`;

        previewOverlay.style.display = "none";
        window.print();

        roomInput.value = "";
      };
    });
  </script>

</body>
</html>
