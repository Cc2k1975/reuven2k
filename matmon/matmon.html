<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××©×—×§ ×”××˜××•×Ÿ - Cc2k1975</title>
    <style>
        body { font-family: system-ui; background: #000; color: white; margin: 0; overflow: hidden; height: 100vh; touch-action: none; }
        #ui-layer { position: absolute; top: 0; width: 100%; z-index: 100; background: rgba(0,0,0,0.7); padding: 10px; text-align: center; pointer-events: none; }
        #timer-display { font-size: 24px; color: #e74c3c; font-weight: bold; margin-top: 5px; }
        #instruction-display { font-size: 18px; color: #f1c40f; margin-top: 5px; }
        #game-viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        #world { position: relative; transform-origin: center; width: 100%; display: flex; align-items: center; justify-content: center; }
        #game-image { width: 100%; height: auto; pointer-events: none; }
        #hidden-object { position: absolute; z-index: 50; line-height: 1; display: none; white-space: nowrap; transform: translate(-50%, -50%); border: 2px transparent dashed; }
        #admin-panel { display: none; position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(30, 39, 46, 0.95); padding: 12px; border-radius: 20px; border: 2px solid #f1c40f; z-index: 1000; width: 95%; max-width: 420px; max-height: 80vh; overflow-y: auto; }
        .mode-selector { display: flex; gap: 10px; margin-bottom: 10px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 10px; border: 2px solid #555; background: #1e272e; color: white; font-weight: bold; }
        .mode-btn.active { background: #f1c40f; color: black; }
        .emoji-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin: 10px 0; }
        .emoji-btn { font-size: 20px; background: #34495e; border: none; padding: 5px; border-radius: 5px; }
        .btn-group { display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap; }
        .btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: bold; }
        .save-btn { background: #2ecc71; color: white; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="ui-layer">
        <div>×©×œ×‘: <span id="level-num">1</span></div>
        <div id="instruction-display">×”×›×Ÿ ××ª ×¢×¦××š...</div>
        <div id="timer-display">30</div>
    </div>

    <div id="game-viewport">
        <div id="world">
            <img id="game-image" src="1.png">
            <div id="hidden-object">ğŸ‰</div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="mode-selector">
            <button id="btn-mode-img" class="mode-btn active" onclick="setEditMode('IMAGE')">ğŸ–¼ï¸ ×ª××•× ×”</button>
            <button id="btn-mode-obj" class="mode-btn" onclick="setEditMode('OBJECT')">ğŸ‰ ×¤×¨×™×˜</button>
        </div>
        <input type="text" id="stage-instruction" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:none;" placeholder="××” ×”××©×™××” ×œ×©×œ×‘ ×–×”?">
        
        <div style="background: #34495e; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
            <label style="font-size: 12px;">×˜×©×˜×•×©: <span id="blur-val">0</span>px</label>
            <input type="range" id="blur-slider" min="0" max="5" step="0.1" value="0" style="width:100%" oninput="updateBlur(this.value)">
        </div>

        <div style="display:flex; justify-content: space-between; gap:5px;">
            <select id="stage-select" style="flex:1; padding:10px; border-radius:5px;" onchange="loadStage()">
                <script>for(let i=0; i<10; i++) document.write(`<option value="${i}">×©×œ×‘ ${i+1}</option>`)</script>
            </select>
            <select id="bg-select" style="flex:1; padding:10px; border-radius:5px;" onchange="updateBG()">
                <option value="1.png">×ª××•× ×” 1</option>
                <option value="2.png">×ª××•× ×” 2</option>
            </select>
        </div>
        <div class="emoji-grid">
            <script>
                ['ğŸ‰','ğŸš—','ğŸ¤','ğŸ’','ğŸ•','âš½','ğŸš€','ğŸ¦','ğŸ¸','ğŸ©','ğŸš','ğŸ•¶ï¸','ğŸ”‘','ğŸ„','ğŸ§¸','ğŸš²','ğŸ¦€','ğŸ¦‹','âš“','ğŸ'].forEach(e => 
                    document.write(`<button class="emoji-btn" onclick="setEmoji('${e}')">${e}</button>`));
            </script>
        </div>
        <div class="btn-group">
            <button class="btn save-btn" onclick="saveStage()">×©××•×¨ ×‘×–×™×›×¨×•×Ÿ ×˜×œ×¤×•×Ÿ</button>
            <button class="btn" style="background:#3498db; color:white;" onclick="exportData()">×”×¢×ª×§ × ×ª×•× ×™× ×œ×”×¤×¦×” ğŸ“‹</button>
            <button class="btn" style="background:#e74c3c; color:white;" onclick="toggleAdmin(false)">×¡×’×•×¨</button>
        </div>
    </div>

    <script>
        const HARDCODED_DATA = [{"emoji":"ğŸ‰","bg":"1.png","x":32.6838,"y":55.7279,"size":9.635335808090517,"blur":0.3,"text":"××¦× ××ª ×”××‘×˜×™×—"},{"emoji":"ğŸš—","bg":"1.png","x":35.2357,"y":52.4927,"size":5.74842039221766,"blur":0.3,"text":"××¦× ××ª ×”××›×•× ×™×ª"},{"emoji":"ğŸ§¸","bg":"1.png","x":41.7217,"y":37.2278,"size":6.088606521429178,"blur":0.2,"text":"××¦× ××ª ×”×“×•×‘×™"},{"emoji":"ğŸ¸","bg":"1.png","x":54.4942,"y":56.8838,"size":7.477913311821709,"blur":0.2,"text":"××¦× ××ª ×”×’×™×˜×¨×”"},{"emoji":"ğŸš²","bg":"1.png","x":41.1741,"y":37.2748,"size":6.550753647541512,"blur":0,"text":"××¦× ××ª ×”××•×¤× ×™×™×"},{"emoji":"âš½","bg":"1.png","x":70.7292,"y":50.2267,"size":4.718315259879873,"blur":0.3,"text":"××¦× ××ª ×”×›×“×•×¨×’×œ"},{"emoji":"ğŸš€","bg":"1.png","x":87.2475,"y":39.1756,"size":4.940956079505426,"blur":0.2,"text":"××¦× ××ª ×”×˜×™×œ"},{"emoji":"ğŸš","bg":"1.png","x":19.9773,"y":74.3207,"size":12.239403559880756,"blur":0,"text":"××¦× ××ª ×”××¡×•×§"},{"emoji":"ğŸ„","bg":"1.png","x":44.002,"y":45.9382,"size":4.065748822569574,"blur":0.2,"text":"××¦× ××ª ×”×¤×˜×¨×™×”"},{"emoji":"ğŸ•","bg":"1.png","x":16.8742,"y":53.7018,"size":8.015579770335307,"blur":0,"text":"××¦× ××ª ×”×¤×™×¦×”"}];

        let gameData = HARDCODED_DATA;
        let currentLevel = 0, isAdminOpen = false, editTarget = 'IMAGE', pressTimer;
        let scale = 1, lastDist = 0, objSize = 35, posX = 0, posY = 0, startX = 0, startY = 0;
        let timeLeft = 30, timerInterval, currentBlur = 0;

        const world = document.getElementById('world'), viewport = document.getElementById('game-viewport');
        const obj = document.getElementById('hidden-object'), img = document.getElementById('game-image');
        const admin = document.getElementById('admin-panel'), timerEl = document.getElementById('timer-display');

        function loadStage() {
            let idx = isAdminOpen ? document.getElementById('stage-select').value : currentLevel;
            let data = gameData[idx];
            if(!data) return;

            document.getElementById('level-num').innerText = parseInt(idx) + 1;
            document.getElementById('instruction-display').innerText = data.text || '×—×¤×© ××ª ×”××•×‘×™×™×§×˜';
            
            img.src = data.bg;
            img.onload = () => {
                obj.innerText = data.emoji;
                obj.style.left = data.x + '%';
                obj.style.top = data.y + '%';
                objSize = Number(data.size) || 35;
                obj.style.fontSize = objSize + 'px';
                currentBlur = Number(data.blur) || 0;
                obj.style.filter = `blur(${currentBlur}px)`;
                obj.style.display = 'block';
            };
        }

        // ×œ×•×’×™×§×ª ×œ×—×™×¦×” ××¨×•×›×” ×œ×¡×™×¡××” - 10 ×©× ×™×•×ª ×œ×œ× ×ª×–×•×–×”
        viewport.ontouchstart = (e) => {
            if(isAdminOpen) {
                if(e.touches.length === 1) {
                    startX = e.touches[0].clientX - (editTarget === 'IMAGE' ? posX : 0);
                    startY = e.touches[0].clientY - (editTarget === 'IMAGE' ? posY : 0);
                }
                return;
            }

            // ××ª×—×™×œ ×˜×™×™××¨ ×œ×¡×™×¡××” ×¨×§ ×× ××™×Ÿ ×¤×× ×œ ×¤×ª×•×—
            clearTimeout(pressTimer);
            pressTimer = setTimeout(() => {
                let pass = prompt("×¡×™×¡××”:");
                if(pass === "4451") toggleAdmin(true);
            }, 10000); // 10 ×©× ×™×•×ª ×œ×—×™×¦×” ×¨×¦×•×¤×”

            if(e.touches.length === 1) { 
                startX = e.touches[0].clientX - posX; 
                startY = e.touches[0].clientY - posY; 
            }
        };

        viewport.ontouchend = () => { 
            clearTimeout(pressTimer); // ××‘×˜×œ ××ª ×”×˜×™×™××¨ ×× ×”×¨×™××• ××ª ×”××¦×‘×¢
            lastDist = 0; 
        };

        viewport.ontouchmove = (e) => {
            e.preventDefault();
            clearTimeout(pressTimer); // ××‘×˜×œ ××ª ×”×˜×™×™××¨ ×× ×”×–×™×–×• ××ª ×”××¦×‘×¢ (××•× ×¢ ×§×¤×™×¦×” ×‘×˜×¢×•×ª)

            if(isAdminOpen && editTarget === 'OBJECT') {
                if(e.touches.length === 1) {
                    let rect = img.getBoundingClientRect();
                    obj.style.left = ((e.touches[0].clientX - rect.left) / rect.width) * 100 + '%';
                    obj.style.top = ((e.touches[0].clientY - rect.top) / rect.height) * 100 + '%';
                }
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);
                    if(lastDist > 0) { 
                        objSize += (dist - lastDist) * 0.5; 
                        obj.style.fontSize = Math.max(5, objSize) + 'px'; 
                    }
                    lastDist = dist;
                }
            } else {
                if(e.touches.length === 1) { posX = e.touches[0].clientX - startX; posY = e.touches[0].clientY - startY; }
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);
                    if(lastDist > 0) { scale *= (dist / lastDist); scale = Math.max(1, Math.min(5, scale)); }
                    lastDist = dist;
                }
            }
            updateTransform();
        };

        function updateBlur(val) {
            currentBlur = parseFloat(val);
            document.getElementById('blur-val').innerText = val;
            obj.style.filter = `blur(${val}px)`;
        }

        function saveStage() {
            let idx = document.getElementById('stage-select').value;
            gameData[idx] = {
                emoji: obj.innerText, bg: document.getElementById('bg-select').value,
                x: parseFloat(obj.style.left), y: parseFloat(obj.style.top), 
                size: parseFloat(objSize), blur: parseFloat(currentBlur), text: document.getElementById('stage-instruction').value
            };
            localStorage.setItem('myGameData', JSON.stringify(gameData));
            alert("× ×©××¨!");
        }

        function exportData() {
            saveStage();
            const dataStr = JSON.stringify(gameData);
            navigator.clipboard.writeText(dataStr).then(() => {
                alert("×”× ×ª×•× ×™× ×”×•×¢×ª×§×•!");
            });
        }

        function toggleAdmin(show) {
            isAdminOpen = show;
            admin.style.display = show ? 'block' : 'none';
            if(!show) { scale = 1; posX = 0; posY = 0; updateTransform(); startTimer(); }
            else { clearInterval(timerInterval); }
            loadStage();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 30;
            timerEl.innerText = timeLeft;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("× ×’××¨ ×”×–××Ÿ! ×—×•×–×¨×™× ×œ×©×œ×‘ 1...");
                    currentLevel = 0; scale = 1; posX = 0; posY = 0; updateTransform(); loadStage(); startTimer();
                }
            }, 1000);
        }

        function updateTransform() { world.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`; }

        obj.onclick = (e) => {
            e.stopPropagation(); // ××•× ×¢ ××”×œ×—×™×¦×” ×¢×œ ×”××•×‘×™×™×§×˜ ×œ×”×¤×¢×™×œ ××ª ×œ×•×’×™×§×ª ×”×¨×§×¢
            if(!isAdminOpen) {
                clearInterval(timerInterval);
                alert("×›×œ ×”×›×‘×•×“! ××¦××ª.");
                currentLevel = (currentLevel + 1) % 10;
                scale = 1; posX = 0; posY = 0; updateTransform(); loadStage(); startTimer();
            }
        };

        function setEditMode(m) {
            editTarget = m;
            document.getElementById('btn-mode-img').classList.toggle('active', m === 'IMAGE');
            document.getElementById('btn-mode-obj').classList.toggle('active', m === 'OBJECT');
            obj.style.border = (m === 'OBJECT') ? "2px dashed #f1c40f" : "2px transparent dashed";
        }

        function setEmoji(e) { obj.innerText = e; }
        function updateBG() { img.src = document.getElementById('bg-select').value; }

        window.onload = () => { loadStage(); startTimer(); };
    </script>
</body>
</html>
