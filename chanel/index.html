<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>לוח שידורי ספורט חי</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #121212; color: #fff; text-align: center; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { color: #ff3e3e; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .game-card { background: #2a2a2a; margin: 10px 0; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-right: 5px solid #ff3e3e; transition: 0.3s; }
        .game-card:hover { background: #333; }
        .time { font-weight: bold; color: #00ff00; font-size: 1.1em; width: 80px; }
        .details { flex-grow: 1; text-align: right; padding-right: 15px; }
        .channel { background: #ff3e3e; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 0.9em; min-width: 100px; text-align: center; }
        #loader { font-style: italic; color: #888; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>שידורי ספורט - ערוץ 5</h1>
    <div id="loader">טוען נתונים מעודכנים מספורט 5...</div>
    <div id="broadcast-list"></div>
</div>

<script>
    async function fetchBroadcasts() {
        const listDiv = document.getElementById('broadcast-list');
        const loader = document.getElementById('loader');
        
        // שימוש ב-Proxy כדי לעקוף את חסימת ה-CORS
        const targetUrl = 'https://m.sport5.co.il/Pages/BroadcastSheet.aspx';
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

        try {
            const response = await fetch(proxyUrl);
            const data = await response.json();
            const parser = new DOMParser();
            const doc = parser.parseFromString(data.contents, 'text/html');

            // שליפת שורות השידור מהדף של ספורט 5
            const rows = doc.querySelectorAll('.tab-row, .broadcast-item, tr'); 
            let html = "";
            let found = false;

            rows.forEach(row => {
                const text = row.innerText.trim();
                
                // סינון: אנחנו מחפשים שורות שיש בהן שעה (למשל 20:45) ושם של ערוץ
                const timeMatch = text.match(/(\d{2}:\d{2})/);
                if (timeMatch && (text.includes("ספורט") || text.includes("5"))) {
                    const time = timeMatch[0];
                    // ניקוי הטקסט כדי להפריד בין המשחק לערוץ (לפי מבנה האתר)
                    let cleanText = text.replace(time, "").replace(/\n/g, " ").trim();
                    
                    // זיהוי שם הערוץ מתוך הטקסט
                    let channel = "ספורט 5"; 
                    if (text.includes("לייב") || text.includes("LIVE")) channel = "ספורט 5 LIVE";
                    if (text.includes("פלוס") || text.includes("+")) channel = "ספורט 5+";
                    if (text.includes("STARS")) channel = "5 STARS";
                    if (text.includes("GOLD")) channel = "5 GOLD";

                    html += `
                        <div class="game-card">
                            <div class="time">${time}</div>
                            <div class="details">${cleanText.split(channel)[0]}</div>
                            <div class="channel">${channel}</div>
                        </div>
                    `;
                    found = true;
                }
            });

            loader.style.display = 'none';
            if (found) {
                listDiv.innerHTML = html;
            } else {
                listDiv.innerHTML = "<p>לא נמצאו שידורים חיים כרגע בדף המקור.</p>";
            }

        } catch (error) {
            console.error(error);
            loader.innerHTML = "שגיאה בחיבור לשרת הספורט. נסה שוב מאוחר יותר.";
        }
    }

    // הפעלה בטעינה
    fetchBroadcasts();
    // רענון אוטומטי כל 10 דקות
    setInterval(fetchBroadcasts, 600000);
</script>

</body>
</html>
