<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>×›×¡×¤×ª ×¡×™×¡×××•×ª</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#e9eef5;
  padding:20px;
}
.card{
  max-width:450px;
  margin:0 auto;
  background:#fff;
  padding:25px;
  border-radius:16px;
  box-shadow:0 8px 18px rgba(0,0,0,0.15);
}
h2{margin-top:0;text-align:center;color:#222;}
input,button,textarea{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #bbb;
  font-size:16px;
}
button{
  background:#007bff;
  color:white;
  cursor:pointer;
  border:none;
}
button:hover{background:#005fcc;}
#addSection,#searchSection{display:none;}
.result{
  background:#f4f6fa;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
}
.label{font-weight:bold;color:#333;}
</style>
</head>

<body>

<div class="card" id="loginSection">
  <h2>×›× ×™×¡×” ×œ×›×¡×¤×ª</h2>
  <input type="password" id="masterPass" placeholder="×¡×™×¡××ª ×××¡×˜×¨">
  <button onclick="login()">×”×›× ×¡</button>
</div>

<div class="card" id="mainMenu" style="display:none;">
  <h2>×›×¡×¤×ª ×¡×™×¡×××•×ª</h2>
  <button onclick="showAdd()">â• ×”×•×¡×£ ×¡×™×¡××”</button>
  <button onclick="showSearch()">ğŸ” ×—×™×¤×•×©</button>
</div>

<div class="card" id="addSection">
  <h2>×”×•×¡×£ ×¡×™×¡××”</h2>
  <input id="service" placeholder="×©× ×”×©×™×¨×•×ª">
  <input id="url" placeholder="×›×ª×•×‘×ª ××ª×¨">
  <input id="user" placeholder="×©× ××©×ª××©">
  <input id="pass" placeholder="×¡×™×¡××”">
  <input id="email" placeholder="××™××™×™×œ ×©×—×–×•×¨">
  <input id="phone" placeholder="×˜×œ×¤×•×Ÿ ×©×—×–×•×¨">
  <textarea id="notes" placeholder="×”×¢×¨×•×ª"></textarea>
  <button onclick="savePass()">×©××•×¨</button>
  <button onclick="backMenu()">×—×–×•×¨</button>
</div>

<div class="card" id="searchSection">
  <h2>×—×™×¤×•×©</h2>
  <input id="searchInput" placeholder="×”×§×œ×“ ×œ×—×™×¤×•×©..." oninput="doSearch()">
  <div id="results"></div>
  <button onclick="backMenu()">×—×–×•×¨</button>
</div>

<!-- crypto-js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

<!-- Firebase -->
<script type="module">

// ---------- 1) ×”×›× ×¡×ª ×”×§×•× ×¤×™×’×•×¨×¦×™×” ×©×œ×š ×›××Ÿ !!! ----------
const firebaseConfig = {
  apiKey: "YOUR",
  authDomain: "YOUR",
  projectId: "YOUR",
  storageBucket: "YOUR",
  messagingSenderId: "YOUR",
  appId: "YOUR"
};
// ----------------------------------------------------------

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let MASTER = "";
let DATA = []; // ××¢×¨×š ×”×¡×™×¡×××•×ª ×œ××—×¨ ×¤×™×¢× ×•×—

// ×›× ×™×¡×”
window.login = async function(){
  MASTER = document.getElementById("masterPass").value.trim();
  if(!MASTER){ alert("×”×›× ×¡ ×¡×™×¡××”"); return; }

  const q = await getDocs(collection(db, "vault"));
  DATA = [];

  q.forEach(d=>{
    if(d.id==="init") return; // ×œ×“×œ×’ ×¢×œ ××¡××š ××ª×—×•×œ

    try{
      let dec = CryptoJS.AES.decrypt(d.data().blob, MASTER).toString(CryptoJS.enc.Utf8);
      if(dec){
        DATA.push(JSON.parse(dec));
      }
    }catch{}
  });

  document.getElementById("loginSection").style.display="none";
  document.getElementById("mainMenu").style.display="block";
};

// ×ª×¦×•×’×•×ª
window.showAdd = function(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("addSection").style.display="block";
};

window.showSearch = function(){
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("searchSection").style.display="block";
};

window.backMenu = function(){
  document.getElementById("addSection").style.display="none";
  document.getElementById("searchSection").style.display="none";
  document.getElementById("mainMenu").style.display="block";
};

// ×©××™×¨×”
window.savePass = async function(){

  let obj = {
    service: service.value.trim(),
    url: url.value.trim(),
    user: user.value.trim(),
    pass: pass.value.trim(),
    email: email.value.trim(),
    phone: phone.value.trim(),
    notes: notes.value.trim()
  };

  const encrypted = CryptoJS.AES.encrypt(JSON.stringify(obj), MASTER).toString();

  const id = "rec_" + Date.now();

  await setDoc(doc(db,"vault",id),{
    blob: encrypted
  });

  alert("× ×©××¨ ×‘×”×¦×œ×—×”");
  backMenu();
};

// ×—×™×¤×•×©
window.doSearch = function(){
  let q = document.getElementById("searchInput").value.trim();
  let r = document.getElementById("results");
  r.innerHTML="";

  if(q==="") return;

  DATA.forEach(item=>{
    if(
      item.service.includes(q) ||
      item.user.includes(q) ||
      item.url.includes(q) ||
      item.notes.includes(q)
    ){
      r.innerHTML += `
      <div class="result">
        <div><span class="label">×©×™×¨×•×ª:</span> ${item.service}</div>
        <div><span class="label">××©×ª××©:</span> ${item.user}</div>
        <div><span class="label">×¡×™×¡××”:</span> ${item.pass}</div>
        <div><span class="label">××™×™×œ:</span> ${item.email}</div>
        <div><span class="label">×˜×œ×¤×•×Ÿ:</span> ${item.phone}</div>
        <div><span class="label">×›×ª×•×‘×ª:</span> ${item.url}</div>
        <div><span class="label">×”×¢×¨×•×ª:</span> ${item.notes}</div>
      </div><br>`;
    }
  });
};

</script>
</body>
</html>
