<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>סורק מוצר – תקין</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  body {font-family:Heebo, sans-serif; background:#f5f5f5; margin:0; padding:16px; text-align:center;}
  h1 {font-size:22px; margin-bottom:10px;}
  video {width:100%; max-width:600px; border-radius:12px; background:#000; margin-top:10px;}
  button {padding:10px 16px; margin:8px; border:none; border-radius:8px; font-weight:600;}
  .start {background:#007bff; color:#fff;}
  .stop {background:#ccc;}
  #status {margin-top:10px; font-size:15px;}
</style>
</head>
<body>
<h1>POC – סורק מוצר</h1>
<video id="preview" playsinline autoplay muted></video><br>
<button id="start" class="start">הפעל סריקה</button>
<button id="stop" class="stop" disabled>עצור</button>
<div id="status">מוכן...</div>

<!-- טעינה מאובטחת של ZXing -->
<script>
(function loadZXing(){
  const s = document.createElement('script');
  s.src = "https://unpkg.com/@zxing/browser@0.1.1";
  s.onload = ()=>initApp();
  s.onerror = ()=>document.getElementById('status').innerText = "טעינת ZXing נכשלה!";
  document.head.appendChild(s);
})();
</script>

<script>
function initApp(){
  if (typeof ZXing === "undefined") {
    document.getElementById('status').innerText = "ZXing לא נטענה!";
    return;
  }

  const preview = document.getElementById('preview');
  const startBtn = document.getElementById('start');
  const stopBtn  = document.getElementById('stop');
  const statusEl = document.getElementById('status');
  let reader = null;
  let stream = null;

  async function startScan(){
    try{
      startBtn.disabled = true; stopBtn.disabled = false;
      reader = new ZXing.BrowserMultiFormatReader();
      stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}}});
      preview.srcObject = stream;
      statusEl.textContent = "מפעיל מצלמה...";
      reader.decodeFromVideoDevice(null, preview, (result, err)=>{
        if(result){
          statusEl.textContent = "נמצא ברקוד: " + result.text;
        }
      });
    }catch(e){
      statusEl.textContent = "שגיאה בהפעלת מצלמה: " + e.message;
      startBtn.disabled = false; stopBtn.disabled = true;
    }
  }

  function stopScan(){
    if(reader){ reader.reset(); reader=null; }
    if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
    preview.srcObject=null;
    startBtn.disabled = false; stopBtn.disabled = true;
    statusEl.textContent = "נעצר.";
  }

  startBtn.onclick = startScan;
  stopBtn.onclick = stopScan;
}
</script>
</body>
</html>
