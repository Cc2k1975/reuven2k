<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Charles BBQ â€“ ×¨×©×™××ª ×§× ×™×•×ª ×¢×œ ×”××©</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
:root{
    --bg-top:#0f172a;
    --bg-bottom:#1e293b;
    --card-bg:#ffffff;
    --card-radius:16px;
    --card-shadow:0 12px 30px rgba(15,23,42,0.35);
    --accent:#f97316;
    --accent-soft:#fff7ed;
    --accent-strong:#ea580c;
    --text-main:#0f172a;
    --text-muted:#6b7280;
    --chip-bg:#e5e7eb;
}

*{box-sizing:border-box;}

body{
    margin:0;
    min-height:100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
    background:linear-gradient(to bottom,var(--bg-top),var(--bg-bottom));
    color:#fff;
    padding:16px 12px 80px; /* ××§×•× ×œ×›×¤×ª×•×¨×™ ×”×ª×—×ª×™×ª */
}

.app-shell{
    max-width:900px;
    margin:0 auto;
}

/* ×›×•×ª×¨×ª ×¢×œ×™×•× ×” */
.hero{
    text-align:center;
    margin-bottom:18px;
}
.hero-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    background:rgba(15,23,42,0.9);
    border:1px solid rgba(148,163,184,0.7);
    border-radius:999px;
    padding:4px 10px;
    font-size:11px;
    margin-bottom:6px;
}
.hero-badge-dot{
    width:8px;height:8px;border-radius:999px;
    background:#22c55e;
    box-shadow:0 0 10px rgba(34,197,94,0.9);
}
.hero-title{
    font-size:26px;
    font-weight:800;
    letter-spacing:.08em;
    cursor:pointer;
    user-select: none;
}
.hero-sub{
    font-size:14px;
    color:#cbd5f5;
}

/* ×›×¨×˜×™×¡×™× */
.card{
    background:var(--card-bg);
    border-radius:var(--card-radius);
    box-shadow:var(--card-shadow);
    padding:14px;
    margin-bottom:16px;
}
.card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:6px;
}
.card-title{
    font-size:17px;
    font-weight:700;
    color:var(--text-main);
}
.card-tag{
    font-size:11px;
    padding:2px 8px;
    border-radius:999px;
    background:var(--chip-bg);
    color:var(--text-muted);
}

/* ×©×•×¨×•×ª ×©×œ ××•×¦×¨×™× */
.row{
    display:grid;
    grid-template-columns:1.6fr auto auto;
    column-gap:6px;
    align-items:center;
    padding:8px 0;
    border-bottom:1px solid #e5e7eb;
    font-size:14px;
}
.row:last-child{border-bottom:none;}
.row label{
    display:flex;
    align-items:center;
    gap:6px;
    color:var(--text-main);
}

.row-amount, .row-cost{
    text-align:center;
    color:var(--text-main);
}
.amount-label, .cost-label{
    font-size:11px;
    color:var(--text-muted);
    margin-bottom:2px;
}
.amount-value{
    font-size:15px;
    font-weight:700;
}
.cost-value{
    font-size:17px;
    font-weight:800;
}

/* ×§×œ×˜ ××©×ª×ª×¤×™× */
.people-input{
    margin-top:4px;
}
.people-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
}
.people-input label{
    display:block;
    font-size:12px;
    color:var(--text-muted);
    margin-bottom:2px;
}
.people-input select{
    width:100%;
    padding:7px 8px;
    font-size:16px;
    border-radius:999px;
    border:1px solid #cbd5e1;
    text-align:center;
}

/* ×¡×™×›×•× */
.summary-box{
    background:var(--accent-soft);
    border-radius:14px;
    padding:10px 12px;
}
.summary-label{
    font-size:13px;
    color:var(--text-muted);
}
.summary-value-main{
    font-size:22px;
    font-weight:800;
    color:var(--accent-strong);
}

/* ×›×•×ª×¨×•×ª ×§×˜× ×•×ª */
.section-title{
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:.1em;
    color:var(--text-muted);
    margin-bottom:4px;
}

/* ×›×¤×ª×•×¨×™× ×‘×ª×—×ª×™×ª (×—×–×¨ ×œ-3 ×›×¤×ª×•×¨×™×) */
.footer-buttons{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:#0f172a;
    padding:10px 12px;
    display:grid;
    grid-template-columns:repeat(3,1fr); 
    gap:8px;
    box-shadow:0 -6px 16px rgba(0,0,0,0.4);
    z-index:20;
}

button{
    border:none;
    border-radius:999px;
    padding:10px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:6px;
}

/* ×¦×‘×¢×™ ×›×¤×ª×•×¨×™× */
.btn-print{background:#1e293b;color:#e5e7eb;}
.btn-calendar{background:#6366f1;color:#ffffff;} 
.btn-whatsapp{background:#25d366;color:white;}

@media print{
    body{background:#ffffff;padding:0;}
    .app-shell{max-width:none;margin:0;}
    .card{box-shadow:none;border-radius:0;margin:0 0 6px;}
    .footer-buttons{display:none !important;}
    .hero-badge{display:none;}
}

/* --- ×—×œ×•×Ÿ × ×™×”×•×œ (Admin) --- */
.admin-overlay{
    position:fixed;
    inset:0;
    background:rgba(15,23,42,0.95);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:50;
}
.admin-panel{
    background:#ffffff;
    color:var(--text-main);
    border-radius:16px;
    padding:16px;
    width:90%;
    max-width:500px;
    max-height:85vh;
    box-shadow:0 18px 40px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
}
.admin-title{
    font-size:18px;
    font-weight:700;
    margin-bottom:4px;
}
.admin-sub{
    font-size:12px;
    color:var(--text-muted);
    margin-bottom:10px;
}
.admin-actions {
    display:flex;
    gap:10px;
    margin-bottom:10px;
    background: #f1f5f9;
    padding: 10px;
    border-radius: 8px;
}
.btn-add-prod {
    background: #0f172a; 
    color: white; 
    font-size:13px; 
    padding:8px 12px;
    width: 100%;
    flex-direction: row;
}
.admin-list{
    flex:1;
    overflow-y:auto;
    border-top:1px solid #e5e7eb;
    border-bottom:1px solid #e5e7eb;
    margin:8px 0;
}
.admin-row{
    display:grid;
    grid-template-columns:1.5fr auto auto;
    gap:6px;
    align-items:center;
    padding:8px 0;
    border-bottom:1px solid #f3f4f6;
    font-size:14px;
}
.admin-row:last-child{border-bottom:none;}
.admin-name{font-weight:600;}
.admin-row input{
    width:70px;
    padding:4px 6px;
    border-radius:6px;
    border:1px solid #cbd5e1;
    text-align:center;
}
.admin-unit{font-size:13px;color:var(--text-muted);}
.admin-buttons{
    display:flex;
    justify-content:flex-end;
    gap:8px;
    margin-top:6px;
}
.admin-btn{
    padding:8px 16px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    font-size:13px;
    font-weight:600;
    flex-direction: row;
}
.admin-cancel{background:#e5e7eb;color:#374151;}
.admin-save{background:#22c55e;color:#052e16;}

/* ×—×œ×•×Ÿ ×¢×¨×™×›×ª ××•×¦×¨ ×‘×•×“×“ */
#editPopup{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:60;
}
#editBox{
    background:#ffffff;
    color:#111827;
    padding:20px;
    width:90%;
    max-width:350px;
    border-radius:14px;
    box-shadow:0 16px 40px rgba(0,0,0,0.5);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
}
#editBox h3{margin:0 0 10px;font-size:18px;}
#editBox label{display:block;font-size:13px;margin-top:8px;margin-bottom:2px;font-weight:600;}
#editBox input{
    width:100%;padding:8px;
    border-radius:8px;border:1px solid #cbd5e1;
    font-size:16px;
}
#editButtons{display:flex;justify-content:space-between;margin-top:16px; gap:8px;}
#editButtons button{
    flex:1;padding:10px 0;
    border-radius:8px;border:none;cursor:pointer;
    font-weight:600;font-size:14px;
    flex-direction: row;
}
#btnCancel{background:#e5e7eb;color:#374151;}
#btnSave{background:#22c55e;color:#052e16;}
#btnDelete{background:#ef4444;color:#ffffff;} /* ×›×¤×ª×•×¨ ××—×™×§×” ××“×•× */

/* ×—×œ×•×Ÿ ×™×•××Ÿ (Event) */
#eventOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:70;
}
.event-box{
    background:#ffffff;
    color:var(--text-main);
    padding:20px;
    width:90%;
    max-width:400px;
    border-radius:16px;
    box-shadow:0 10px 40px rgba(0,0,0,0.5);
}
.event-title{font-size:20px;font-weight:800;margin-bottom:12px;text-align:center;}
.event-field{margin-bottom:10px;}
.event-field label{display:block;font-size:12px;color:var(--text-muted);margin-bottom:4px;}
.event-field input, .event-field textarea{
    width:100%;
    padding:10px;
    border:1px solid #cbd5e1;
    border-radius:8px;
    font-family:inherit;
    font-size:14px;
}
.event-field textarea{resize:vertical;min-height:60px;}
.btn-send-event{
    background:#25d366;color:white;width:100%;margin-top:10px;
    font-size:16px;padding:12px;
    flex-direction: row;
}
.btn-close-event{
    background:#e5e7eb;color:#374151;width:100%;margin-top:8px;
    flex-direction: row;
}

.item-name{
    cursor:pointer;
    text-decoration:underline;
    text-decoration-style:dotted;
}
</style>
</head>

<body>
<div class="app-shell">

    <div class="hero">
        <div class="hero-badge">
            <span class="hero-badge-dot"></span>
            <span>××—×©×‘×•×Ÿ ×¢×œ ×”××© â€“ CHARLES BBQ</span>
        </div>
        <div id="heroTitle" class="hero-title">CHARLES BBQ</div>
        <div class="hero-sub">××›× ×™×¡×™× ××¡×¤×¨ ×¡×•×¢×“×™×, ××¡×× ×™× ××” ×§×•× ×™× â€“ ×•×”××—×©×‘×•×Ÿ ×¢×•×©×” ××ª ×›×œ ×”×—×™×©×•×‘×™×</div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×›××•×ª ××©×ª×ª×¤×™×</div>
            <div class="card-tag">×©×œ×‘ 1</div>
        </div>
        <div class="people-input">
            <div class="people-grid">
                <div>
                    <label for="menCount">×’×‘×¨×™×</label>
                    <select id="menCount" onchange="calc()"></select>
                </div>
                <div>
                    <label for="womenCount">× ×©×™×</label>
                    <select id="womenCount" onchange="calc()"></select>
                </div>
                <div>
                    <label for="kidsCount">×™×œ×“×™×</label>
                    <select id="kidsCount" onchange="calc()"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">×¡×™×›×•× ×”×•×¦××”</div>
            <div class="card-tag">××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª</div>
        </div>
        <div class="summary-box">
            <div class="summary-label">×¡×”×´×› ×”×•×¦××”</div>
            <div class="summary-value-main"><span id="totalCost">0.00</span> â‚ª</div>
            <div class="summary-label" style="margin-top:8px;">×œ×›×œ ××©×ª×ª×£</div>
            <div class="summary-value-main"><span id="perPerson">0.00</span> â‚ª</div>
            <div class="summary-label" style="margin-top:8px;">×›××•×ª ×‘×©×¨ ×œ×¡×•×¢×“ (×’×¨×)</div>
            <div class="summary-value-main"><span id="meatPerPerson">0</span> ×’×¨×</div>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><div class="card-title">×‘×©×¨×™× ×•×“×’×™×</div></div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="meatList"></div>
    </div>
    <div class="card">
        <div class="card-header"><div class="card-title">×¡×œ×˜×™× ×•×ª×•×¡×¤×•×ª</div></div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="sidesList"></div>
    </div>
    <div class="card">
        <div class="card-header"><div class="card-title">×©×ª×™×™×” ×•×§×™× ×•×—×™×</div></div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="drinksList"></div>
    </div>
    <div class="card">
        <div class="card-header"><div class="card-title">×—×“×´×¤ ×•×ª×¤×¢×•×œ</div></div>
        <div class="section-title">×¤×¨×™×˜ Â· ×›××•×ª Â· ××—×™×¨</div>
        <div id="otherList"></div>
    </div>
    <div class="card">
        <div class="card-header"><div class="card-title">×œ× ×œ×©×›×•×— ×œ×§×—×ª</div></div>
        <div id="noForgetList"></div>
    </div>

</div>

<div class="footer-buttons">
    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ×”×“×¤×¡</button>
    <button class="btn-calendar" onclick="openEventModal()">ğŸ—“ï¸ ×”×•×¡×£ ×œ×™×•××Ÿ</button>
    <button class="btn-whatsapp" onclick="sendWhatsapp()">ğŸŸ¢ ×•×•×¦××¤</button>
</div>

<div id="eventOverlay">
    <div class="event-box">
        <div class="event-title">×¤×¨×˜×™ ×”××™×¨×•×¢</div>
        
        <div class="event-field">
            <label>×©× ×”××™×¨×•×¢</label>
            <input type="text" id="evtName" placeholder="×œ××©×œ: ×™×•× ×”×•×œ×“×ª ×œ×™×•×¡×™">
        </div>
        
        <div class="event-field">
            <label>×ª××¨×™×š</label>
            <input type="date" id="evtDate">
        </div>
        
        <div class="event-field">
            <label>×©×¢×”</label>
            <input type="time" id="evtTime">
        </div>
        
        <div class="event-field">
            <label>××™×§×•×</label>
            <input type="text" id="evtLocation" placeholder="×›×ª×•×‘×ª ××• ×©× ×¤××¨×§">
        </div>
        
        <div class="event-field">
            <label>×”×¢×¨×•×ª</label>
            <textarea id="evtNotes" placeholder="××” ×œ×”×‘×™×? ×”×•×¨××•×ª ×”×’×¢×”?"></textarea>
        </div>

        <button class="btn-send-event" onclick="sendEventWhatsapp()">×©×œ×— ×‘×•×•×¦××¤ ×œ×—×‘×¨×™×</button>
        <button class="btn-close-event" onclick="closeEventModal()">×¡×’×•×¨</button>
    </div>
</div>

<div id="adminOverlay" class="admin-overlay">
    <div class="admin-panel">
        <div class="admin-title">× ×™×”×•×œ ×•×”×•×¡×¤×ª ××•×¦×¨×™×</div>
        <div class="admin-sub">×›××Ÿ ××¤×©×¨ ×œ×¢×“×›×Ÿ ××—×™×¨×™× ××• ×œ×”×•×¡×™×£ ×¤×¨×™×˜×™× ×—×“×©×™×</div>
        
        <div class="admin-actions">
            <button class="button btn-add-prod" onclick="addNewProductFlow()">â• ×œ×—×¥ ×›××Ÿ ×œ×”×•×¡×¤×ª ××•×¦×¨ ×—×“×©</button>
        </div>

        <div id="adminList" class="admin-list"></div>
        <div class="admin-buttons">
            <button class="admin-btn admin-cancel" onclick="closeAdmin()">×¡×’×•×¨</button>
            <button class="admin-btn admin-save" onclick="saveAdmin()">×©××•×¨ ××—×™×¨×™×</button>
        </div>
    </div>
</div>

<div id="editPopup">
  <div id="editBox">
    <h3 id="editTitle"></h3>
    <label>××—×™×¨ ×œ×™×—×™×“×”/×§×™×œ×• (â‚ª):</label>
    <input id="inputPrice" type="number" step="0.1" min="0">
    <label>×›××•×ª ×œ×’×‘×¨:</label>
    <input id="inputMen" type="number" step="0.001" min="0">
    <label>×›××•×ª ×œ××™×©×”:</label>
    <input id="inputWomen" type="number" step="0.001" min="0">
    <label>×›××•×ª ×œ×™×œ×“:</label>
    <input id="inputKids" type="number" step="0.001" min="0">
    
    <div id="editButtons">
      <button id="btnDelete">ğŸ—‘ï¸ ××—×§</button>
      <button id="btnCancel">×‘×™×˜×•×œ</button>
      <button id="btnSave">×©××•×¨</button>
    </div>
  </div>
</div>

<script>
// === Firebase init ===
var firebaseConfig = {
  apiKey: "AIzaSyD22egEOUQVw6gni9GdBEsRV8xeFxS8LC4",
  authDomain: "basar-22170.firebaseapp.com",
  databaseURL: "https://basar-22170-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "basar-22170",
  storageBucket: "basar-22170.firebasestorage.app",
  messagingSenderId: "263079371932",
  appId: "1:263079371932:web:e83390dad2915e6be67959"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

let DATA = [];
const NO_FORGET = [
    "×× ×’×œ","××œ×§×—×™×™×","×’× ×¨×˜×•×¨","×§×•×‘×™×ª ×›×•×—","×’×¨×™×œ× ×“×”","×¤×¨×•×–×§×˜×•×¨",
    "××™×›×œ ×“×œ×§","×©×•×œ×—× ×•×ª","×‘×•×¦×¨×™×","×¡×›×™× ×™×","×¤×œ×¤×œ ××œ×—",
    "××¤×¦×œ ×—×©××œ","×××¨×™×š ×—×©××œ","×›×™×¡××•×ª","××§×¨×Ÿ",
    "×¢×¨×›×ª ×¢×–×¨×” ×¨××©×•× ×”","××¤×ª ×©×•×œ×—×Ÿ","×¦×™×“× ×™×•×ª","×§×¨×—×•× ×™×","×’×–×™×•×ª","×¨×›×‘ ×’×“×•×œ"
];
const UNIT_ITEMS = new Set(["×¡×œ×˜","×¤×™×ª×”","× ×¢× ×¢","×‘×§×‘×•×§ ×©×ª×™×” ××ª×•×§×”","×‘×™×¨×”","×™×™×Ÿ","××™×","×¤×—××™×","×©××Ÿ","× ×™×™×¨ × ×™×’×•×‘ (×—×‘×™×œ×” ×©×œ 6)","×¡×›×•× + ×¦×œ×—×•×ª","×ª×‘× ×™×•×ª ××œ×•××™× ×™×•×","××™×›×œ ×’×–"]);
const FIXED_ITEMS = new Set(["× ×¢× ×¢","×¤×—××™×","×©××Ÿ","×“×œ×§","× ×™×™×¨ × ×™×’×•×‘ (×—×‘×™×œ×” ×©×œ 6)","×ª×‘× ×™×•×ª ××œ×•××™× ×™×•×","××™×›×œ ×’×–"]);

function buildRow(item){
    const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
    const labelText = UNIT_ITEMS.has(item.name) ? "×™×—×™×“×•×ª" : "××©×§×œ (×§×´×’)";
    return `
        <div class="row">
            <label>
                <input type="checkbox" data-name="${id}" onchange="calc()">
                <span class="item-name" data-name="${id}">${item.name}</span>
            </label>
            <div class="row-amount">
                <div class="amount-label">${labelText}</div>
                <div class="amount-value" id="amount-${id}">0.00</div>
            </div>
            <div class="row-cost">
                <div class="cost-label">××—×™×¨ (â‚ª)</div>
                <div class="cost-value" id="cost-${id}">0.0</div>
            </div>
        </div>
    `;
}

function renderLists(){
    document.getElementById("meatList").innerHTML   = "";
    document.getElementById("sidesList").innerHTML  = "";
    document.getElementById("drinksList").innerHTML = "";
    document.getElementById("otherList").innerHTML  = "";
    document.getElementById("noForgetList").innerHTML = "";

    DATA.forEach(item=>{
        const html = buildRow(item);
        if(item.category==="meat")   document.getElementById("meatList").insertAdjacentHTML('beforeend', html);
        if(item.category==="sides")  document.getElementById("sidesList").insertAdjacentHTML('beforeend', html);
        if(item.category==="drinks") document.getElementById("drinksList").insertAdjacentHTML('beforeend', html);
        if(item.category==="other")  document.getElementById("otherList").insertAdjacentHTML('beforeend', html);
    });

    NO_FORGET.forEach(n=>{
        document.getElementById("noForgetList").insertAdjacentHTML('beforeend',`<div class="row"><label><input type="checkbox"> ${n}</label></div>`);
    });
    attachNameLongPressHandlers();
}

function calc(){
    const men   = Number(document.getElementById("menCount").value)   || 0;
    const women = Number(document.getElementById("womenCount").value) || 0;
    const kids  = Number(document.getElementById("kidsCount").value)  || 0;
    const totalPeople = men + women + kids || 1;
    let total = 0;
    let meatTotalKg = 0;

    DATA.forEach(item=>{
        const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
        const cb = document.querySelector(`input[data-name="${id}"]`);
        const amountEl = document.getElementById(`amount-${id}`);
        const costEl   = document.getElementById(`cost-${id}`);
        if(!amountEl || !costEl) return;

        if(cb && cb.checked){
            let amount;
            if(FIXED_ITEMS.has(item.name)) amount = 1;
            else {
                const perMen = item.perMen || 0;
                const perWomen = item.perWomen || 0;
                const perKids = item.perKids || 0;
                amount = perMen*men + perWomen*women + perKids*kids;
            }
            const price = Number(item.price) || 0;
            const cost  = amount * price;
            amountEl.textContent = amount.toFixed(2);
            costEl.textContent   = cost.toFixed(1);
            total += cost;
            if(item.category === "meat") meatTotalKg += amount;
        } else {
            amountEl.textContent = "0.00";
            costEl.textContent   = "0.0";
        }
    });

    document.getElementById("totalCost").textContent = total.toFixed(2);
    document.getElementById("perPerson").textContent = (total / (totalPeople || 1)).toFixed(2);
    let meatPerPersonGrams = 0;
    if(totalPeople > 0) meatPerPersonGrams = (meatTotalKg / totalPeople) * 1000;
    document.getElementById("meatPerPerson").textContent = meatPerPersonGrams.toFixed(0);
}

function sendWhatsapp(){
    const total = document.getElementById("totalCost").textContent;
    const men   = document.getElementById("menCount").value;
    const women = document.getElementById("womenCount").value;
    const kids  = document.getElementById("kidsCount").value;
    
    let msg = `ğŸ”¥ Charles BBQ â€“ ×¨×©×™××ª ×§× ×™×•×ª\n`;
    msg += `××©×ª×ª×¤×™×: ×’×‘×¨×™× ${men}, × ×©×™× ${women}, ×™×œ×“×™× ${kids}\n`;
    msg += `×¡×”\"×›: ${total} â‚ª\n\n`;
    msg += `×¤×¨×™×˜×™× ×©×¡×™×× ×ª×™:\n`;

    DATA.forEach(item=>{
        const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
        const cb = document.querySelector(`input[data-name="${id}"]`);
        const amountEl = document.getElementById(`amount-${id}`);
        if(cb && cb.checked){
            msg += `â€¢ ${item.name} (${amountEl.textContent})\n`;
        }
    });
    window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(msg), "_blank");
}

/* =========================================
   ×¤×•× ×§×¦×™×•×ª ×™×•××Ÿ ×•×”×–×× ×”
   ========================================= */
function openEventModal(){
    document.getElementById("eventOverlay").style.display = "flex";
    document.getElementById("evtDate").valueAsDate = new Date();
}

function closeEventModal(){
    document.getElementById("eventOverlay").style.display = "none";
}

function sendEventWhatsapp(){
    const name = document.getElementById("evtName").value;
    const date = document.getElementById("evtDate").value;
    const time = document.getElementById("evtTime").value;
    const loc  = document.getElementById("evtLocation").value;
    const notes= document.getElementById("evtNotes").value;

    if(!name){ alert("× × ×œ×¨×©×•× ×©× ××™×¨×•×¢"); return; }

    let msg = `*×”×–×× ×” ×œ××™×¨×•×¢ â€“ ${name}* ğŸ–ğŸ”¥\n\n`;
    if(date) msg += `ğŸ“… ×ª××¨×™×š: ${date}\n`;
    if(time) msg += `ğŸ•’ ×©×¢×”: ${time}\n`;
    if(loc)  msg += `ğŸ“ ××™×¤×”: ${loc}\n`;
    if(notes) msg += `\n×”×¢×¨×•×ª: ${notes}\n`;
    
    msg += `\n××—×›×™× ×œ×¨××•×ª×›×!\n× ×©×œ×— ×“×¨×š Charles BBQ`;

    window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent(msg), "_blank");
}

/* =========================================
   ×× ×”×œ + ×”×•×¡×¤×ª ××•×¦×¨×™× (×œ×—×™×¦×” ××¨×•×›×” ×¢×œ ×›×•×ª×¨×ª)
   ========================================= */
let longPressTimer = null;
function setupLongPress(){
    const title = document.getElementById("heroTitle");
    if(!title) return;
    const start = (e)=>{
        // e.preventDefault(); // × ×•×ª×Ÿ ×œ××©×ª××© ×œ×’×œ×•×œ ×× ×œ× ×œ×•×—×¥ ××¨×•×š
        longPressTimer = setTimeout(openAdmin, 3000); // 3 ×©× ×™×•×ª
    };
    const cancel = ()=>{ clearTimeout(longPressTimer); };
    title.addEventListener("mousedown", start);
    title.addEventListener("touchstart", start);
    title.addEventListener("mouseup", cancel);
    title.addEventListener("mouseleave", cancel);
    title.addEventListener("touchend", cancel);
}

function openAdmin(){
    const overlay = document.getElementById("adminOverlay");
    const listDiv = document.getElementById("adminList");
    listDiv.innerHTML = "";
    DATA.forEach((item,idx)=>{
        listDiv.insertAdjacentHTML('beforeend',
            `<div class="admin-row">
                <span class="admin-name">${item.name}</span>
                <input type="number" step="0.1" value="${item.price}" data-idx="${idx}">
                <span class="admin-unit">â‚ª</span>
             </div>`
        );
    });
    overlay.style.display = "flex";
}

function closeAdmin(){
    document.getElementById("adminOverlay").style.display = "none";
}

function saveAdmin(){
    const inputs = document.querySelectorAll("#adminList input[data-idx]");
    inputs.forEach(inp=>{
        const idx = Number(inp.getAttribute("data-idx"));
        const val = parseFloat(inp.value);
        if(!isNaN(val) && val >= 0){
            const item = DATA[idx];
            db.ref("products/" + item.name + "/price").set(val);
        }
    });
    closeAdmin();
}

// === ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ××•×¦×¨ ×—×“×© ===
function addNewProductFlow(){
    const name = prompt("×”×›× ×¡ ×©× ×œ××•×¦×¨ ×”×—×“×©:");
    if(!name) return;
    
    if(DATA.find(d=>d.name===name)){
        alert("××•×¦×¨ ×–×” ×›×‘×¨ ×§×™×™×!");
        return;
    }

    const catMap = {
        "1": "meat", "2": "sides", "3": "drinks", "4": "other"
    };
    const catChoice = prompt("×‘×—×¨ ×§×˜×’×•×¨×™×”:\n1 - ×‘×©×¨×™×\n2 - ×¡×œ×˜×™×/×ª×•×¡×¤×•×ª\n3 - ×©×ª×™×™×”\n4 - ×—×“ ×¤×¢××™/××—×¨");
    const category = catMap[catChoice] || "other";
    
    const price = prompt("××—×™×¨ ×œ×™×—×™×“×”/×§×™×œ×• (×‘×©×§×œ×™×):", "0");
    
    db.ref("products/" + name).set({
        category: category,
        price: Number(price) || 0,
        perMen: 0,
        perWomen: 0,
        perKids: 0
    }).then(()=>{
        closeAdmin();
        alert("×”××•×¦×¨ × ×•×¦×¨! ××™×™×“ ×™×™×¤×ª×— ×—×œ×•×Ÿ ×œ×¢×¨×™×›×ª ×”×›××•×™×•×ª ×©×œ×•.");
        setTimeout(()=>{
            const newItem = DATA.find(d=>d.name===name);
            if(newItem) openEditor(newItem);
        }, 1500);
    });
}

/* =========================================
   ×¢×¨×™×›×ª ×›××•×™×•×ª ××•×¦×¨ ×•××—×™×§×” (×œ×—×™×¦×” ××¨×•×›×” ×¢×œ ×¤×¨×™×˜)
   ========================================= */
let currentEditItem = null;
function attachNameLongPressHandlers(){
    DATA.forEach(item=>{
        const id = item.name.replace(/\s+/g,'_').replace(/[()]/g,'');
        const el = document.querySelector(`.item-name[data-name="${id}"]`);
        if(!el) return;
        
        let timer;
        const start = (e)=>{ timer = setTimeout(()=>openEditor(item), 1500); };
        const cancel = ()=>{ clearTimeout(timer); };
        
        el.addEventListener("mousedown", start);
        el.addEventListener("touchstart", start);
        el.addEventListener("mouseup", cancel);
        el.addEventListener("mouseleave", cancel);
        el.addEventListener("touchend", cancel);
    });
}

function openEditor(item){
    currentEditItem = item;
    document.getElementById("editTitle").textContent = item.name;
    document.getElementById("inputPrice").value = item.price || 0;
    document.getElementById("inputMen").value   = item.perMen || 0;
    document.getElementById("inputWomen").value = item.perWomen || 0;
    document.getElementById("inputKids").value  = item.perKids || 0;
    document.getElementById("editPopup").style.display = "flex";
}

document.getElementById("btnCancel").onclick = ()=> document.getElementById("editPopup").style.display = "none";

document.getElementById("btnSave").onclick = function(){
    if(!currentEditItem) return;
    const price = parseFloat(document.getElementById("inputPrice").value) || 0;
    const pm = parseFloat(document.getElementById("inputMen").value) || 0;
    const pw = parseFloat(document.getElementById("inputWomen").value) || 0;
    const pk = parseFloat(document.getElementById("inputKids").value) || 0;

    db.ref("products/" + currentEditItem.name).update({
        price: price, perMen: pm, perWomen: pw, perKids: pk
    }).then(()=>{
        document.getElementById("editPopup").style.display = "none";
        alert("× ×©××¨ ×‘×”×¦×œ×—×”!");
    });
};

document.getElementById("btnDelete").onclick = function(){
    if(!currentEditItem) return;

    if(confirm("×”×× ×œ××—×•×§ ××ª ×”××•×¦×¨ " + currentEditItem.name + " ×œ×¦××™×ª×•×ª?")){
        db.ref("products/" + currentEditItem.name).remove()
        .then(()=>{
            document.getElementById("editPopup").style.display = "none";
            alert("×”××•×¦×¨ × ××—×§!");
        })
        .catch(err => alert("×©×’×™××” ×‘××—×™×§×”: " + err));
    }
};

/* =========================================
   ××™×ª×—×•×œ
   ========================================= */
function initPeopleSelects(){
    const max=20;
    ["menCount","womenCount","kidsCount"].forEach(id=>{
        const sel=document.getElementById(id);
        for(let i=0;i<=max;i++){
            const opt=document.createElement("option");
            opt.value=i; opt.textContent=i;
            sel.appendChild(opt);
        }
    });
}

function initFromFirebase(){
    db.ref("products").on("value", snap=>{
        const obj = snap.val() || {};
        DATA = Object.keys(obj).map(name=>({
            name,
            price: obj[name].price,
            category: obj[name].category,
            perMen: obj[name].perMen,
            perWomen: obj[name].perWomen,
            perKids: obj[name].perKids
        }));
        renderLists();
        calc();
    });
}

setupLongPress(); // ×”×¤×¢×œ×ª ×”×œ×—×™×¦×” ×”××¨×•×›×” ×¢×œ ×”×›×•×ª×¨×ª
initPeopleSelects();
initFromFirebase();
</script>
</body>
</html>
