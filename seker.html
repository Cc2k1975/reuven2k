<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>סקר</title>
<style>
:root{--bg:#000;--panel:#111;--text-main:#ffd700;--text-body:#ddd;--border:#ccaa22;--error-bg:#500;--ok-bg:#063;--btn-bg:#d2b11c;--btn-text:#000;--radius:8px;}
body{margin:0;background:var(--bg);font-family:Arial;color:var(--text-body);display:flex;justify-content:center;padding:16px;}
.wrap{max-width:520px;width:100%;background:var(--panel);border-radius:var(--radius);padding:20px 16px 32px;border:1px solid #222;box-shadow:0 0 20px #000;}
h1{text-align:center;color:var(--text-main);}
label{display:block;color:var(--text-main);margin:20px 4px 8px;font-weight:600;}
input,select,textarea{width:100%;background:#222;color:var(--text-body);border:2px solid var(--border);border-radius:var(--radius);font-size:18px;padding:12px;}
button{width:100%;background:var(--btn-bg);color:var(--btn-text);font-size:22px;font-weight:700;border:0;border-radius:var(--radius);padding:12px;cursor:pointer;}
#modalOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:99;}
#modalBox{max-width:320px;width:90%;background:#111;border:2px solid var(--border);border-radius:var(--radius);padding:20px 16px;text-align:center;}
#modalMessage{margin-bottom:16px;color:#fff;font-size:18px;font-weight:600;padding:12px;border-radius:var(--radius);}
#modalOkBtn{width:100%;background:var(--btn-bg);color:var(--btn-text);border:0;border-radius:var(--radius);padding:10px;font-size:18px;font-weight:700;}
</style>
</head>
<body>
<div class="wrap">
<h1>עוברים לחדרה</h1>
<form id="surveyForm">
  <label>מחלקה:</label>
  <select id="dept" required>
    <option value="">בחר...</option><option>אווירודינמיקה</option><option>מחמ</option><option>מטה</option><option>ניווט</option><option>בקמ</option><option>טילאות</option><option>סימולציות</option>
  </select>
  <label>שם העובד:</label><input id="workerName" required>
  <label>מספר נייד:</label><input id="phone" type="tel" required>
  <label>מבנה איסוף:</label><input id="building" required>
  <label>קומה איסוף:</label><input id="floor" required>
  <label>חדר איסוף:</label><input id="room" required>
  <label>כמות אריזות:</label>
  <select id="packs" required><option value="">בחר...</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
  <label>חדר יעד:</label><input id="targetRoom" required>
  <label>הערות (לא חובה):</label><textarea id="notes"></textarea>
  <button type="submit">שלח</button>
</form>
<div style="text-align:center;margin-top:10px;color:#888;">גרסה 1.2.0</div>
</div>

<div id="modalOverlay"><div id="modalBox"><div id="modalMessage"></div><button id="modalOkBtn">אישור</button></div></div>

<script>
const BIN="68fefa3dd0ea881f40beb941";
const KEY="$2a$10$cSsqpLyw9Jl/8q0El4JzqOuwLRUINEoMNeyxeUQ726QdlvNMD0iTe";
const API="https://api.jsonbin.io/v3/b";
const f=document.getElementById("surveyForm"),overlay=document.getElementById("modalOverlay"),msg=document.getElementById("modalMessage");
document.getElementById("modalOkBtn").onclick=()=>overlay.style.display="none";
function pop(m,ok){msg.style.background=ok?"var(--ok-bg)":"var(--error-bg)";msg.textContent=m;overlay.style.display="flex";}
async function getData(){const r=await fetch(`${API}/${BIN}`,{headers:{"X-Access-Key":KEY}});const j=await r.json();return j.record;}
async function save(d){await fetch(`${API}/${BIN}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Access-Key":KEY},body:JSON.stringify(d)});}
f.onsubmit=async e=>{
  e.preventDefault();pop("בודק...",true);
  try{
    const rec=await getData();
    if(rec.formOpen===false){pop("לא ניתן יותר להירשם",false);return;}
    const arr=Array.isArray(rec.answers)?rec.answers:[];
    const ph=document.getElementById("phone").value.trim();
    if(arr.some(a=>a.phone===ph)){pop("נרשמת כבר, אנא פנה לצ׳רלס 0523719856",false);return;}
    const a={dept:dept.value.trim(),workerName:workerName.value.trim(),phone:ph,building:building.value.trim(),floor:floor.value.trim(),room:room.value.trim(),packs:packs.value.trim(),targetRoom:targetRoom.value.trim(),notes:notes.value.trim(),ts:new Date().toISOString()};
    arr.push(a);
    await save({answers:arr,formOpen:rec.formOpen!==false});
    pop("נשמר בהצלחה ✔",true);
    f.reset();
  }catch(err){pop("שגיאה: "+err.message,false);}
};
</script>
</body>
</html>
