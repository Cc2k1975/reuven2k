<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>שידור חי</title>

  <style>
    :root {
      --bg1:#0f1115;
      --bg2:#1a1f2b;
      --accent:#00ffa9;

      --board-blue:#1a1446;
      --board-gold:#d5b646;
      --score-bg:#f4dd3a;
      --score-text:#000000;
      --timer-bg:#ffffff;
      --timer-text:#000000;
      --board-text:#ffffff;
    }

    * {
      box-sizing:border-box;
      -webkit-font-smoothing:antialiased;
    }

    body {
      margin:0;
      background:radial-gradient(circle at 20% 20%,var(--bg2) 0%,var(--bg1) 70%);
      color:#fff;
      font-family:"Heebo",Arial,sans-serif;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:20px 16px 60px;
    }

    .wrap {
      width:100%;
      max-width:1200px;
      text-align:center;
      position:relative;
    }

    /* למעלה: שם הליגה (עורך מהחלון) + אייקון */
    .header-row {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-bottom:12px;
    }

    .league-title {
      margin:0;
      font-size:1.2rem;
      font-weight:700;
      color:#fff;
      line-height:1.3;
    }

    .channel-logo {
      width:44px;
      height:44px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.4);
      box-shadow:0 0 12px rgba(0,0,0,0.8);
      cursor:pointer;
      flex-shrink:0;
      object-fit:cover;
    }

    /* הווידאו */
    .player-shell {
      position:relative;
      background:#000;
      border-radius:16px;
      box-shadow:0 20px 40px rgba(0,0,0,0.85);
      border:1px solid rgba(255,255,255,0.08);
      width:100%;
      aspect-ratio:16/9;
      overflow:hidden;
      margin:0 auto;
    }

    .rotator {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(-90deg) scale(1.8);
      transform-origin:center center;
      background:#000;
      min-width:100vh;
      min-height:100vw;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .rotator iframe {
      border:none;
      background:#000;
      width:100vw;
      height:100vh;
      max-width:none;
      max-height:none;
    }

    /* לוח התוצאות בשמאל למעלה */
    .score-overlay-wrapper {
      position:absolute;
      top:8px;
      left:8px;
      z-index:5;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      pointer-events:none;
      font-family:Heebo,Arial,sans-serif;
    }

    .overlay-topline {
      width:100%;
      height:4px;
      background:var(--board-gold);
      border-top-left-radius:4px;
      border-top-right-radius:4px;
    }

    .overlay-body {
      display:flex;
      align-items:center;
      background:var(--board-blue);
      color:var(--board-text);
      font-size:0.8rem;
      font-weight:600;
      line-height:1.2;
      border-bottom-left-radius:4px;
      border-bottom-right-radius:4px;
      box-shadow:0 8px 24px rgba(0,0,0,0.8);
      border:1px solid rgba(0,0,0,0.6);
      border-top:none;
    }

    /* כל צד = שם קבוצה + תוצאה שלה, באותה שורה */
    .team-side {
      display:flex;
      align-items:center;
      white-space:nowrap;
      max-width:170px;
      min-width:0;
    }

    .team-name {
      padding:4px 8px;
      color:var(--board-text);
      text-overflow:ellipsis;
      overflow:hidden;
      max-width:130px;
    }

    .team-score {
      background:var(--score-bg);
      color:var(--score-text);
      font-weight:700;
      padding:4px 6px;
      min-width:24px;
      text-align:center;
      font-family:"Roboto Mono","Courier New",monospace;
      border-left:1px solid rgba(0,0,0,0.4);
      border-right:1px solid rgba(0,0,0,0.4);
    }

    .timer-block {
      background:var(--timer-bg);
      color:var(--timer-text);
      font-weight:700;
      padding:4px 8px;
      font-family:"Roboto Mono","Courier New",monospace;
      min-width:46px;
      text-align:center;
      border-left:1px solid rgba(0,0,0,0.4);
      border-right:1px solid rgba(0,0,0,0.4);
    }

    /* כפתור רענון למטה */
    .refresh-zone {
      text-align:center;
      margin-top:18px;
    }

    .refresh-btn {
      appearance:none;
      border:0;
      outline:0;
      cursor:pointer;
      border-radius:999px;
      padding:10px 16px;
      font-size:1rem;
      font-weight:600;
      background:radial-gradient(circle at 20% 20%,#2b323f 0%,#1a1f2b 70%);
      color:var(--accent);
      box-shadow:0 10px 24px rgba(0,0,0,0.8),0 0 10px rgba(0,255,169,0.2);
      border:1px solid rgba(0,255,169,0.4);
      min-width:140px;
    }
    .refresh-btn.ok{
      background:radial-gradient(circle at 20% 20%,#2f4730 0%,#1f2f20 70%);
      color:#8dff8d;
      border:1px solid rgba(0,255,0,0.5);
      box-shadow:0 10px 24px rgba(0,0,0,0.8),0 0 10px rgba(0,255,0,0.25);
    }

    /* החלון הסודי (מוגדל) */
    .edit-popup {
      position:absolute;
      top:60px;
      right:50%;
      transform:translateX(50%);
      background:#1a1f2b;
      color:#fff;
      border-radius:12px;
      box-shadow:0 30px 60px rgba(0,0,0,0.9);
      border:1px solid rgba(255,255,255,0.15);
      padding:20px;
      width:320px;
      max-width:calc(100% - 40px);
      font-size:0.9rem;
      line-height:1.5;
      display:none;
      z-index:9999;
      text-align:right;
    }

    .edit-popup h2 {
      font-size:1rem;
      font-weight:600;
      margin:0 0 14px;
      color:#fff;
      text-align:center;
    }

    .edit-field {
      display:flex;
      flex-direction:column;
      margin-bottom:14px;
    }

    .edit-field label {
      font-size:0.8rem;
      margin-bottom:4px;
      color:#9aa3b2;
    }

    .edit-field input {
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.2);
      background:#0f1115;
      color:#fff;
      padding:10px 12px;
      font-size:0.9rem;
      outline:none;
    }

    .ctl-btn {
      appearance:none;
      border:0;
      outline:0;
      cursor:pointer;
      width:100%;
      font-size:0.9rem;
      font-weight:600;
      border-radius:8px;
      padding:10px 12px;
      background:#0f1115;
      color:#fff;
      border:1px solid rgba(255,255,255,0.2);
      text-align:center;
      margin-bottom:8px;
    }

    @media(max-width:480px){
      .league-title{font-size:1rem;}
      .timer-block{min-width:44px;font-size:0.7rem;}
      .team-name{max-width:100px;font-size:0.7rem;padding:4px 6px;}
      .team-score{min-width:22px;font-size:0.7rem;padding:4px 5px;}
    }
  </style>
</head>
<body>

  <div class="wrap">

    <!-- כותרת הליגה למעלה (אתה שולט עליה) -->
    <div class="header-row">
      <img
        class="channel-logo"
        id="channelLogo"
        src="https://yt3.ggpht.com/XEIE69D8DP1huYwLhSrHbEPhU9nfLjqSX7P8mZ8NLceUeDX68BoH1ORcxWy-NufREOy9xo1Dkw=s600-c-k-c0x00ffffff-no-rj-rp-mo"
        alt="ערוץ" />
      <div class="league-title" id="leagueTitle">שידורי חי הפועל חיפה נערים א' 2009</div>
    </div>

    <!-- הווידאו הגדול -->
    <div class="player-shell">

      <!-- לוח תוצאה בשמאל למעלה -->
      <div class="score-overlay-wrapper">
        <div class="overlay-topline"></div>
        <div class="overlay-body" id="overlayBody">

          <!-- קבוצה ביתית + תוצאה -->
          <div class="team-side" id="homeSide">
            <div class="team-name" id="teamHome_name">הפועל חיפה</div>
            <div class="team-score" id="teamHome_score">0</div>
          </div>

          <!-- שעון -->
          <div class="timer-block" id="liveTimer">00:00</div>

          <!-- קבוצה אורחת + תוצאה -->
          <div class="team-side" id="awaySide">
            <div class="team-score" id="teamAway_score">0</div>
            <div class="team-name" id="teamAway_name">מכבי חיפה</div>
          </div>

        </div>
      </div>

      <!-- הזרם מיוטיוב -->
      <div class="rotator">
        <iframe
          id="livePlayer"
          src="https://www.youtube.com/embed/live_stream?channel=UCu2doG-TFmd4b2paosdg1xg&autoplay=1&mute=1&playsinline=1"
          allow="autoplay; encrypted-media; picture-in-picture; fullscreen"
          allowfullscreen>
        </iframe>
      </div>
    </div>

    <!-- כפתור רענון שידור -->
    <div class="refresh-zone">
      <button class="refresh-btn" id="refreshBtn">רענן שידור</button>
    </div>

    <!-- החלון הסודי -->
    <div class="edit-popup" id="editPopup">
      <h2>שליטה בשידור</h2>

      <div class="edit-field">
        <label>שם הליגה / שם המשחק למעלה</label>
        <input id="league_input" type="text" value="שידורי חי הפועל חיפה נערים א' 2009">
      </div>

      <div class="edit-field">
        <label>קבוצה ביתית</label>
        <input id="teamHome_input" type="text" value="הפועל חיפה">
        <label>תוצאה ביתית</label>
        <input id="scoreHome_input" type="number" min="0" value="0">
      </div>

      <div class="edit-field">
        <label>קבוצה אורחת</label>
        <input id="teamAway_input" type="text" value="מכבי חיפה">
        <label>תוצאה אורחת</label>
        <input id="scoreAway_input" type="number" min="0" value="0">
      </div>

      <!-- שליטה בשעון -->
      <button class="ctl-btn" id="startBtn">הפעל שעון (התחלה מדקה 00:00)</button>

      <button class="ctl-btn" id="togglePauseBtn">הפסקת מחצית (עצור)</button>

      <button class="ctl-btn" id="resetBtn">איפוס שעון</button>

      <!-- יציאה -->
      <button class="ctl-btn" id="closePopupBtn">יציאה</button>
    </div>

  </div>

  <script>
    /******************
     * שעון משחק
     ******************/
    let elapsedMs = 0;  // זמן שנצבר
    let running   = false;
    let startTs   = null;

    function fmtTime(ms) {
      const totalSec = Math.floor(ms / 1000);
      const mm = Math.floor(totalSec / 60);
      const ss = totalSec % 60;
      const mmStr = mm < 10 ? "0"+mm : ""+mm;
      const ssStr = ss < 10 ? "0"+ss : ""+ss;
      return mmStr + ":" + ssStr;
    }

    function updateTimerDisplay() {
      const box = document.getElementById("liveTimer");
      if (!box) return;
      let shown = elapsedMs;
      if (running && startTs !== null) {
        shown = elapsedMs + (Date.now() - startTs);
      }
      box.textContent = fmtTime(shown);
    }

    // עדכון תצוגה קבוע
    setInterval(updateTimerDisplay, 500);

    function startClock() {
      // הפעלה התחלתית (אם שכחת קודם)
      if (!running) {
        running = true;
        startTs = Date.now();
      }
    }

    function togglePauseResume() {
      // אם רץ -> עצור. אם עצור -> המשך.
      const btn = document.getElementById("togglePauseBtn");
      if (running && startTs !== null) {
        // לעצור (מחצית)
        elapsedMs += Date.now() - startTs;
        running = false;
        startTs = null;
        if (btn) btn.textContent = "חזרה למחצית / המשך";
        updateTimerDisplay();
      } else {
        // להמשיך
        running = true;
        startTs = Date.now();
        if (btn) btn.textContent = "הפסקת מחצית (עצור)";
      }
    }

    function resetClock() {
      elapsedMs = 0;
      running = false;
      startTs = null;
      const btn = document.getElementById("togglePauseBtn");
      if (btn) btn.textContent = "הפסקת מחצית (עצור)";
      updateTimerDisplay();
    }

    /******************
     * שדות לייב - ליגה/קבוצות/תוצאות
     ******************/
    function bindLiveField(inputId, cb) {
      const el = document.getElementById(inputId);
      if (!el) return;
      const handler = () => cb(el.value);
      el.addEventListener("input", handler);
      handler(); // פעם ראשונה
    }

    function setupLiveBindings() {
      // כותרת למעלה
      bindLiveField("league_input", (val)=>{
        const t = document.getElementById("leagueTitle");
        if (t) t.textContent = val.trim() || "";
      });

      // קבוצה ביתית (שמאל)
      bindLiveField("teamHome_input", (val)=>{
        const t = document.getElementById("teamHome_name");
        if (t) t.textContent = val.trim() || "";
      });
      bindLiveField("scoreHome_input", (val)=>{
        const t = document.getElementById("teamHome_score");
        if (t) t.textContent = val.trim()==="" ? "0" : val;
      });

      // קבוצה אורחת (ימין)
      bindLiveField("teamAway_input", (val)=>{
        const t = document.getElementById("teamAway_name");
        if (t) t.textContent = val.trim() || "";
      });
      bindLiveField("scoreAway_input", (val)=>{
        const t = document.getElementById("teamAway_score");
        if (t) t.textContent = val.trim()==="" ? "0" : val;
      });
    }

    /******************
     * יוטיוב + רענון
     ******************/
    function forcePlay() {
      const player = document.getElementById("livePlayer");
      if (player && player.contentWindow) {
        player.contentWindow.postMessage(
          '{"event":"command","func":"playVideo","args":""}',
          "*"
        );
      }
    }

    function refreshLivePlayer() {
      const iframe = document.getElementById("livePlayer");
      if (!iframe) return;
      const baseURL = "https://www.youtube.com/embed/live_stream?channel=UCu2doG-TFmd4b2paosdg1xg&autoplay=1&mute=1&playsinline=1";
      iframe.src = baseURL + "&t=" + Date.now();

      const btn = document.getElementById("refreshBtn");
      const original = btn.textContent;
      btn.textContent = "עודכן ✔";
      btn.classList.add("ok");
      setTimeout(()=>{
        btn.textContent = original;
        btn.classList.remove("ok");
      },2000);

      setTimeout(forcePlay,1200);
    }

    /******************
     * פתיחת/סגירת חלון שליטה
     ******************/
    function togglePopup(showForce) {
      const popup = document.getElementById("editPopup");
      if (!popup) return;
      if (showForce === true) {
        popup.style.display = "block";
        return;
      }
      if (showForce === false) {
        popup.style.display = "none";
        return;
      }
      popup.style.display = (popup.style.display==="block") ? "none" : "block";
    }

    /******************
     * הפעלה ראשונית
     ******************/
    window.addEventListener("load", () => {
      const logoBtn        = document.getElementById("channelLogo");
      const refreshBtn     = document.getElementById("refreshBtn");
      const startBtn       = document.getElementById("startBtn");
      const togglePauseBtn = document.getElementById("togglePauseBtn");
      const resetBtn       = document.getElementById("resetBtn");
      const closePopupBtn  = document.getElementById("closePopupBtn");
      const player         = document.getElementById("livePlayer");

      // ודא אוטופליי
      if (player && !player.src.includes("autoplay=1")) {
        player.src += "&autoplay=1&mute=1&playsinline=1";
      }

      // נסה להתחיל ניגון
      setTimeout(forcePlay,1500);

      // רענון
      if (refreshBtn) refreshBtn.addEventListener("click", refreshLivePlayer);

      // פתח/סגור חלון בלחיצה על התמונה
      if (logoBtn) {
        logoBtn.addEventListener("click", ()=>togglePopup());
      }

      // כפתורי השעון
      if (startBtn)       startBtn.addEventListener("click", startClock);
      if (togglePauseBtn) togglePauseBtn.addEventListener("click", togglePauseResume);
      if (resetBtn)       resetBtn.addEventListener("click", resetClock);

      // יציאה (סגור)
      if (closePopupBtn) {
        closePopupBtn.addEventListener("click", ()=>togglePopup(false));
      }

      // חיבור בין השדות ללייב על המסך
      setupLiveBindings();

      // אתחול טיימר בתצוגה
      updateTimerDisplay();
    });
  </script>

</body>
</html>
