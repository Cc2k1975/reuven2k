<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp PTT - No Duplicates</title>
    <style>
        :root { --wa-green: #25D366; --wa-dark: #075E54; }
        body { 
            font-family: system-ui, sans-serif; background-color: #f0f2f5; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; padding: 15px; 
            user-select: none; -webkit-user-select: none; touch-action: manipulation;
        }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); width: 100%; max-width: 400px; text-align: center; }
        .box { background: #f8f9fa; border: 2px solid #eaebec; border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: right; }
        .label { font-size: 12px; color: #666; font-weight: bold; }
        .field { font-size: 18px; font-weight: bold; color: var(--wa-dark); min-height: 25px; word-break: break-all; }
        
        .ptt-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: none;
            background-color: #34b7f1; color: white; font-size: 20px; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            margin: 20px auto; display: block; touch-action: none;
            transition: transform 0.1s, background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .ptt-btn:active { background-color: #ff4b2b; transform: scale(0.92); }

        .btn-paste { width: 100%; padding: 14px; background-color: #6c757d; color: white; border: none; border-radius: 10px; font-weight: bold; margin-bottom: 10px; cursor: pointer; }
        .status { font-size: 14px; color: #888; margin-top: 10px; height: 20px; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color: var(--wa-dark); margin-top: 0;">专 砖 ( 驻转)</h2>
    
    <div class="box">
        <div class="label">住驻专 注:</div>
        <div id="phoneField" class="field">---</div>
    </div>
    
    <div class="box">
        <div class="label">注:</div>
        <div id="msgField" class="field" style="font-weight: normal;">---</div>
    </div>

    <button class="btn-paste" onclick="pasteFromClipboard()"> 拽 住驻专 专</button>

    <button id="pttBtn" class="ptt-btn">抓 拽<br></button>

    <div id="status" class="status">抓  转</div>
    
    <button class="btn-paste" style="background:#eee; color:#333; margin-top:15px;" onclick="location.reload()">拽 </button>
</div>

<script>
    let recognition;
    let lockedNumber = "";
    let currentFinalTranscript = "";

    function initRecognition() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new Speech();
        recognition.lang = 'he-IL';
        recognition.continuous = true;
        recognition.interimResults = true;

        recognition.onresult = (event) => {
            let interimTranscript = "";
            //  砖 砖  拽住 转  注 驻转 砖 注
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                interimTranscript += event.results[i][0].transcript;
            }
            
            //   住驻 (+=),  注 转  砖爪 专注
            updateUI(interimTranscript);
        };
    }

    function updateUI(text) {
        const phoneElem = document.getElementById('phoneField');
        const msgElem = document.getElementById('msgField');

        //  住驻专 驻 (10 住驻专转 专砖转)
        if (!lockedNumber) {
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 10) {
                lockedNumber = digits.substring(0, 10);
                phoneElem.innerText = lockedNumber;
            } else {
                phoneElem.innerText = digits || "---";
            }
        }

        // 抓 注 (  砖 住驻专)
        if (lockedNumber) {
            let messagePart = text.replace(lockedNumber, '').trim();
            // 拽 转 砖  转转 转
            messagePart = messagePart.replace(/^[^a-zA-Z-转]+/, '');
            msgElem.innerText = messagePart || "---";
            currentFinalTranscript = messagePart;
        }
    }

    const btn = document.getElementById('pttBtn');

    // 转转 爪
    btn.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        if (!recognition) initRecognition();
        
        currentFinalTranscript = "";
        document.getElementById('status').innerText = "拽砖... 砖专专 砖";
        recognition.start();
    });

    // 砖专专 爪
    window.addEventListener('pointerup', (e) => {
        if (recognition && recognition.onspeechstart !== null) {
            recognition.stop();
            document.getElementById('status').innerText = "砖...";
            
            // 砖 拽   砖住驻 拽 转 拽住 专 砖
            setTimeout(sendToWhatsApp, 600);
        }
    });

    function sendToWhatsApp() {
        let num = document.getElementById('phoneField').innerText.replace(/\D/g, '');
        let msg = currentFinalTranscript;

        if (!num || num.length < 9) {
            document.getElementById('status').innerText = "  住驻专 转拽";
            return;
        }

        if (num.startsWith('0')) num = '972' + num.substring(1);
        window.location.href = `https://wa.me/${num}?text=${encodeURIComponent(msg)}`;
    }

    async function pasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            let digits = text.replace(/\D/g, '');
            if (digits.length >= 9) {
                lockedNumber = digits;
                document.getElementById('phoneField').innerText = lockedNumber;
                document.getElementById('status').innerText = "住驻专 拽. 注砖 抓 专 注.";
            }
        } catch (e) { alert("砖专 砖 "); }
    }

    // 注转 转驻专 注爪 爪 专
    window.oncontextmenu = (e) => { e.preventDefault(); e.stopPropagation(); return false; };
</script>
</body>
</html>
