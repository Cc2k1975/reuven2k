<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>×›×¡×¤×ª ×¡×™×¡×××•×ª PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #4f46e5; --p-h: #4338ca; --bg: #f8fafc; --txt: #1e293b; --border: #e2e8f0; --danger: #ef4444; }
        body { margin: 0; font-family: 'Assistant', sans-serif; background: var(--bg); color: var(--txt); display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 500px; }
        .card { background: #fff; padding: 24px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h2 { text-align: center; margin-bottom: 20px; color: var(--p); }
        input, textarea { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid var(--border); border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 16px; margin-bottom: 10px; }
        .btn-p { background: var(--p); color: white; }
        .btn-p:hover { background: var(--p-h); }
        .btn-bio { background: #fff; color: var(--p); border: 2px solid var(--p); display: none; }
        .vault-item { background: #fff; border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 12px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 14px; }
        .actions { display: flex; gap: 10px; }
        .copy { color: var(--p); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 4px; }
        .del { color: var(--danger); cursor: pointer; font-weight: 600; }
        .hidden { display: none !important; }
        .fab { position: fixed; bottom: 30px; left: 30px; width: 60px; height: 60px; border-radius: 30px; background: var(--p); color: white; font-size: 30px; box-shadow: 0 5px 15px rgba(79,70,229,0.4); }
        .pass-display { font-family: monospace; background: #f1f5f9; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSec" class="card">
        <h2>ğŸ”’ ×›×¡×¤×ª ×‘×™×•××˜×¨×™×ª</h2>
        <input type="password" id="masterPass" placeholder="×¡×™×¡××ª ×××¡×˜×¨">
        <button id="btnLogin" class="btn-p">×›× ×™×¡×” ×¢× ×¡×™×¡××”</button>
        <button id="btnBio" class="btn-bio">ğŸ§¬ ×›× ×™×¡×” ×¢× ×˜×‘×™×¢×ª ××¦×‘×¢</button>
        <p id="status" style="text-align:center; font-size:14px; color:red;"></p>
    </div>

    <div id="mainSec" class="hidden">
        <input type="text" id="search" placeholder="ğŸ” ×—×™×¤×•×© ×©×™×¨×•×ª...">
        <div id="list"></div>
        <button id="addBtn" class="fab">+</button>
    </div>

    <div id="addSec" class="card hidden">
        <h2 id="editTitle">×”×•×¡×¤×ª ×¤×¨×™×˜</h2>
        <input id="service" placeholder="×©× ×”×©×™×¨×•×ª">
        <input id="user" placeholder="×©× ××©×ª××©">
        <input id="pass" placeholder="×¡×™×¡××”">
        <textarea id="notes" placeholder="×”×¢×¨×•×ª"></textarea>
        <button id="saveBtn" class="btn-p">×©××•×¨</button>
        <button onclick="show('main')" style="background:#eee;">×‘×™×˜×•×œ</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBYdxUWldY4AptA9g826alHQ__vRcKA3Vc",
      authDomain: "pass-b0ac7.firebaseapp.com",
      projectId: "pass-b0ac7",
      storageBucket: "pass-b0ac7.firebasestorage.app",
      messagingSenderId: "322974091258",
      appId: "1:322974091258:web:0e07c2f7807aaf1f18c643"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDocs, deleteDoc, collection } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let MASTER = "", DATA = [], EDIT_ID = null;

    const show = (id) => {
        document.getElementById('loginSec').classList.toggle('hidden', id !== 'login');
        document.getElementById('mainSec').classList.toggle('hidden', id !== 'main');
        document.getElementById('addSec').classList.toggle('hidden', id !== 'add');
    };

    if (window.PublicKeyCredential && localStorage.getItem('bio_v')) {
        document.getElementById('btnBio').style.display = 'block';
    }

    async function registerBio(pwd) {
        try {
            const challenge = window.crypto.getRandomValues(new Uint8Array(32));
            const credential = await navigator.credentials.create({
                publicKey: {
                    challenge, rp: { name: "Vault" },
                    user: { id: new Uint8Array([1,2,3,4]), name: "user", displayName: "User" },
                    pubKeyCredParams: [{ alg: -7, type: "public-key" }],
                    timeout: 60000,
                    authenticatorSelection: { authenticatorAttachment: "platform" }
                }
            });
            if (credential) { localStorage.setItem('bio_v', pwd); alert("×˜×‘×™×¢×ª ××¦×‘×¢ ×”×•×’×“×¨×”!"); }
        } catch (e) { console.error(e); }
    }

    document.getElementById('btnBio').onclick = async () => {
        try {
            const challenge = window.crypto.getRandomValues(new Uint8Array(32));
            await navigator.credentials.get({ publicKey: { challenge, timeout: 60000, userVerification: "required" } });
            document.getElementById('masterPass').value = localStorage.getItem('bio_v');
            document.getElementById('btnLogin').click();
        } catch (e) { alert("×–×™×”×•×™ × ×›×©×œ"); }
    };

    document.getElementById("btnLogin").onclick = async () => {
        MASTER = document.getElementById("masterPass").value;
        if(!MASTER) return;
        try {
            const snap = await getDocs(collection(db, "vault"));
            DATA = [];
            snap.forEach(d => {
                try {
                    const bytes = CryptoJS.AES.decrypt(d.data().blob, MASTER);
                    const decStr = bytes.toString(CryptoJS.enc.Utf8);
                    if(!decStr) return;
                    const obj = JSON.parse(decStr);
                    obj.id = d.id; DATA.push(obj);
                } catch(e) {}
            });
            if (!localStorage.getItem('bio_v') && confirm("×œ×”×¤×¢×™×œ ×˜×‘×™×¢×ª ××¦×‘×¢ ×œ×”×‘×?")) await registerBio(MASTER);
            render(); show('main');
        } catch(err) { document.getElementById('status').textContent = "×©×’×™××” ×‘×—×™×‘×•×¨/×¡×™×¡××”"; }
    };

    function render(f = "") {
        const list = document.getElementById("list");
        list.innerHTML = "";
        DATA.filter(i => i.service.toLowerCase().includes(f.toLowerCase())).forEach(item => {
            const div = document.createElement("div");
            div.className = "vault-item";
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>${item.service}</strong> 
                    <div class="actions">
                        <span class="copy" onclick="edit('${item.id}')">âœï¸</span>
                        <span class="del" onclick="remove('${item.id}')">ğŸ—‘ï¸</span>
                    </div>
                </div>
                <div class="row"><span>${item.user}</span><span class="copy" onclick="cp('${item.user}')">ğŸ“‹</span></div>
                <div class="row">
                    <span class="pass-display" id="p-${item.id}">â€¢â€¢â€¢â€¢â€¢â€¢</span>
                    <div style="display:flex; gap:12px;">
                        <span class="copy" onclick="togglePass('${item.id}', '${item.pass}')">ğŸ‘ï¸</span>
                        <span class="copy" onclick="cp('${item.pass}')">ğŸ“‹</span>
                    </div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    window.togglePass = (id, val) => {
        const el = document.getElementById(`p-${id}`);
        el.textContent = el.textContent === "â€¢â€¢â€¢â€¢â€¢â€¢" ? val : "â€¢â€¢â€¢â€¢â€¢â€¢";
    };

    window.remove = async (id) => {
        const verify = prompt("×”×–×Ÿ ×¡×™×¡××ª ×××¡×˜×¨ ×œ××—×™×§×”:");
        if (verify === MASTER) {
            await deleteDoc(doc(db, "vault", id));
            DATA = DATA.filter(x => x.id !== id);
            render();
            alert("× ××—×§ ×‘×”×¦×œ×—×”");
        } else if (verify !== null) {
            alert("×¡×™×¡××” ×©×’×•×™×”!");
        }
    };

    window.cp = (t) => { navigator.clipboard.writeText(t); alert("×”×•×¢×ª×§!"); };
    window.edit = (id) => {
        const i = DATA.find(x => x.id === id);
        EDIT_ID = id;
        document.getElementById("service").value = i.service;
        document.getElementById("user").value = i.user;
        document.getElementById("pass").value = i.pass;
        document.getElementById("notes").value = i.notes;
        show('add');
    };

    document.getElementById("saveBtn").onclick = async () => {
        const obj = { service: document.getElementById("service").value, user: document.getElementById("user").value, pass: document.getElementById("pass").value, notes: document.getElementById("notes").value };
        const enc = CryptoJS.AES.encrypt(JSON.stringify(obj), MASTER).toString();
        const id = EDIT_ID || "rec_" + Date.now();
        await setDoc(doc(db, "vault", id), { blob: enc });
        location.reload();
    };

    document.getElementById("addBtn").onclick = () => { EDIT_ID = null; show('add'); };
    document.getElementById("search").oninput = (e) => render(e.target.value);
</script>
</body>
</html>
