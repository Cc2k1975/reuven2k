<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×× ×ª×— ×¢×•×§×‘×™× - ×¨××•×‘×Ÿ</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .card { max-width: 500px; margin: auto; background: #1e1e1e; padding: 25px; border-radius: 20px; border: 1px solid #333; }
        h2 { color: #E1306C; }
        .steps { text-align: right; font-size: 14px; background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        input[type="file"] { display: none; }
        .btn { background: #E1306C; color: white; padding: 12px 20px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; width: 100%; margin: 10px 0; font-size: 16px; }
        .btn-second { background: #444; }
        #results { margin-top: 20px; text-align: right; }
        .unfollowed-item { background: #ff4d4d22; border-right: 4px solid #ff4d4d; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .status-badge { font-size: 12px; background: #333; padding: 3px 8px; border-radius: 10px; color: #aaa; }
    </style>
</head>
<body>

    <div class="card">
        <h2>××™ ×”×•×¨×™×“ ×œ×™ ×¢×•×§×‘? ğŸ•µï¸â€â™‚ï¸</h2>
        
        <div class="steps">
            <strong>××™×š ×–×” ×¢×•×‘×“?</strong><br>
            1. ×‘××™× ×¡×˜×’×¨×: ×”×’×“×¨×•×ª > ××¨×›×– ×”×—×©×‘×•× ×•×ª > ×”××™×“×¢ ×•×”×”×¨×©××•×ª ×©×œ×š > ×”×•×¨×“ ××ª ×”××™×“×¢ ×©×œ×š.<br>
            2. ×‘×—×¨ "×”×•×¨×“×” ×—×œ×§×™×ª" ×•××– ×¨×§ ××ª "×¢×•×§×‘×™× ×•× ×¢×§×‘×™×".<br>
            3. ×‘×—×¨ ×¤×•×¨××˜ **JSON** (×—×©×•×‘!) ×•×˜×•×•×— ×–××Ÿ "×›×œ ×”×–××Ÿ".<br>
            4. ×›×©×”×§×•×‘×¥ ××•×›×Ÿ, ×”×¢×œ×” ×›××Ÿ ××ª ×”×§×•×‘×¥ <code>followers.json</code>.
        </div>

        <div id="storage-info" class="status-badge">×˜×¨× × ×©××¨ ×’×™×‘×•×™ ×§×•×“×</div>

        <button class="btn" onclick="document.getElementById('fileInput').click()">ğŸ“ ×”×¢×œ×” ×§×•×‘×¥ followers.json</button>
        <input type="file" id="fileInput" accept=".json">

        <div id="results"></div>
        
        <button class="btn btn-second" id="clearBtn" style="display:none" onclick="clearBackup()">ğŸ—‘ï¸ ××—×§ ×’×™×‘×•×™ ×™×©×Ÿ ×•×”×ª×—×œ ××—×“×©</button>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const resultsDiv = document.getElementById('results');
        const storageInfo = document.getElementById('storage-info');
        const clearBtn = document.getElementById('clearBtn');

        // ×‘×“×™×§×” ×× ×™×© ×’×™×‘×•×™ ×§×™×™×
        updateStatus();

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    // ××™× ×¡×˜×’×¨× ×©×•××¨×ª ××ª ×–×” ×‘××‘× ×” ×©×œ ××¢×¨×š ×ª×—×ª ××¤×ª×— ××¡×•×™×
                    const currentFollowers = extractFollowers(data);
                    
                    processFollowers(currentFollowers);
                } catch (err) {
                    alert("×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥. ×•×•×“× ×©×”×¢×œ×™×ª ×§×•×‘×¥ JSON ×ª×§×™×Ÿ ×××™× ×¡×˜×’×¨×.");
                }
            };
            reader.readAsText(file);
        });

        function extractFollowers(data) {
            // ×”××‘× ×” ×©×œ ××™× ×¡×˜×’×¨× ×‘-JSON: ×‘×“"×› ××¢×¨×š ×©×œ ××•×‘×™×™×§×˜×™× ×¢× string_list_data
            let list = [];
            if (Array.isArray(data)) {
                list = data;
            } else if (data.relationships_followers) {
                list = data.relationships_followers;
            }

            return list.map(item => {
                return item.string_list_data[0].value;
            });
        }

        function processFollowers(currentList) {
            const lastBackup = JSON.parse(localStorage.getItem('followers_backup'));

            if (!lastBackup) {
                // ×¤×¢× ×¨××©×•× ×” - ×©×•××¨×™× ×’×™×‘×•×™
                localStorage.setItem('followers_backup', JSON.stringify(currentList));
                localStorage.setItem('backup_date', new Date().toLocaleString());
                resultsDiv.innerHTML = `<div style="color:#25D366">âœ… ×”×’×™×‘×•×™ × ×©××¨ ×‘×”×¦×œ×—×”! (${currentList.length} ×¢×•×§×‘×™×).<br>×‘×¤×¢× ×”×‘××” ×©×ª×¢×œ×” ×§×•×‘×¥, ××’×™×“ ×œ×š ××™ ×¢×–×‘.</div>`;
            } else {
                // ×¤×¢× ×©× ×™×™×” - ×‘×•×“×§×™× ×“×œ×ª× (××™ ×”×™×” ×‘×’×™×‘×•×™ ×•×œ× × ××¦× ×¢×›×©×™×•)
                const unfollowed = lastBackup.filter(user => !currentList.includes(user));
                const newFollowers = currentList.filter(user => !lastBackup.includes(user));

                displayResults(unfollowed, newFollowers);
                
                // ×¢×“×›×•×Ÿ ×”×’×™×‘×•×™ ×œ×—×“×© ×‘×™×•×ª×¨
                if (confirm("×”×× ×œ×¢×“×›×Ÿ ××ª ×”×’×™×‘×•×™ ×œ×¨×©×™××” ×”× ×•×›×—×™×ª?")) {
                    localStorage.setItem('followers_backup', JSON.stringify(currentList));
                    localStorage.setItem('backup_date', new Date().toLocaleString());
                }
            }
            updateStatus();
        }

        function displayResults(unfollowed, newFollowers) {
            let html = `<h3>×ª×•×¦××•×ª ×”×‘×“×™×§×”:</h3>`;
            
            if (unfollowed.length === 0) {
                html += `<p style="color:#25D366">××“×”×™×! ××£ ××—×“ ×œ× ×”×•×¨×™×“ ×¢×•×§×‘.</p>`;
            } else {
                html += `<h4>×”×•×¨×™×“×• ×¢×•×§×‘ (${unfollowed.length}):</h4>`;
                unfollowed.forEach(user => {
                    html += `<div class="unfollowed-item">@${user}</div>`;
                });
            }

            if (newFollowers.length > 0) {
                html += `<h4>×¢×•×§×‘×™× ×—×“×©×™× (${newFollowers.length}):</h4>`;
                newFollowers.forEach(user => {
                    html += `<div style="color:#25D366; font-size:14px;">+ @${user}</div>`;
                });
            }

            resultsDiv.innerHTML = html;
        }

        function updateStatus() {
            const date = localStorage.getItem('backup_date');
            if (date) {
                storageInfo.innerText = "×’×™×‘×•×™ ××—×¨×•×Ÿ: " + date;
                clearBtn.style.display = "block";
            } else {
                storageInfo.innerText = "×˜×¨× × ×©××¨ ×’×™×‘×•×™ ×§×•×“×";
                clearBtn.style.display = "none";
            }
        }

        function clearBackup() {
            if (confirm("×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×’×™×‘×•×™?")) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
